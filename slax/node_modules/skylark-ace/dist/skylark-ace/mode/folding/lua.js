/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(e,t,n){"use strict";var r=e("../../lib/oop"),i=e("./fold_mode").FoldMode,o=e("../../range").Range,a=e("../../token_iterator").TokenIterator,d=t.FoldMode=function(){};r.inherits(d,i),function(){this.foldingStartMarker=/\b(function|then|do|repeat)\b|{\s*$|(\[=*\[)/,this.foldingStopMarker=/\bend\b|^\s*}|\]=*\]/,this.getFoldWidget=function(e,t,n){var r=e.getLine(n),i=this.foldingStartMarker.test(r),o=this.foldingStopMarker.test(r);if(i&&!o){var a;if("then"==(a=r.match(this.foldingStartMarker))[1]&&/\belseif\b/.test(r))return;if(a[1]){if("keyword"===e.getTokenAt(n,a.index+1).type)return"start"}else{if(!a[2])return"start";if("bracketedComment"==(d=e.bgTokenizer.getState(n)||"")[0]||"bracketedString"==d[0])return"start"}}if("markbeginend"!=t||!o||i&&o)return"";if("end"===(a=r.match(this.foldingStopMarker))[0]){if("keyword"===e.getTokenAt(n,a.index+1).type)return"end"}else{if("]"!==a[0][0])return"end";var d;if("bracketedComment"==(d=e.bgTokenizer.getState(n-1)||"")[0]||"bracketedString"==d[0])return"end"}},this.getFoldWidgetRange=function(e,t,n){var r,i=e.doc.getLine(n);return(r=this.foldingStartMarker.exec(i))?r[1]?this.luaBlock(e,n,r.index+1):r[2]?e.getCommentFoldRange(n,r.index+1):this.openingBracketBlock(e,"{",n,r.index):(r=this.foldingStopMarker.exec(i))?"end"===r[0]&&"keyword"===e.getTokenAt(n,r.index+1).type?this.luaBlock(e,n,r.index+1):"]"===r[0][0]?e.getCommentFoldRange(n,r.index+1):this.closingBracketBlock(e,"}",n,r.index+r[0].length):void 0},this.luaBlock=function(e,t,n){var r=new a(e,t,n),i={function:1,do:1,then:1,elseif:-1,end:-1,repeat:1,until:-1},d=r.getCurrentToken();if(d&&"keyword"==d.type){var l=d.value,g=[l],f=i[l];if(f){var s=-1===f?r.getCurrentTokenColumn():e.getLine(t).length,k=t;for(r.step=-1===f?r.stepBackward:r.stepForward;d=r.step();)if("keyword"===d.type){var u=f*i[d.value];if(u>0)g.unshift(d.value);else if(u<=0){if(g.shift(),!g.length&&"elseif"!=d.value)break;0===u&&g.unshift(d.value)}}t=r.getCurrentTokenRow();return-1===f?new o(t,e.getLine(t).length,k,s):new o(k,s,t,r.getCurrentTokenColumn())}}}}.call(d.prototype)});
//# sourceMappingURL=../../sourcemaps/mode/folding/lua.js.map
