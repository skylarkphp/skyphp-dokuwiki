{"version":3,"sources":["layer/lines.js"],"names":["define","require","exports","module","dom","Lines","element","canvasHeight","this","style","height","cells","cellCache","$offsetCoefficient","moveContainer","config","translate","firstRowScreen","lineHeight","offset","pageChanged","oldConfig","newConfig","Math","floor","computeLineTop","row","session","screenTop","screenPage","documentToScreenRow","computeLineHeight","getRowLength","getLength","length","get","index","shift","$cacheCell","pop","push","cell","Array","isArray","apply","fragment","createFragment","i","appendChild","unshift","firstChild","insertBefore","insertAdjacentElement","last","remove","createCell","initElement","createElement","text","call","prototype"],"mappings":"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","file":"../../layer/lines.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\r\n * Distributed under the BSD license:\r\n *\r\n * Copyright (c) 2010, Ajax.org B.V.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *     * Redistributions of source code must retain the above copyright\r\n *       notice, this list of conditions and the following disclaimer.\r\n *     * Redistributions in binary form must reproduce the above copyright\r\n *       notice, this list of conditions and the following disclaimer in the\r\n *       documentation and/or other materials provided with the distribution.\r\n *     * Neither the name of Ajax.org B.V. nor the\r\n *       names of its contributors may be used to endorse or promote products\r\n *       derived from this software without specific prior written permission.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * ***** END LICENSE BLOCK ***** */\r\n\r\ndefine(function(require, exports, module) {\r\n\"use strict\";\r\n\r\nvar dom = require(\"../lib/dom\");\r\n\r\nvar Lines = function(element, canvasHeight) {\r\n    this.element = element;\r\n    this.canvasHeight = canvasHeight || 500000;\r\n    this.element.style.height = (this.canvasHeight * 2) + \"px\";\r\n    \r\n    this.cells = [];\r\n    this.cellCache = [];\r\n    this.$offsetCoefficient = 0;\r\n};\r\n\r\n(function() {\r\n    \r\n    this.moveContainer = function(config) {\r\n        dom.translate(this.element, 0, -((config.firstRowScreen * config.lineHeight) % this.canvasHeight) - config.offset * this.$offsetCoefficient);\r\n    };    \r\n    \r\n    this.pageChanged = function(oldConfig, newConfig) {\r\n        return (\r\n            Math.floor((oldConfig.firstRowScreen * oldConfig.lineHeight) / this.canvasHeight) !==\r\n            Math.floor((newConfig.firstRowScreen * newConfig.lineHeight) / this.canvasHeight)\r\n        );\r\n    };\r\n    \r\n    this.computeLineTop = function(row, config, session) {\r\n        var screenTop = config.firstRowScreen * config.lineHeight;\r\n        var screenPage = Math.floor(screenTop / this.canvasHeight);\r\n        var lineTop = session.documentToScreenRow(row, 0) * config.lineHeight;\r\n        return lineTop - (screenPage * this.canvasHeight);\r\n    };\r\n    \r\n    this.computeLineHeight = function(row, config, session) {\r\n        return config.lineHeight * session.getRowLength(row);\r\n    };\r\n    \r\n    this.getLength = function() {\r\n        return this.cells.length;\r\n    };\r\n    \r\n    this.get = function(index) {\r\n        return this.cells[index];\r\n    };\r\n    \r\n    this.shift = function() {\r\n        this.$cacheCell(this.cells.shift());\r\n    };\r\n    \r\n    this.pop = function() {\r\n        this.$cacheCell(this.cells.pop());\r\n    };\r\n    \r\n    this.push = function(cell) {\r\n        if (Array.isArray(cell)) {\r\n            this.cells.push.apply(this.cells, cell);\r\n            var fragment = dom.createFragment(this.element);\r\n            for (var i=0; i<cell.length; i++) {\r\n                fragment.appendChild(cell[i].element);\r\n            }\r\n            this.element.appendChild(fragment);\r\n         } else {\r\n            this.cells.push(cell);\r\n            this.element.appendChild(cell.element);\r\n         }\r\n    };\r\n    \r\n    this.unshift = function(cell) {\r\n        if (Array.isArray(cell)) {\r\n            this.cells.unshift.apply(this.cells, cell);\r\n            var fragment = dom.createFragment(this.element);\r\n            for (var i=0; i<cell.length; i++) {\r\n                fragment.appendChild(cell[i].element);\r\n            }\r\n            if (this.element.firstChild)\r\n                this.element.insertBefore(fragment, this.element.firstChild);\r\n            else\r\n                this.element.appendChild(fragment);\r\n         } else {\r\n            this.cells.unshift(cell);\r\n            this.element.insertAdjacentElement(\"afterbegin\", cell.element);\r\n         }\r\n    };\r\n    \r\n    this.last = function() {\r\n        if (this.cells.length)\r\n            return this.cells[this.cells.length-1];\r\n        else\r\n            return null;\r\n    };\r\n    \r\n    this.$cacheCell = function(cell) {\r\n        if (!cell)\r\n            return;\r\n            \r\n        cell.element.remove();\r\n        this.cellCache.push(cell);\r\n    };\r\n    \r\n    this.createCell = function(row, config, session, initElement) {\r\n        var cell = this.cellCache.pop();\r\n        if (!cell) {\r\n            var element = dom.createElement(\"div\");\r\n            if (initElement)\r\n                initElement(element);\r\n            \r\n            this.element.appendChild(element);\r\n            \r\n            cell = {\r\n                element: element,\r\n                text: \"\",\r\n                row: row\r\n            };\r\n        }\r\n        cell.row = row;\r\n        \r\n        return cell;\r\n    };\r\n    \r\n}).call(Lines.prototype);\r\n\r\nexports.Lines = Lines;\r\n\r\n});\r\n"]}