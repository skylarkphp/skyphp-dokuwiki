{"version":3,"sources":["lib/app_config.js"],"names":["define","require","exports","module","oop","EventEmitter","optionsProvider","setOptions","optList","Object","keys","forEach","key","this","setOption","getOptions","optionNames","result","Array","isArray","options","$options","filter","hidden","getOption","name","value","opt","warn","forwardTo","handlesSet","set","call","get","message","console","apply","arguments","reportError","msg","data","e","Error","error","setTimeout","AppConfig","$defaultOptions","implement","defineOptions","obj","path","initialValue","resetOptions","setDefaultValue","opts","setDefaultValues","optionHash","prototype"],"mappings":"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","file":"../../lib/app_config.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\r\n * Distributed under the BSD license:\r\n *\r\n * Copyright (c) 2010, Ajax.org B.V.\r\n * All rights reserved.\r\n * \r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *     * Redistributions of source code must retain the above copyright\r\n *       notice, this list of conditions and the following disclaimer.\r\n *     * Redistributions in binary form must reproduce the above copyright\r\n *       notice, this list of conditions and the following disclaimer in the\r\n *       documentation and/or other materials provided with the distribution.\r\n *     * Neither the name of Ajax.org B.V. nor the\r\n *       names of its contributors may be used to endorse or promote products\r\n *       derived from this software without specific prior written permission.\r\n * \r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * ***** END LICENSE BLOCK ***** */\r\n\r\ndefine(function(require, exports, module) {\r\n\"no use strict\";\r\n\r\nvar oop = require(\"./oop\");\r\nvar EventEmitter = require(\"./event_emitter\").EventEmitter;\r\n\r\nvar optionsProvider = {\r\n    setOptions: function(optList) {\r\n        Object.keys(optList).forEach(function(key) {\r\n            this.setOption(key, optList[key]);\r\n        }, this);\r\n    },\r\n    getOptions: function(optionNames) {\r\n        var result = {};\r\n        if (!optionNames) {\r\n            var options = this.$options;\r\n            optionNames = Object.keys(options).filter(function(key) {\r\n                return !options[key].hidden;\r\n            });\r\n        } else if (!Array.isArray(optionNames)) {\r\n            result = optionNames;\r\n            optionNames = Object.keys(result);\r\n        }\r\n        optionNames.forEach(function(key) {\r\n            result[key] = this.getOption(key);\r\n        }, this);\r\n        return result;\r\n    },\r\n    setOption: function(name, value) {\r\n        if (this[\"$\" + name] === value)\r\n            return;\r\n        var opt = this.$options[name];\r\n        if (!opt) {\r\n            return warn('misspelled option \"' + name + '\"');\r\n        }\r\n        if (opt.forwardTo)\r\n            return this[opt.forwardTo] && this[opt.forwardTo].setOption(name, value);\r\n\r\n        if (!opt.handlesSet)\r\n            this[\"$\" + name] = value;\r\n        if (opt && opt.set)\r\n            opt.set.call(this, value);\r\n    },\r\n    getOption: function(name) {\r\n        var opt = this.$options[name];\r\n        if (!opt) {\r\n            return warn('misspelled option \"' + name + '\"');\r\n        }\r\n        if (opt.forwardTo)\r\n            return this[opt.forwardTo] && this[opt.forwardTo].getOption(name);\r\n        return opt && opt.get ? opt.get.call(this) : this[\"$\" + name];\r\n    }\r\n};\r\n\r\nfunction warn(message) {\r\n    if (typeof console != \"undefined\" && console.warn)\r\n        console.warn.apply(console, arguments);\r\n}\r\n\r\nfunction reportError(msg, data) {\r\n    var e = new Error(msg);\r\n    e.data = data;\r\n    if (typeof console == \"object\" && console.error)\r\n        console.error(e);\r\n    setTimeout(function() { throw e; });\r\n}\r\n\r\nvar AppConfig = function() {\r\n    this.$defaultOptions = {};\r\n};\r\n\r\n(function() {\r\n    // module loading\r\n    oop.implement(this, EventEmitter);\r\n    /*\r\n     * option {name, value, initialValue, setterName, set, get }\r\n     */\r\n    this.defineOptions = function(obj, path, options) {\r\n        if (!obj.$options)\r\n            this.$defaultOptions[path] = obj.$options = {};\r\n\r\n        Object.keys(options).forEach(function(key) {\r\n            var opt = options[key];\r\n            if (typeof opt == \"string\")\r\n                opt = {forwardTo: opt};\r\n\r\n            opt.name || (opt.name = key);\r\n            obj.$options[opt.name] = opt;\r\n            if (\"initialValue\" in opt)\r\n                obj[\"$\" + opt.name] = opt.initialValue;\r\n        });\r\n\r\n        // implement option provider interface\r\n        oop.implement(obj, optionsProvider);\r\n\r\n        return this;\r\n    };\r\n\r\n    this.resetOptions = function(obj) {\r\n        Object.keys(obj.$options).forEach(function(key) {\r\n            var opt = obj.$options[key];\r\n            if (\"value\" in opt)\r\n                obj.setOption(key, opt.value);\r\n        });\r\n    };\r\n\r\n    this.setDefaultValue = function(path, name, value) {\r\n        var opts = this.$defaultOptions[path] || (this.$defaultOptions[path] = {});\r\n        if (opts[name]) {\r\n            if (opts.forwardTo)\r\n                this.setDefaultValue(opts.forwardTo, name, value);\r\n            else\r\n                opts[name].value = value;\r\n        }\r\n    };\r\n\r\n    this.setDefaultValues = function(path, optionHash) {\r\n        Object.keys(optionHash).forEach(function(key) {\r\n            this.setDefaultValue(path, key, optionHash[key]);\r\n        }, this);\r\n    };\r\n    \r\n    this.warn = warn;\r\n    this.reportError = reportError;\r\n    \r\n}).call(AppConfig.prototype);\r\n\r\nexports.AppConfig = AppConfig;\r\n\r\n});\r\n"]}