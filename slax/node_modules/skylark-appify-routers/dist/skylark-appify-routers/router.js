/**
 * skylark-appify-routers - An Elegant HTML5 Routing Framework.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.6
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx/langx","./routers","./route"],function(t,e,n){var r=e.createEvent;return e.Router=function(){var e,a,i,o,u={},s={},p=new t.Evented,h=this;function f(n){if(!e||e.route.exit({path:e.path,params:e.params},!0)){if(a=e,!(e=n).route){var i=l(e.path);e.route=i.route,e.params=i.params}var o=e.route.enter({force:e.force,path:e.path,params:e.params},!0);t.Deferred.when(o).then(function(){p.trigger(r("routing",{current:e,previous:a})),e.route.enter({path:e.path,params:e.params},!1),a&&a.route.exit({path:a.path,params:a.params},!1),p.trigger(r("routed",{current:e,previous:a}))})}}function c(t,n){if(!n&&e&&e.path==t)return!1;var a=l(t);if(a)if(a.path=t,h.useHistoryApi){var o={force:n,path:t};window.history.pushState(o,document.title,(i+t).replace("//","/")),window.dispatchEvent(r("popstate",{state:o}))}else if(h.useHashbang){var u="#!"+t;window.location.hash!==u?window.location.hash=u:f(a)}else f(a);return!0}function l(e,n){var r=!1;return!n&&(r=s[e])?r:(t.each(u,function(t,n){var a=n.match(e);return!a||(r={route:n,params:a},!1)}),r&&!n&&(s[e]=r),r)}function d(e){if(!t.isDefined(e))return t.mixin({},u);for(var n in e)u[n]=new h.Route(n,e[n])}t.mixin(h,{Route:n,current:function(){return e},go:c,map:l,hub:function(){return p},off:function(){p.off.apply(p,arguments)},on:function(){p.on.apply(p,arguments)},one:function(){p.one.apply(p,arguments)},path:function(t,e){var n,r=u[t];return r&&(n=r.path(e)),n},previous:function(){return a},baseUrl:function(e){return t.isDefined(e)?(i=e,this):i},homePath:function(e){return t.isDefined(e)?(o=e,this):o},route:function(e,n){if(t.isDefined(n)){var r={};return r[e]=n,d(r),this}return u[e]},routes:d,start:function(){null==h.useHashbang&&null==h.useHistoryApi&&(window.location.host&&window.history.pushState?h.useHistoryApi=!0:h.useHashbang=!0);var t="";h.useHistoryApi?(t=window.location.pathname,void 0===i&&(i=t.replace(/\/$/,"")),t=t.replace(i,"")||o||"/"):t=h.useHashbang&&(window.location.hash.replace("#!","")||o)||"/",t.startsWith("/")||(t="/"+t),h.useHistoryApi?window.addEventListener("popstate",function(t){t.state&&f(t.state),t.preventDefault()}):h.useHashbang&&window.addEventListener("hashchange",function(t){f({path:window.location.hash.replace(/^#!/,"")}),t.preventDefault()}),c(t)},trigger:function(t){return p.trigger(t),this},useHistoryApi:null,useHashbang:null})}});
//# sourceMappingURL=sourcemaps/router.js.map
