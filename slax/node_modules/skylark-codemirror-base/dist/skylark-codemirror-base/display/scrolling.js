/**
 * skylark-codemirror-base - A version of codemirror 5.45 core library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-codemirror-base/
 * @license MIT
 */
define(["../line/pos","../measurement/position_measurement","../util/browser","../util/dom","../util/event","./line_numbers","./update_display"],function(l,o,t,r,e,s,c){"use strict";function i(l,t){let r=l.display,e=o.textHeight(l.display);t.top<0&&(t.top=0);let s=l.curOp&&null!=l.curOp.scrollTop?l.curOp.scrollTop:r.scroller.scrollTop,c=o.displayHeight(l),i={};t.bottom-t.top>c&&(t.bottom=t.top+c);let p=l.doc.height+o.paddingVert(r),n=t.top<e,a=t.bottom>p-e;if(t.top<s)i.scrollTop=n?0:t.top;else if(t.bottom>s+c){let l=Math.min(t.top,(a?p:t.bottom)-c);l!=s&&(i.scrollTop=l)}let u=l.curOp&&null!=l.curOp.scrollLeft?l.curOp.scrollLeft:r.scroller.scrollLeft,f=o.displayWidth(l)-(l.options.fixedGutter?r.gutters.offsetWidth:0),d=t.right-t.left>f;return d&&(t.right=t.left+f),t.left<10?i.scrollLeft=0:t.left<u?i.scrollLeft=Math.max(0,t.left-(d?0:10)):t.right>f+u-3&&(i.scrollLeft=t.right+(d?0:10)-f),i}function p(l,o,t){null==o&&null==t||n(l),null!=o&&(l.curOp.scrollLeft=o),null!=t&&(l.curOp.scrollTop=t)}function n(l){let t=l.curOp.scrollToPos;if(t){l.curOp.scrollToPos=null,a(l,o.estimateCoords(l,t.from),o.estimateCoords(l,t.to),t.margin)}}function a(l,o,t,r){let e=i(l,{left:Math.min(o.left,t.left),top:Math.min(o.top,t.top)-r,right:Math.max(o.right,t.right),bottom:Math.max(o.bottom,t.bottom)+r});p(l,e.scrollLeft,e.scrollTop)}function u(l,o){Math.abs(l.doc.scrollTop-o)<2||(t.gecko||c.updateDisplaySimple(l,{top:o}),f(l,o,!0),t.gecko&&c.updateDisplaySimple(l),l.startWorker(l,100))}function f(l,o,t){o=Math.min(l.display.scroller.scrollHeight-l.display.scroller.clientHeight,o),(l.display.scroller.scrollTop!=o||t)&&(l.doc.scrollTop=o,l.display.scrollbars.setScrollTop(o),l.display.scroller.scrollTop!=o&&(l.display.scroller.scrollTop=o))}function d(l,o,t,r){o=Math.min(o,l.display.scroller.scrollWidth-l.display.scroller.clientWidth),(t?o==l.doc.scrollLeft:Math.abs(l.doc.scrollLeft-o)<2)&&!r||(l.doc.scrollLeft=o,s.alignHorizontally(l),l.display.scroller.scrollLeft!=o&&(l.display.scroller.scrollLeft=o),l.display.scrollbars.setScrollLeft(o))}return{maybeScrollWindow:function(l,s){if(e.signalDOMEvent(l,"scrollCursorIntoView"))return;let c=l.display,i=c.sizer.getBoundingClientRect(),p=null;if(s.top+i.top<0?p=!0:s.bottom+i.top>(window.innerHeight||document.documentElement.clientHeight)&&(p=!1),null!=p&&!t.phantom){let t=r.elt("div","â€‹",null,`position: absolute;\n                         top: ${s.top-c.viewOffset-o.paddingTop(l.display)}px;\n                         height: ${s.bottom-s.top+o.scrollGap(l)+c.barHeight}px;\n                         left: ${s.left}px; width: ${Math.max(2,s.right-s.left)}px;`);l.display.lineSpace.appendChild(t),t.scrollIntoView(p),l.display.lineSpace.removeChild(t)}},scrollPosIntoView:function(t,r,e,s){let c;null==s&&(s=0),t.options.lineWrapping||r!=e||(e="before"==(r=r.ch?l.Pos(r.line,"before"==r.sticky?r.ch-1:r.ch,"after"):r).sticky?l.Pos(r.line,r.ch+1,"before"):r);for(let l=0;l<5;l++){let l=!1,p=o.cursorCoords(t,r),n=e&&e!=r?o.cursorCoords(t,e):p,a=i(t,c={left:Math.min(p.left,n.left),top:Math.min(p.top,n.top)-s,right:Math.max(p.left,n.left),bottom:Math.max(p.bottom,n.bottom)+s}),f=t.doc.scrollTop,h=t.doc.scrollLeft;if(null!=a.scrollTop&&(u(t,a.scrollTop),Math.abs(t.doc.scrollTop-f)>1&&(l=!0)),null!=a.scrollLeft&&(d(t,a.scrollLeft),Math.abs(t.doc.scrollLeft-h)>1&&(l=!0)),!l)break}return c},scrollIntoView:function(l,o){let t=i(l,o);null!=t.scrollTop&&u(l,t.scrollTop),null!=t.scrollLeft&&d(l,t.scrollLeft)},addToScrollTop:function(l,o){null!=o&&(n(l),l.curOp.scrollTop=(null==l.curOp.scrollTop?l.doc.scrollTop:l.curOp.scrollTop)+o)},ensureCursorVisible:function(l){n(l);let o=l.getCursor();l.curOp.scrollToPos={from:o,to:o,margin:l.options.cursorScrollMargin}},scrollToCoords:p,scrollToRange:function(l,o){n(l),l.curOp.scrollToPos=o},scrollToCoordsRange:a,updateScrollTop:u,setScrollTop:f,setScrollLeft:d}});
//# sourceMappingURL=../sourcemaps/display/scrolling.js.map
