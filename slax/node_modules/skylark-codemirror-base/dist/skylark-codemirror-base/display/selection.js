/**
 * skylark-codemirror-base - A version of codemirror 5.45 core library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-codemirror-base/
 * @license MIT
 */
define(["../line/pos","../line/spans","../line/utils_line","../measurement/position_measurement","../util/bidi","../util/dom"],function(t,e,i,o,l,n){"use strict";function r(t,e,i){let l=o.cursorCoords(t,e,"div",null,null,!t.options.singleCursorHeightPerLine),r=i.appendChild(n.elt("div"," ","CodeMirror-cursor"));if(r.style.left=l.left+"px",r.style.top=l.top+"px",r.style.height=Math.max(0,l.bottom-l.top)*t.options.cursorHeight+"px",l.other){let t=i.appendChild(n.elt("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));t.style.display="",t.style.left=l.other.left+"px",t.style.top=l.other.top+"px",t.style.height=.85*(l.other.bottom-l.other.top)+"px"}}function s(t,e){return t.top-e.top||t.left-e.left}function p(r,p,u){let d=r.display,a=r.doc,c=document.createDocumentFragment(),h=o.paddingH(r.display),f=h.left,m=Math.max(d.sizerWidth,o.displayWidth(r)-d.sizer.offsetLeft)-h.right,g="ltr"==a.direction;function y(t,e,i,o){e<0&&(e=0),e=Math.round(e),o=Math.round(o),c.appendChild(n.elt("div",null,"CodeMirror-selected",`position: absolute; left: ${t}px;\n                             top: ${e}px; width: ${null==i?m-t:i}px;\n                             height: ${o-e}px`))}function b(e,n,p){let u,d,c=i.getLine(a,e),h=c.text.length;function b(i,l){return o.charCoords(r,t.Pos(e,i),"div",c,l)}function v(t,e,i){let l=o.wrappedLineExtentChar(r,c,null,t),n="ltr"==e==("after"==i)?"left":"right";return b("after"==i?l.begin:l.end-(/\s/.test(c.text.charAt(l.end-1))?2:1),n)[n]}let x=l.getOrder(c,a.direction);return l.iterateBidiSections(x,n||0,null==p?h:p,(t,e,i,o)=>{let l="ltr"==i,r=b(t,l?"left":"right"),a=b(e-1,l?"right":"left"),c=null==n&&0==t,C=null==p&&e==h,L=0==o,M=!x||o==x.length-1;if(a.top-r.top<=3){let t=(g?C:c)&&M,e=(g?c:C)&&L?f:(l?r:a).left,i=t?m:(l?a:r).right;y(e,r.top,i-e,r.bottom)}else{let o,n,s,p;l?(o=g&&c&&L?f:r.left,n=g?m:v(t,i,"before"),s=g?f:v(e,i,"after"),p=g&&C&&M?m:a.right):(o=g?v(t,i,"before"):f,n=!g&&c&&L?m:r.right,s=!g&&C&&M?f:a.left,p=g?v(e,i,"after"):m),y(o,r.top,n-o,r.bottom),r.bottom<a.top&&y(f,r.bottom,null,a.top),y(s,a.top,p-s,a.bottom)}(!u||s(r,u)<0)&&(u=r),s(a,u)<0&&(u=a),(!d||s(r,d)<0)&&(d=r),s(a,d)<0&&(d=a)}),{start:u,end:d}}let v=p.from(),x=p.to();if(v.line==x.line)b(v.line,v.ch,x.ch);else{let t=i.getLine(a,v.line),o=i.getLine(a,x.line),l=e.visualLine(t)==e.visualLine(o),n=b(v.line,v.ch,l?t.text.length+1:null).end,r=b(x.line,l?0:null,x.ch).start;l&&(n.top<r.top-2?(y(n.right,n.top,null,n.bottom),y(f,r.top,r.left,r.bottom)):y(n.right,n.top,r.left-n.right,n.bottom)),n.bottom<r.top&&y(f,n.bottom,null,r.top)}u.appendChild(c)}return{updateSelection:function(t){t.display.input.showSelection(t.display.input.prepareSelection())},prepareSelection:function(t,e=!0){let i=t.doc,o={},l=o.cursors=document.createDocumentFragment(),n=o.selection=document.createDocumentFragment();for(let o=0;o<i.sel.ranges.length;o++){if(!e&&o==i.sel.primIndex)continue;let s=i.sel.ranges[o];if(s.from().line>=t.display.viewTo||s.to().line<t.display.viewFrom)continue;let u=s.empty();(u||t.options.showCursorWhenSelecting)&&r(t,s.head,l),u||p(t,s,n)}return o},drawSelectionCursor:r,restartBlink:function(t){if(!t.state.focused)return;let e=t.display;clearInterval(e.blinker);let i=!0;e.cursorDiv.style.visibility="",t.options.cursorBlinkRate>0?e.blinker=setInterval(()=>e.cursorDiv.style.visibility=(i=!i)?"":"hidden",t.options.cursorBlinkRate):t.options.cursorBlinkRate<0&&(e.cursorDiv.style.visibility="hidden")}}});
//# sourceMappingURL=../sourcemaps/display/selection.js.map
