/**
 * skylark-codemirror-base - A version of codemirror 5.45 core library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-codemirror-base/
 * @license MIT
 */
define(["../line/line_data","../line/utils_line","../util/browser","../util/dom","../util/operation_group"],function(e,t,l,n,r){"use strict";function i(e){return e.node==e.text&&(e.node=n.elt("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),l.ie&&l.ie_version<8&&(e.node.style.zIndex=2)),e.node}function s(t,l){let n=t.display.externalMeasured;return n&&n.line==l.line?(t.display.externalMeasured=null,l.measure=n.measure,n.built):e.buildLineContent(t,l)}function o(e,t){let l=t.text.className,n=s(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,a(e,t)):l&&(t.text.className=l)}function a(e,t){!function(e,t){let l=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(l&&(l+=" CodeMirror-linebackground"),t.background)l?t.background.className=l:(t.background.parentNode.removeChild(t.background),t.background=null);else if(l){let r=i(t);t.background=r.insertBefore(n.elt("div",null,l),r.firstChild),e.display.input.setUneditable(t.background)}}(e,t),t.line.wrapClass?i(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");let l=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=l||""}function d(e,l,r,s){if(l.gutter&&(l.node.removeChild(l.gutter),l.gutter=null),l.gutterBackground&&(l.node.removeChild(l.gutterBackground),l.gutterBackground=null),l.line.gutterClass){let t=i(l);l.gutterBackground=n.elt("div",null,"CodeMirror-gutter-background "+l.line.gutterClass,`left: ${e.options.fixedGutter?s.fixedPos:-s.gutterTotalWidth}px; width: ${s.gutterTotalWidth}px`),e.display.input.setUneditable(l.gutterBackground),t.insertBefore(l.gutterBackground,l.text)}let o=l.line.gutterMarkers;if(e.options.lineNumbers||o){let a=i(l),d=l.gutter=n.elt("div",null,"CodeMirror-gutter-wrapper",`left: ${e.options.fixedGutter?s.fixedPos:-s.gutterTotalWidth}px`);if(e.display.input.setUneditable(d),a.insertBefore(d,l.text),l.line.gutterClass&&(d.className+=" "+l.line.gutterClass),!e.options.lineNumbers||o&&o["CodeMirror-linenumbers"]||(l.lineNumber=d.appendChild(n.elt("div",t.lineNumberFor(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt",`left: ${s.gutterLeft["CodeMirror-linenumbers"]}px; width: ${e.display.lineNumInnerWidth}px`))),o)for(let t=0;t<e.options.gutters.length;++t){let l=e.options.gutters[t],r=o.hasOwnProperty(l)&&o[l];r&&d.appendChild(n.elt("div",[r],"CodeMirror-gutter-elt",`left: ${s.gutterLeft[l]}px; width: ${s.gutterWidth[l]}px`))}}}function u(e,t,l){t.alignable&&(t.alignable=null);for(let e,l=t.node.firstChild;l;l=e)e=l.nextSibling,"CodeMirror-linewidget"==l.className&&t.node.removeChild(l);g(e,t,l)}function g(e,t,l){if(p(e,t.line,t,l,!0),t.rest)for(let n=0;n<t.rest.length;n++)p(e,t.rest[n],t,l,!1)}function p(e,t,l,s,o){if(!t.widgets)return;let a=i(l);for(let i=0,d=t.widgets;i<d.length;++i){let t=d[i],u=n.elt("div",[t.node],"CodeMirror-linewidget");t.handleMouseEvents||u.setAttribute("cm-ignore-events","true"),C(t,u,l,s),e.display.input.setUneditable(u),o&&t.above?a.insertBefore(u,l.gutter||l.text):a.appendChild(u),r.signalLater(t,"redraw")}}function C(e,t,l,n){if(e.noHScroll){(l.alignable||(l.alignable=[])).push(t);let r=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(r-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=r+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}return{updateLineForChanges:function(e,t,l,n){for(let r=0;r<t.changes.length;r++){let i=t.changes[r];"text"==i?o(e,t):"gutter"==i?d(e,t,l,n):"class"==i?a(e,t):"widget"==i&&u(e,t,n)}t.changes=null},buildLineElement:function(e,t,l,n){let r=s(e,t);return t.text=t.node=r.pre,r.bgClass&&(t.bgClass=r.bgClass),r.textClass&&(t.textClass=r.textClass),a(e,t),d(e,t,l,n),g(e,t,n),t.node}}});
//# sourceMappingURL=../sourcemaps/display/update_line.js.map
