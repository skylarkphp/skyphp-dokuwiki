/**
 * skylark-codemirror-base - A version of codemirror 5.45 core library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-codemirror-base/
 * @license MIT
 */
define(["../display/selection","../display/operations","../line/pos","../measurement/position_measurement","../measurement/widgets","../model/changes","../model/change_measurement","../model/selection","../model/selection_updates","../util/browser","../util/dom","../util/event","../util/misc"],function(e,t,r,a,i,o,s,l,n,d,p,c,g){"use strict";let u=0;function f(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}return{onDrop:function(e){let i=this;if(f(i),c.signalDOMEvent(i,e)||e.eventInWidget(i.display,e))return;c.e_preventDefault(e),d.ie&&(u=+new Date);let p=a.posFromMouse(i,e,!0),m=e.dataTransfer.files;if(p&&!i.isReadOnly())if(m&&m.length&&window.FileReader&&window.File){let e=m.length,a=Array(e),n=0,d=(d,c)=>{if(i.options.allowDropFileTypes&&-1==g.indexOf(i.options.allowDropFileTypes,d.type))return;let u=new FileReader;u.onload=t.operation(i,()=>{let t=u.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(t)&&(t=""),a[c]=t,++n==e){let e={from:p=r.clipPos(i.doc,p),to:p,text:i.doc.splitLines(a.join(i.doc.lineSeparator())),origin:"paste"};o.makeChange(i.doc,e),c.setSelectionReplaceHistory(i.doc,l.simpleSelection(p,s.changeEnd(e)))}}),u.readAsText(d)};for(let t=0;t<e;++t)d(m[t],t)}else{if(i.state.draggingText&&i.doc.sel.contains(p)>-1)return i.state.draggingText(e),void setTimeout(()=>i.display.input.focus(),20);try{let t=e.dataTransfer.getData("Text");if(t){let e;if(i.state.draggingText&&!i.state.draggingText.copy&&(e=i.listSelections()),n.setSelectionNoUndo(i.doc,l.simpleSelection(p,p)),e)for(let t=0;t<e.length;++t)o.replaceRange(i.doc,"",e[t].anchor,e[t].head,"drag");i.replaceSelection(t,"around","paste"),i.display.input.focus()}}catch(e){}}},onDragStart:function(e,t){if(d.ie&&(!e.state.draggingText||+new Date-u<100))c.e_stop(t);else if(!c.signalDOMEvent(e,t)&&!t.eventInWidget(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!d.safari)){let r=p.elt("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",d.presto&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),d.presto&&r.parentNode.removeChild(r)}},onDragOver:function(t,r){let i=a.posFromMouse(t,r);if(!i)return;let o=document.createDocumentFragment();e.drawSelectionCursor(t,i,o),t.display.dragCursor||(t.display.dragCursor=p.elt("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),t.display.lineSpace.insertBefore(t.display.dragCursor,t.display.cursorDiv)),p.removeChildrenAndAdd(t.display.dragCursor,o)},clearDragCursor:f}});
//# sourceMappingURL=../sourcemaps/edit/drop_events.js.map
