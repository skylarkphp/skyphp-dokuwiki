/**
 * skylark-codemirror-base - A version of codemirror 5.45 core library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-codemirror-base/
 * @license MIT
 */
define(["../util/operation_group","../display/selection","../input/keymap","../measurement/widgets","../util/browser","../util/dom","../util/event","../util/feature_detection","../util/misc","./commands"],function(e,t,n,i,s,r,l,o,u,a){"use strict";function y(e,t,n){if("string"==typeof t&&!(t=a.commands[t]))return!1;e.display.input.ensurePolled();let i=e.display.shift,s=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),n&&(e.display.shift=!1),s=t(e)!=u.Pass}finally{e.display.shift=i,e.state.suppressEdits=!1}return s}let d=new u.Delayed;function f(e,t,i,s){let r=e.state.keySeq;if(r){if(n.isModifierKey(t))return"handled";if(/\'$/.test(t)?e.state.keySeq=null:d.set(50,()=>{e.state.keySeq==r&&(e.state.keySeq=null,e.display.input.reset())}),p(e,r+" "+t,i,s))return!0}return p(e,t,i,s)}function p(i,s,r,o){let u=function(e,t,i){for(let s=0;s<e.state.keyMaps.length;s++){let r=n.lookupKey(t,e.state.keyMaps[s],i,e);if(r)return r}return e.options.extraKeys&&n.lookupKey(t,e.options.extraKeys,i,e)||n.lookupKey(t,e.options.keyMap,i,e)}(i,s,o);return"multi"==u&&(i.state.keySeq=s),"handled"==u&&e.signalLater(i,"keyHandled",i,s,r),"handled"!=u&&"multi"!=u||(l.e_preventDefault(r),t.restartBlink(i)),!!u}function c(e,t){let i=n.keyName(t,!0);return!!i&&(t.shiftKey&&!e.state.keySeq?f(e,"Shift-"+i,t,t=>y(e,t,!0))||f(e,i,t,t=>{if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return y(e,t)}):f(e,i,t,t=>y(e,t)))}let h=null;return{dispatchKey:f,onKeyDown:function(e){let t=this;if(t.curOp.focus=r.activeElt(),l.signalDOMEvent(t,e))return;s.ie&&s.ie_version<11&&27==e.keyCode&&(e.returnValue=!1);let n=e.keyCode;t.display.shift=16==n||e.shiftKey;let i=c(t,e);s.presto&&(h=i?n:null,!i&&88==n&&!o.hasCopyEvent&&(s.mac?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),18!=n||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||function(e){let t=e.display.lineDiv;function n(e){18!=e.keyCode&&e.altKey||(r.rmClass(t,"CodeMirror-crosshair"),l.off(document,"keyup",n),l.off(document,"mouseover",n))}r.addClass(t,"CodeMirror-crosshair"),l.on(document,"keyup",n),l.on(document,"mouseover",n)}(t)},onKeyUp:function(e){16==e.keyCode&&(this.doc.sel.shift=!1),l.signalDOMEvent(this,e)},onKeyPress:function(e){let t=this;if(i.eventInWidget(t.display,e)||l.signalDOMEvent(t,e)||e.ctrlKey&&!e.altKey||s.mac&&e.metaKey)return;let n=e.keyCode,r=e.charCode;if(s.presto&&n==h)return h=null,void l.e_preventDefault(e);if(s.presto&&(!e.which||e.which<10)&&c(t,e))return;let o=String.fromCharCode(null==r?n:r);"\b"!=o&&(function(e,t,n){return f(e,"'"+n+"'",t,t=>y(e,t,!0))}(t,e,o)||t.display.input.onKeyPress(e))}}});
//# sourceMappingURL=../sourcemaps/edit/key_events.js.map
