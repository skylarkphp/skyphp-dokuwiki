/**
 * skylark-codemirror-base - A version of codemirror 5.45 core library that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-codemirror-base/
 * @license MIT
 */
define(["../line/pos","../measurement/position_measurement","../util/bidi","../util/misc"],function(e,t,r,n){"use strict";function l(e,t,r){let l=n.skipExtendingChars(e.text,t+r,r);return l<0||l>e.text.length?null:l}function i(t,r,n){let i=l(t,r.ch,n);return null==i?null:new e.Pos(r.line,i,n<0?"after":"before")}return{moveLogically:i,endOfLine:function(i,o,f,c,u){if(i){let i=r.getOrder(f,o.doc.direction);if(i){let r,s=u<0?n.lst(i):i[0],a=u<0==(1==s.level)?"after":"before";if(s.level>0||"rtl"==o.doc.direction){let e=t.prepareMeasureForLine(o,f);r=u<0?f.text.length-1:0;let i=t.measureCharPrepared(o,e,r).top;r=n.findFirst(r=>t.measureCharPrepared(o,e,r).top==i,u<0==(1==s.level)?s.from:s.to-1,r),"before"==a&&(r=l(f,r,1))}else r=u<0?s.to:s.from;return new e.Pos(c,r,a)}}return new e.Pos(c,u<0?f.text.length:0,u<0?"before":"after")},moveVisually:function(r,n,o,f){let c=c.getOrder(n,r.doc.direction);if(!c)return i(n,o,f);o.ch>=n.text.length?(o.ch=n.text.length,o.sticky="before"):o.ch<=0&&(o.ch=0,o.sticky="after");let u=c.getBidiPartAt(c,o.ch,o.sticky),s=c[u];if("ltr"==r.doc.direction&&s.level%2==0&&(f>0?s.to>o.ch:s.from<o.ch))return i(n,o,f);let a,d=(t,r)=>l(n,t instanceof e.Pos?t.ch:t,r),h=e=>r.options.lineWrapping?(a=a||t.prepareMeasureForLine(r,n),t.wrappedLineExtentChar(r,n,a,e)):{begin:0,end:n.text.length},g=h("before"==o.sticky?d(o,-1):o.ch);if("rtl"==r.doc.direction||1==s.level){let t=1==s.level==f<0,r=d(o,t?1:-1);if(null!=r&&(t?r<=s.to&&r<=g.end:r>=s.from&&r>=g.begin)){let n=t?"before":"after";return new e.Pos(o.line,r,n)}}let p=(t,r,n)=>{let l=(t,r)=>r?new e.Pos(o.line,d(t,1),"before"):new e.Pos(o.line,t,"after");for(;t>=0&&t<c.length;t+=r){let e=c[t],i=r>0==(1!=e.level),o=i?n.begin:d(n.end,-1);if(e.from<=o&&o<e.to)return l(o,i);if(o=i?e.from:d(e.to,-1),n.begin<=o&&o<n.end)return l(o,i)}},m=p(u+f,f,g);if(m)return m;let b=f>0?g.end:d(g.begin,-1);return null==b||f>0&&b==n.text.length||!(m=p(f>0?0:c.length-1,f,h(b)))?null:m}}});
//# sourceMappingURL=../sourcemaps/input/movement.js.map
