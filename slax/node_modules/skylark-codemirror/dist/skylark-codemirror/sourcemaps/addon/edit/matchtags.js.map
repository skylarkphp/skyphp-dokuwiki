{"version":3,"sources":["addon/edit/matchtags.js"],"names":["mod","exports","module","require","define","amd","CodeMirror","clear","cm","state","tagHit","tagOther","doMatchTags","failedTagMatch","operation","somethingSelected","cur","getCursor","range","getViewport","from","Math","min","line","to","max","match","findMatchingTag","matchBothTags","hit","at","open","close","markText","className","other","maybeUpdateMatch","defineOption","val","old","Init","off","bothTags","on","commands","toMatchingTag","found","extendSelection"],"mappings":";;;;;;;CAGA,SAAUA,GACc,iBAAXC,SAAwC,iBAAVC,OACvCF,EAAIG,QAAQ,wBAAyBA,QAAQ,qBACrB,mBAAVC,QAAwBA,OAAOC,IAC7CD,QAAQ,uBAAwB,oBAAqBJ,GAErDA,EAAIM,YANR,CAOG,SAASA,GACV,aAgBA,SAASC,EAAMC,GACTA,EAAGC,MAAMC,QAAQF,EAAGC,MAAMC,OAAOH,QACjCC,EAAGC,MAAME,UAAUH,EAAGC,MAAME,SAASJ,QACzCC,EAAGC,MAAMC,OAASF,EAAGC,MAAME,SAAW,KAGxC,SAASC,EAAYJ,GACnBA,EAAGC,MAAMI,gBAAiB,EAC1BL,EAAGM,UAAU,WAEX,GADAP,EAAMC,IACFA,EAAGO,oBAAP,CACA,IAAIC,EAAMR,EAAGS,YAAaC,EAAQV,EAAGW,cACrCD,EAAME,KAAOC,KAAKC,IAAIJ,EAAME,KAAMJ,EAAIO,MAAOL,EAAMM,GAAKH,KAAKI,IAAIT,EAAIO,KAAO,EAAGL,EAAMM,IACrF,IAAIE,EAAQpB,EAAWqB,gBAAgBnB,EAAIQ,EAAKE,GAChD,GAAKQ,EAAL,CACA,GAAIlB,EAAGC,MAAMmB,cAAe,CAC1B,IAAIC,EAAkB,QAAZH,EAAMI,GAAeJ,EAAMK,KAAOL,EAAMM,MAC9CH,IAAKrB,EAAGC,MAAMC,OAASF,EAAGyB,SAASJ,EAAIT,KAAMS,EAAIL,IAAKU,UAAW,4BAEvE,IAAIC,EAAoB,SAAZT,EAAMI,GAAgBJ,EAAMK,KAAOL,EAAMM,MACjDG,EACF3B,EAAGC,MAAME,SAAWH,EAAGyB,SAASE,EAAMf,KAAMe,EAAMX,IAAKU,UAAW,2BAElE1B,EAAGC,MAAMI,gBAAiB,MAIhC,SAASuB,EAAiB5B,GACpBA,EAAGC,MAAMI,gBAAgBD,EAAYJ,GA1C3CF,EAAW+B,aAAa,aAAa,EAAO,SAAS7B,EAAI8B,EAAKC,GACxDA,GAAOA,GAAOjC,EAAWkC,OAC3BhC,EAAGiC,IAAI,iBAAkB7B,GACzBJ,EAAGiC,IAAI,iBAAkBL,GACzB7B,EAAMC,IAEJ8B,IACF9B,EAAGC,MAAMmB,cAA8B,iBAAPU,GAAmBA,EAAII,SACvDlC,EAAGmC,GAAG,iBAAkB/B,GACxBJ,EAAGmC,GAAG,iBAAkBP,GACxBxB,EAAYJ,MAmChBF,EAAWsC,SAASC,cAAgB,SAASrC,GAC3C,IAAIsC,EAAQxC,EAAWqB,gBAAgBnB,EAAIA,EAAGS,aAC9C,GAAI6B,EAAO,CACT,IAAIX,EAAoB,SAAZW,EAAMhB,GAAgBgB,EAAMf,KAAOe,EAAMd,MACjDG,GAAO3B,EAAGuC,gBAAgBZ,EAAMX,GAAIW,EAAMf","file":"../../../addon/edit/matchtags.js","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"), require(\"../fold/xml-fold\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\", \"../fold/xml-fold\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n\n  CodeMirror.defineOption(\"matchTags\", false, function(cm, val, old) {\n    if (old && old != CodeMirror.Init) {\n      cm.off(\"cursorActivity\", doMatchTags);\n      cm.off(\"viewportChange\", maybeUpdateMatch);\n      clear(cm);\n    }\n    if (val) {\n      cm.state.matchBothTags = typeof val == \"object\" && val.bothTags;\n      cm.on(\"cursorActivity\", doMatchTags);\n      cm.on(\"viewportChange\", maybeUpdateMatch);\n      doMatchTags(cm);\n    }\n  });\n\n  function clear(cm) {\n    if (cm.state.tagHit) cm.state.tagHit.clear();\n    if (cm.state.tagOther) cm.state.tagOther.clear();\n    cm.state.tagHit = cm.state.tagOther = null;\n  }\n\n  function doMatchTags(cm) {\n    cm.state.failedTagMatch = false;\n    cm.operation(function() {\n      clear(cm);\n      if (cm.somethingSelected()) return;\n      var cur = cm.getCursor(), range = cm.getViewport();\n      range.from = Math.min(range.from, cur.line); range.to = Math.max(cur.line + 1, range.to);\n      var match = CodeMirror.findMatchingTag(cm, cur, range);\n      if (!match) return;\n      if (cm.state.matchBothTags) {\n        var hit = match.at == \"open\" ? match.open : match.close;\n        if (hit) cm.state.tagHit = cm.markText(hit.from, hit.to, {className: \"CodeMirror-matchingtag\"});\n      }\n      var other = match.at == \"close\" ? match.open : match.close;\n      if (other)\n        cm.state.tagOther = cm.markText(other.from, other.to, {className: \"CodeMirror-matchingtag\"});\n      else\n        cm.state.failedTagMatch = true;\n    });\n  }\n\n  function maybeUpdateMatch(cm) {\n    if (cm.state.failedTagMatch) doMatchTags(cm);\n  }\n\n  CodeMirror.commands.toMatchingTag = function(cm) {\n    var found = CodeMirror.findMatchingTag(cm, cm.getCursor());\n    if (found) {\n      var other = found.at == \"close\" ? found.open : found.close;\n      if (other) cm.extendSelection(other.to, other.from);\n    }\n  };\n});\n"]}