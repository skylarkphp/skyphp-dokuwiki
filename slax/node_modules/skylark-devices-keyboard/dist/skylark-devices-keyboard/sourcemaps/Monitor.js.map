{"version":3,"sources":["Monitor.js"],"names":["define","klass","keyboard","KeyState","Monitor","_construct","dontInitialize","this","keyStates","actions","self","handlers","keydown","event","push","keyCode","Key","DOWN","keyup","UP","focus","reset","create","update","end","length","key","shift","action","undefined","justReleased","justPressed","RESET","i","keyPressed","pressed","keyJustPressed","keyJustReleased","window","addEventListener","dispose","removeEventListener"],"mappings":";;;;;;;AAAAA,QACC,sBACA,aACA,cACC,SACDC,EACAC,EACAC,GAEA,aAWA,IAAIC,EAAUH,GACbI,WAAa,SAAUC,GAOtBC,KAAKC,aAaLD,KAAKE,WAEL,IAAIC,EAAOH,KACPE,EAAUF,KAAKE,QA2BnBF,KAAKI,UACJC,QAAY,SAASC,GACjBJ,EAAQK,KAAKD,EAAME,SACnBN,EAAQK,KAAKE,IAAIC,OAErBC,MAAU,SAASL,GACfJ,EAAQK,KAAKD,EAAME,SACnBN,EAAQK,KAAKE,IAAIG,KAErBC,MAAU,SAASP,GACfH,EAAKW,WAMY,IAAnBf,GAEFC,KAAKe,UAWPC,OAAS,WAGR,IAFA,IAAIC,EAAM,EAEJjB,KAAKE,QAAQgB,OAASD,GAC5B,CACC,IAAIE,EAAMnB,KAAKE,QAAQkB,QACnBC,EAASrB,KAAKE,QAAQkB,aAECE,IAAxBtB,KAAKC,UAAUkB,KAEjBnB,KAAKC,UAAUkB,GAAO,IAAIV,KAG3BT,KAAKC,UAAUkB,GAAKH,OAAOK,IAExBrB,KAAKC,UAAUkB,GAAKI,cAAgBvB,KAAKC,UAAUkB,GAAKK,eAE1DxB,KAAKE,QAAQK,KAAKY,GAClBnB,KAAKE,QAAQK,KAAKE,IAAIgB,OACtBR,GAAO,KAYVH,MAAQ,WAEP,IAAI,IAAIY,EAAI,EAAGA,EAAI1B,KAAKC,UAAUiB,OAAQQ,SAEhBJ,IAAtBtB,KAAKC,UAAUyB,IAEjB1B,KAAKC,UAAUyB,GAAGZ,SAWrBa,WAAa,SAASR,GACrB,YAA+BG,IAAxBtB,KAAKC,UAAUkB,IAAsBnB,KAAKC,UAAUkB,GAAKS,SASjEC,eAAiB,SAASV,GACzB,YAA+BG,IAAxBtB,KAAKC,UAAUkB,IAAsBnB,KAAKC,UAAUkB,GAAKK,aASjEM,gBAAkB,SAASX,GAC1B,YAA+BG,IAAxBtB,KAAKC,UAAUkB,IAAsBnB,KAAKC,UAAUkB,GAAKI,cASjER,OAAS,WAER,IAAK,IAAIT,KAASN,KAAKI,SACtB2B,OAAOC,iBAAiB1B,EAAMN,KAAKI,SAASE,KAS9C2B,QAAU,WAET,IAAK,IAAI3B,KAASN,KAAKI,SACtB2B,OAAOG,oBAAoB5B,EAAMN,KAAKI,SAASE,OAOlD,OAAOX,EAASE,QAAWA","file":"../Monitor.js","sourcesContent":["define([\r\n\t\"skylark-langx-klass\",\r\n\t\"./keyboard\",\r\n\t\"./KeyState\"\r\n],function(\r\n\tklass,\r\n\tkeyboard,\r\n\tKeyState\r\n){\r\n\t\"use strict\";\r\n\r\n\t/**\r\n\t * Keyboard instance for input in sync with the running 3D application.\r\n\t * \r\n\t * The keyboard object provided by scripts is automatically updated by the runtime handler.\r\n\t * \r\n\t * @class Keyboard\r\n\t * @module Input\r\n\t * @param {Boolean} dontInitialize If true the mouse events are not created.\r\n\t */\r\n\tvar Monitor = klass({\r\n\t\t_construct : function (dontInitialize) \t{\r\n\t\t\t/**\r\n\t\t\t * Array with keyboard keys status.\r\n\t\t\t *\r\n\t\t\t * @property keyStates\r\n\t\t\t * @type {Array}\r\n\t\t\t */\r\n\t\t\tthis.keyStates = [];\r\n\r\n\r\n\t\t\t/**\r\n\t\t\t * The actions array serves as a buffer for the key input actions.\r\n\t\t\t *\r\n\t\t\t * Until the update method is called it stores all the key stroke actions.\r\n\t\t\t *\r\n\t\t\t * On update the key strokes are updated and the keys array stores the correct values.\r\n\t\t\t *\r\n\t\t\t * @property actions\r\n\t\t\t * @type {Array}\r\n\t\t\t */\r\n\t\t\tthis.actions = [];\r\n\r\n\t\t\tvar self = this;\r\n\t\t\tvar actions = this.actions;\r\n\r\n\t\t\t/**\r\n\t\t\t * Event manager used to handle the keyup, keydown and focus events.\r\n\t\t\t *\r\n\t\t\t * On each event actions are added to the actions array.\r\n\t\t\t *\r\n\t\t\t * @property events\r\n\t\t\t * @type {EventManager}\r\n\t\t\t */\r\n\t\t\t//this.events = new EventManager();\r\n\t\t\t/*\r\n\t\t\tthis.events.add(window, \"keydown\", function(event)\r\n\t\t\t{\r\n\t\t\t\tactions.push(event.keyCode);\r\n\t\t\t\tactions.push(Key.DOWN);\r\n\t\t\t});\r\n\t\t\tthis.events.add(window, \"keyup\", function(event)\r\n\t\t\t{\r\n\t\t\t\tactions.push(event.keyCode);\r\n\t\t\t\tactions.push(Key.UP);\r\n\t\t\t});\r\n\t\t\tthis.events.add(window, \"focus\", function(event)\r\n\t\t\t{\r\n\t\t\t\tself.reset();\r\n\t\t\t});\r\n\t\t\t*/\r\n\t\t\tthis.handlers = {\r\n\t\t\t\t\"keydown\" : function(event) {\r\n\t\t\t\t\t\t\t\tactions.push(event.keyCode);\r\n\t\t\t\t\t\t\t\tactions.push(Key.DOWN);\r\n\t\t\t\t\t\t\t},\t\t\t\r\n\t\t\t\t\"keyup\" : function(event) {\r\n\t\t\t\t\t\t\t\tactions.push(event.keyCode);\r\n\t\t\t\t\t\t\t\tactions.push(Key.UP);\r\n\t\t\t\t\t\t\t},\t\t\t\r\n\t\t\t\t\"focus\" : function(event) {\r\n\t\t\t\t\t\t\t\tself.reset();\r\n\t\t\t\t\t\t\t},\t\t\t\r\n\r\n\r\n\t\t\t};\r\n\r\n\t\t\tif(dontInitialize !== true)\r\n\t\t\t{\r\n\t\t\t\tthis.create();\r\n\t\t\t}\r\n\r\n\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Update key flags synchronously.\r\n\t\t * \r\n\t\t * @method update\r\n\t\t */\r\n\t\tupdate : function() \t{\r\n\t\t\tvar end = 0;\r\n\r\n\t\t\twhile(this.actions.length > end)\r\n\t\t\t{\r\n\t\t\t\tvar key = this.actions.shift();\r\n\t\t\t\tvar action = this.actions.shift();\r\n\r\n\t\t\t\tif(this.keyStates[key] === undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.keyStates[key] = new Key();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.keyStates[key].update(action);\r\n\r\n\t\t\t\tif(this.keyStates[key].justReleased || this.keyStates[key].justPressed)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.actions.push(key);\r\n\t\t\t\t\tthis.actions.push(Key.RESET);\r\n\t\t\t\t\tend += 2;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Reset keyboard status to default.\r\n\t\t *\r\n\t\t * Does not clean the action list.\r\n\t\t * \r\n\t\t * @method reset\r\n\t\t */\r\n\t\treset : function() {\r\n\t\t\t//Reset all keys\r\n\t\t\tfor(var i = 0; i < this.keyStates.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif(this.keyStates[i] !== undefined)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.keyStates[i].reset();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Check if a key is pressed.\r\n\t\t * \r\n\t\t * @method keyPressed\r\n\t\t * @return {boolean} True is the key is currently pressed\r\n\t\t */\r\n\t\tkeyPressed : function(key){\r\n\t\t\treturn this.keyStates[key] !== undefined && this.keyStates[key].pressed;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Check is a key as just pressed.\r\n\t\t * \r\n\t\t * @method keyJustPressed\r\n\t\t * @return {boolean} True is the key was just pressed\r\n\t\t */\r\n\t\tkeyJustPressed : function(key){\r\n\t\t\treturn this.keyStates[key] !== undefined && this.keyStates[key].justPressed;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Check if a key was just released.\r\n\t\t * \r\n\t\t * @method keyJustReleased\r\n\t\t * @return {boolean} True is the key was just pressed\r\n\t\t */\r\n\t\tkeyJustReleased : function(key){\r\n\t\t\treturn this.keyStates[key] !== undefined && this.keyStates[key].justReleased;\r\n\t\t},\r\n\r\n\r\n\t\t/**\r\n\t\t * Create keyboard events.\r\n\t\t * \r\n\t\t * @method dispose\r\n\t\t */\r\n\t\tcreate : function(){\r\n\t\t\t//this.events.create();\r\n\t\t\tfor (var event in this.handlers) {\r\n\t\t\t\twindow.addEventListener(event,this.handlers[event]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Dispose keyboard events.\r\n\t\t * \r\n\t\t * @method dispose\r\n\t\t */\r\n\t\tdispose : function()\t{\r\n\t\t\t//this.events.destroy();\r\n\t\t\tfor (var event in this.handlers) {\r\n\t\t\t\twindow.removeEventListener(event,this.handlers[event]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t});\r\n\r\n\r\n\treturn keyboard.Monitor =  Monitor;\r\n});"]}