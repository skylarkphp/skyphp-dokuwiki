{"version":3,"sources":["Util.js"],"names":["define","langx","$","contents","os","chrome","edge","firefox","ie","ref","ref1","ref2","ref3","ref4","safari","ua","Util","Evented","inherit","init","editor","opts","this","extend","browser","msie","version","phBr","pluginName","prototype","test","navigator","appVersion","mac","linux","win","unix","mobile","userAgent","match","webkit","mozilla","support","onselectionchange","document","_error","oninput","reflow","el","offsetHeight","metaKey","e","ctrlKey","isEmptyNode","node","$node","is","text","find","length","isDecoratedNode","classPrefix","blockNodes","isBlockNode","nodeType","RegExp","join","nodeName","toLowerCase","getNodeLength","childNodes","dataURLtoBlob","dataURL","BlobBuilder","arrayBuffer","bb","byteString","hasArrayBufferViewSupport","hasBlobConstructor","i","intArray","k","mimeString","window","Blob","Boolean","Uint8Array","size","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","atob","ArrayBuffer","split","indexOf","decodeURIComponent","charCodeAt","type","append","getBlob","throttle","func","wait","args","call","ctx","last","rtn","throttled","timeoutID","Date","apply","delta","arguments","setTimeout","clear","clearTimeout","formatHTML","html","cursor","lastMatch","level","re","repeatString","result","str","n","Array","exec","inArray","isStartTag","isEndTag","index","substring","trim"],"mappings":";;;;;;;AAAAA,QACE,sBACA,qBACA,cACA,SAASC,EAAMC,EAAEC,GAEjB,IAgBMC,EAkBAC,EAAQC,EAAMC,EAASC,EAAIC,EAAKC,EAAMC,EAAMC,EAAMC,EAAMC,EAAQC,EAlClEC,EAAOf,EAAMgB,QAAQC,SACvBC,KAAO,SAASC,EAAOC,GAGrB,GAFAC,KAAKF,OAASA,EACdE,KAAKD,KAAOpB,EAAMsB,UAAWD,KAAKD,KAAMA,GACpCC,KAAKE,QAAQC,MAAQH,KAAKE,QAAQE,QAAU,GAC9C,OAAOJ,KAAKK,KAAO,MA0QzB,OApQAX,EAAKY,WAAa,OAElBZ,EAAKa,UAAUF,KAAO,QAEtBX,EAAKa,UAAUzB,IAEbA,KACI,MAAM0B,KAAKC,UAAUC,YACvB5B,EAAG6B,KAAM,EACA,QAAQH,KAAKC,UAAUC,YAChC5B,EAAG8B,OAAQ,EACF,MAAMJ,KAAKC,UAAUC,YAC9B5B,EAAG+B,KAAM,EACA,MAAML,KAAKC,UAAUC,cAC9B5B,EAAGgC,MAAO,GAER,OAAON,KAAKC,UAAUC,cACxB5B,EAAGiC,QAAS,GAEPjC,GAGTY,EAAKa,UAAUL,SAEbT,EAAKgB,UAAUO,UACf9B,EAAK,kBAAkBsB,KAAKf,GAC5BV,EAAS,gBAAgByB,KAAKf,GAC9BD,EAAS,UAAUgB,KAAKf,KAAQV,EAChCE,EAAU,WAAWuB,KAAKf,GAC1BT,EAAO,QAAQwB,KAAKf,GAChBP,GAEAiB,MAAM,EACNC,QAAqF,GAA1B,OAAhDjB,EAAMM,EAAGwB,MAAM,8BAAwC9B,EAAI,QAAK,IAEpEH,GAEPA,MAAM,EACNkC,QAAQ,EACRd,QAAkF,GAA3B,OAA5ChB,EAAOK,EAAGwB,MAAM,yBAAmC7B,EAAK,QAAK,IAEjEL,GAEPmC,QAAQ,EACRnC,QAAQ,EACRqB,QAA8F,GAA3B,OAAxDf,EAAOI,EAAGwB,MAAM,qCAA+C5B,EAAK,QAAK,IAE7EG,GAEP0B,QAAQ,EACR1B,QAAQ,EACRY,QAAqF,GAA3B,OAA/Cd,EAAOG,EAAGwB,MAAM,4BAAsC3B,EAAK,QAAK,IAEpEL,GAEPkC,SAAS,EACTlC,SAAS,EACTmB,QAAqF,GAA3B,OAA/Cb,EAAOE,EAAGwB,MAAM,4BAAsC1B,EAAK,QAAK,QAOjFG,EAAKa,UAAUa,SAEXC,kBAAmB,WACjB,IAAOA,EAEP,QAA0B,KAD1BA,EAAoBC,SAASD,mBAE3B,IAEE,OADAC,SAASD,kBAAoB,EACS,OAA/BC,SAASD,kBAChB,MAAOE,IAEP,QACAD,SAASD,kBAAoBA,EAGjC,OAAO,EAbU,GAenBG,SACU,kBAAkBhB,KAAKC,UAAUO,YAK/CtB,EAAKa,UAAUkB,OAAS,SAASC,GAI/B,OAHU,MAANA,IACFA,EAAKJ,UAEA1C,EAAE8C,GAAI,GAAGC,cAGlBjC,EAAKa,UAAUqB,QAAU,SAASC,GAGhC,MADQ,MAAMrB,KAAKC,UAAUO,WAEpBa,EAAED,QAEFC,EAAEC,SAIbpC,EAAKa,UAAUwB,YAAc,SAASC,GACpC,IAAIC,EAEJ,OADAA,EAAQrD,EAAEoD,IACGE,GAAG,YAAeD,EAAME,SAAWF,EAAMG,KAAK,uBAAuBC,QAGpF3C,EAAKa,UAAU+B,gBAAkB,SAASN,GACxC,OAAOpD,EAAEoD,GAAME,GAAG,YAAclC,KAAKD,KAAKwC,YAAc,OAG1D7C,EAAKa,UAAUiC,YAAc,MAAO,IAAK,KAAM,KAAM,KAAM,aAAc,KAAM,MAAO,KAAM,KAAM,KAAM,KAAM,KAAM,SAEpH9C,EAAKa,UAAUkC,YAAc,SAAST,GAEpC,UADAA,EAAOpD,EAAEoD,GAAM,KACgB,IAAlBA,EAAKU,WAGX,IAAIC,OAAO,KAAQ3C,KAAKwC,WAAWI,KAAK,KAAQ,MAAMpC,KAAKwB,EAAKa,SAASC,gBAGlFpD,EAAKa,UAAUwC,cAAgB,SAASf,GAEtC,QADAA,EAAOpD,EAAEoD,GAAM,IACFU,UACX,KAAK,EACL,KAAK,GACH,OAAO,EACT,KAAK,EACL,KAAK,EACH,OAAOV,EAAKK,OACd,QACE,OAAOL,EAAKgB,WAAWX,SAI7B3C,EAAKa,UAAU0C,cAAgB,SAASC,GACtC,IAAIC,EAAaC,EAAaC,EAAeC,EAAYC,EAA2BC,EAAoBC,EAAGC,EAAUC,EAAGC,EAAYzE,EAqBpI,GAXAoE,GATAC,EAAqBK,OAAOC,MAAQ,WAElC,IACE,OAAOC,QAAQ,IAAID,MACnB,MAAOvC,GAEP,OADIA,GACG,GANyB,KAScsC,OAAOG,YAAc,WAErE,IACE,OAAgD,MAAzC,IAAIF,MAAM,IAAIE,WAAW,OAAOC,KACvC,MAAO1C,GAEP,OADIA,GACG,GAN4D,GASvE4B,EAAcU,OAAOV,aAAeU,OAAOK,mBAAqBL,OAAOM,gBAAkBN,OAAOO,iBAClFZ,GAAsBL,IACfU,OAAOQ,MAAQR,OAAOS,aAAeT,OAAOG,YAC/D,OAAO,EAST,IANEV,EADEJ,EAAQqB,MAAM,KAAK,GAAGC,QAAQ,WAAa,EAChCH,KAAKnB,EAAQqB,MAAM,KAAK,IAExBE,mBAAmBvB,EAAQqB,MAAM,KAAK,IAErDnB,EAAc,IAAIkB,YAAYhB,EAAWjB,QACzCqB,EAAW,IAAIM,WAAWZ,GACrBK,EAAIE,EAAI,EAAGxE,EAAMmE,EAAWjB,OAAQ,GAAKlD,EAAMwE,GAAKxE,EAAMwE,GAAKxE,EAAKsE,EAAI,GAAKtE,IAAQwE,IAAMA,EAC9FD,EAASD,GAAKH,EAAWoB,WAAWjB,GAGtC,OADAG,EAAaV,EAAQqB,MAAM,KAAK,GAAGA,MAAM,KAAK,GAAGA,MAAM,KAAK,GACxDf,EAEK,IAAIM,MADCP,EAA4BG,EAAWN,IAEjDuB,KAAMf,MAGVP,EAAK,IAAIF,GACNyB,OAAOxB,GACHC,EAAGwB,QAAQjB,KAGpBlE,EAAKa,UAAUuE,SAAW,SAASC,EAAMC,GACvC,IAAIC,EAAMC,EAAMC,EAAKC,EAAMC,EAAKC,EAAWC,EAgC3C,OA/BAH,EAAO,EACPG,EAAY,EACZJ,EAAMF,EAAOI,EAAM,KACnBH,EAAO,WAKL,OAJAK,EAAY,EACZH,GAAQ,IAAII,KACZH,EAAMN,EAAKU,MAAMN,EAAKF,GACtBE,EAAM,KACCF,EAAO,OAEhBK,EAAY,WACV,IAAII,EAWJ,OAVAP,EAAMnF,KACNiF,EAAOU,UACPD,EAAQ,IAAIF,KAASJ,EAChBG,IACCG,GAASV,EACXE,IAEAK,EAAYK,WAAWV,EAAMF,EAAOU,IAGjCL,IAECQ,MAAQ,WAChB,GAAKN,EAIL,OADAO,aAAaP,GACNL,KAEFI,GAGT5F,EAAKa,UAAUwF,WAAa,SAASC,GACnC,IAAIC,EAAsBC,EAAWC,EAAOlF,EAAOmF,EAAIC,EAAcC,EAAQC,EAS7E,IARAH,EAAK,qBACLE,EAAS,GACTH,EAAQ,EACRD,EAAY,KACG,KACfG,EAAe,SAASE,EAAKC,GAC3B,OAAO,IAAIC,MAAMD,EAAI,GAAG5D,KAAK2D,IAEI,QAA3BtF,EAAQmF,EAAGM,KAAKV,KACtB/E,EAAMwB,YAAc9D,EAAMgI,QAAQ1F,EAAM,GAAIjB,KAAKwC,aAAe,EAChEvB,EAAM2F,WAA0B,MAAb3F,EAAM,IAA2B,MAAbA,EAAM,GAC7CA,EAAM4F,SAAwB,MAAb5F,EAAM,IAA2B,MAAbA,EAAM,GAC3CgF,EAASC,EAAYA,EAAUY,MAAQZ,EAAU,GAAG7D,OAAS,GACxDkE,EAAMP,EAAKe,UAAUd,EAAQhF,EAAM6F,QAAQzE,OAAS,GAAK1D,EAAMqI,KAAKT,KACvED,GAAUC,GAERtF,EAAMwB,aAAexB,EAAM4F,WAAa5F,EAAM2F,aAChDT,GAAS,GAEPlF,EAAMwB,aAAexB,EAAM2F,aACvBV,GAAaA,EAAUzD,aAAeyD,EAAUW,WACpDP,GAAU,MAEZA,GAAUD,EAnBC,KAmB0BF,IAEvCG,GAAUrF,EAAM,GACZA,EAAMwB,aAAexB,EAAM4F,WAC7BP,GAAU,MAERrF,EAAMwB,aAAexB,EAAM2F,aAC7BT,GAAS,GAEXD,EAAYjF,EAEd,OAAOtC,EAAMqI,KAAKV,IAGbzH,EAASa,KAAOA","file":"../Util.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-query\",\r\n  \"./contents\"\r\n],function(langx,$,contents){ \r\n\r\n  var Util = langx.Evented.inherit({\r\n    init : function(editor,opts) {\r\n      this.editor = editor; // this._module;\r\n      this.opts = langx.extend({}, this.opts, opts);\r\n      if (this.browser.msie && this.browser.version < 11) {\r\n        return this.phBr = '';\r\n      }\r\n    }\r\n\r\n  });\r\n\r\n  Util.pluginName = 'Util';\r\n\r\n  Util.prototype.phBr = '<br/>';\r\n\r\n  Util.prototype.os = (function() {\r\n    var os;\r\n    os = {};\r\n    if (/Mac/.test(navigator.appVersion)) {\r\n      os.mac = true;\r\n    } else if (/Linux/.test(navigator.appVersion)) {\r\n      os.linux = true;\r\n    } else if (/Win/.test(navigator.appVersion)) {\r\n      os.win = true;\r\n    } else if (/X11/.test(navigator.appVersion)) {\r\n      os.unix = true;\r\n    }\r\n    if (/Mobi/.test(navigator.appVersion)) {\r\n      os.mobile = true;\r\n    }\r\n    return os;\r\n  })();\r\n\r\n  Util.prototype.browser = (function() {\r\n    var chrome, edge, firefox, ie, ref, ref1, ref2, ref3, ref4, safari, ua;\r\n    ua = navigator.userAgent;\r\n    ie = /(msie|trident)/i.test(ua);\r\n    chrome = /chrome|crios/i.test(ua);\r\n    safari = /safari/i.test(ua) && !chrome;\r\n    firefox = /firefox/i.test(ua);\r\n    edge = /edge/i.test(ua);\r\n    if (ie) {\r\n      return {\r\n        msie: true,\r\n        version: ((ref = ua.match(/(msie |rv:)(\\d+(\\.\\d+)?)/i)) != null ? ref[2] : void 0) * 1\r\n      };\r\n    } else if (edge) {\r\n      return {\r\n        edge: true,\r\n        webkit: true,\r\n        version: ((ref1 = ua.match(/edge\\/(\\d+(\\.\\d+)?)/i)) != null ? ref1[1] : void 0) * 1\r\n      };\r\n    } else if (chrome) {\r\n      return {\r\n        webkit: true,\r\n        chrome: true,\r\n        version: ((ref2 = ua.match(/(?:chrome|crios)\\/(\\d+(\\.\\d+)?)/i)) != null ? ref2[1] : void 0) * 1\r\n      };\r\n    } else if (safari) {\r\n      return {\r\n        webkit: true,\r\n        safari: true,\r\n        version: ((ref3 = ua.match(/version\\/(\\d+(\\.\\d+)?)/i)) != null ? ref3[1] : void 0) * 1\r\n      };\r\n    } else if (firefox) {\r\n      return {\r\n        mozilla: true,\r\n        firefox: true,\r\n        version: ((ref4 = ua.match(/firefox\\/(\\d+(\\.\\d+)?)/i)) != null ? ref4[1] : void 0) * 1\r\n      };\r\n    } else {\r\n      return {};\r\n    }\r\n  })();\r\n\r\n  Util.prototype.support = (function() {\r\n    return {\r\n      onselectionchange: (function() {\r\n        var e, onselectionchange;\r\n        onselectionchange = document.onselectionchange;\r\n        if (onselectionchange !== void 0) {\r\n          try {\r\n            document.onselectionchange = 0;\r\n            return document.onselectionchange === null;\r\n          } catch (_error) {\r\n            e = _error;\r\n          } finally {\r\n            document.onselectionchange = onselectionchange;\r\n          }\r\n        }\r\n        return false;\r\n      })(),\r\n      oninput: (function() {\r\n        return !/(msie|trident)/i.test(navigator.userAgent);\r\n      })()\r\n    };\r\n  })();\r\n\r\n  Util.prototype.reflow = function(el) {\r\n    if (el == null) {\r\n      el = document;\r\n    }\r\n    return $(el)[0].offsetHeight;\r\n  };\r\n\r\n  Util.prototype.metaKey = function(e) {\r\n    var isMac;\r\n    isMac = /Mac/.test(navigator.userAgent);\r\n    if (isMac) {\r\n      return e.metaKey;\r\n    } else {\r\n      return e.ctrlKey;\r\n    }\r\n  };\r\n\r\n  Util.prototype.isEmptyNode = function(node) {\r\n    var $node;\r\n    $node = $(node);\r\n    return $node.is(':empty') || (!$node.text() && !$node.find(':not(br, span, div)').length);\r\n  };\r\n\r\n  Util.prototype.isDecoratedNode = function(node) {\r\n    return $(node).is('[class^=\"' + this.opts.classPrefix + '\"]');\r\n  };\r\n\r\n  Util.prototype.blockNodes = [\"div\", \"p\", \"ul\", \"ol\", \"li\", \"blockquote\", \"hr\", \"pre\", \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"table\"];\r\n\r\n  Util.prototype.isBlockNode = function(node) {\r\n    node = $(node)[0];\r\n    if (!node || node.nodeType === 3) {\r\n      return false;\r\n    }\r\n    return new RegExp(\"^(\" + (this.blockNodes.join('|')) + \")$\").test(node.nodeName.toLowerCase());\r\n  };\r\n\r\n  Util.prototype.getNodeLength = function(node) {\r\n    node = $(node)[0];\r\n    switch (node.nodeType) {\r\n      case 7:\r\n      case 10:\r\n        return 0;\r\n      case 3:\r\n      case 8:\r\n        return node.length;\r\n      default:\r\n        return node.childNodes.length;\r\n    }\r\n  };\r\n\r\n  Util.prototype.dataURLtoBlob = function(dataURL) {\r\n    var BlobBuilder, arrayBuffer, bb, blobArray, byteString, hasArrayBufferViewSupport, hasBlobConstructor, i, intArray, k, mimeString, ref, supportBlob;\r\n    hasBlobConstructor = window.Blob && (function() {\r\n      var e;\r\n      try {\r\n        return Boolean(new Blob());\r\n      } catch (_error) {\r\n        e = _error;\r\n        return false;\r\n      }\r\n    })();\r\n    hasArrayBufferViewSupport = hasBlobConstructor && window.Uint8Array && (function() {\r\n      var e;\r\n      try {\r\n        return new Blob([new Uint8Array(100)]).size === 100;\r\n      } catch (_error) {\r\n        e = _error;\r\n        return false;\r\n      }\r\n    })();\r\n    BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder;\r\n    supportBlob = hasBlobConstructor || BlobBuilder;\r\n    if (!(supportBlob && window.atob && window.ArrayBuffer && window.Uint8Array)) {\r\n      return false;\r\n    }\r\n    if (dataURL.split(',')[0].indexOf('base64') >= 0) {\r\n      byteString = atob(dataURL.split(',')[1]);\r\n    } else {\r\n      byteString = decodeURIComponent(dataURL.split(',')[1]);\r\n    }\r\n    arrayBuffer = new ArrayBuffer(byteString.length);\r\n    intArray = new Uint8Array(arrayBuffer);\r\n    for (i = k = 0, ref = byteString.length; 0 <= ref ? k <= ref : k >= ref; i = 0 <= ref ? ++k : --k) {\r\n      intArray[i] = byteString.charCodeAt(i);\r\n    }\r\n    mimeString = dataURL.split(',')[0].split(':')[1].split(';')[0];\r\n    if (hasBlobConstructor) {\r\n      blobArray = hasArrayBufferViewSupport ? intArray : arrayBuffer;\r\n      return new Blob([blobArray], {\r\n        type: mimeString\r\n      });\r\n    }\r\n    bb = new BlobBuilder();\r\n    bb.append(arrayBuffer);\r\n    return bb.getBlob(mimeString);\r\n  };\r\n\r\n  Util.prototype.throttle = function(func, wait) {\r\n    var args, call, ctx, last, rtn, throttled, timeoutID;\r\n    last = 0;\r\n    timeoutID = 0;\r\n    ctx = args = rtn = null;\r\n    call = function() {\r\n      timeoutID = 0;\r\n      last = +new Date();\r\n      rtn = func.apply(ctx, args);\r\n      ctx = null;\r\n      return args = null;\r\n    };\r\n    throttled = function() {\r\n      var delta;\r\n      ctx = this;\r\n      args = arguments;\r\n      delta = new Date() - last;\r\n      if (!timeoutID) {\r\n        if (delta >= wait) {\r\n          call();\r\n        } else {\r\n          timeoutID = setTimeout(call, wait - delta);\r\n        }\r\n      }\r\n      return rtn;\r\n    };\r\n    throttled.clear = function() {\r\n      if (!timeoutID) {\r\n        return;\r\n      }\r\n      clearTimeout(timeoutID);\r\n      return call();\r\n    };\r\n    return throttled;\r\n  };\r\n\r\n  Util.prototype.formatHTML = function(html) {\r\n    var cursor, indentString, lastMatch, level, match, re, repeatString, result, str;\r\n    re = /<(\\/?)(.+?)(\\/?)>/g;\r\n    result = '';\r\n    level = 0;\r\n    lastMatch = null;\r\n    indentString = '  ';\r\n    repeatString = function(str, n) {\r\n      return new Array(n + 1).join(str);\r\n    };\r\n    while ((match = re.exec(html)) !== null) {\r\n      match.isBlockNode = langx.inArray(match[2], this.blockNodes) > -1;\r\n      match.isStartTag = match[1] !== '/' && match[3] !== '/';\r\n      match.isEndTag = match[1] === '/' || match[3] === '/';\r\n      cursor = lastMatch ? lastMatch.index + lastMatch[0].length : 0;\r\n      if ((str = html.substring(cursor, match.index)).length > 0 && langx.trim(str)) {\r\n        result += str;\r\n      }\r\n      if (match.isBlockNode && match.isEndTag && !match.isStartTag) {\r\n        level -= 1;\r\n      }\r\n      if (match.isBlockNode && match.isStartTag) {\r\n        if (!(lastMatch && lastMatch.isBlockNode && lastMatch.isEndTag)) {\r\n          result += '\\n';\r\n        }\r\n        result += repeatString(indentString, level);\r\n      }\r\n      result += match[0];\r\n      if (match.isBlockNode && match.isEndTag) {\r\n        result += '\\n';\r\n      }\r\n      if (match.isBlockNode && match.isStartTag) {\r\n        level += 1;\r\n      }\r\n      lastMatch = match;\r\n    }\r\n    return langx.trim(result);\r\n  };\r\n\r\n  return contents.Util = Util;\r\n});"]}