{"version":3,"sources":["dropzone.js"],"names":["define","arrays","Deferred","styler","eventer","velm","$","webentry","files","dropzone","elm","params","hoverClass","droppedCallback","dropped","enterdCount","on","e","dataTransfer","types","indexOf","stop","addClass","removeClass","items","length","webkitGetAsEntry","getAsEntry","all","map","item","then","this","delegate","fn","wraps","wrapper_every_act"],"mappings":";;;;;;;AAAEA,QACE,uBACA,yBACA,sBACA,uBACA,oBACA,qBACA,6BACA,WACF,SAASC,EAAOC,EAAUC,EAAQC,EAASC,EAAMC,EAAGC,EAAUC,GAK5D,SAASC,EAASC,EAAKC,GAEnB,IAAIC,GADJD,EAASA,OACeC,YAAc,QAClCC,EAAkBF,EAAOG,QAEzBC,EAAc,EA+ClB,OA9CAX,EAAQY,GAAGN,EAAK,YAAa,SAASO,GAC9BA,EAAEC,cAAgBD,EAAEC,aAAaC,MAAMC,QAAQ,UAAY,IAC3DhB,EAAQiB,KAAKJ,GACbF,IACAZ,EAAOmB,SAASZ,EAAKE,MAI7BR,EAAQY,GAAGN,EAAK,WAAY,SAASO,GAC7BA,EAAEC,cAAgBD,EAAEC,aAAaC,MAAMC,QAAQ,UAAY,GAC3DhB,EAAQiB,KAAKJ,KAIrBb,EAAQY,GAAGN,EAAK,YAAa,SAASO,GAC9BA,EAAEC,cAAgBD,EAAEC,aAAaC,MAAMC,QAAQ,UAAY,GAExC,KADnBL,GAEIZ,EAAOoB,YAAYb,EAAKE,KAKpCR,EAAQY,GAAGN,EAAK,OAAQ,SAASO,GAC7B,GAAIA,EAAEC,cAAgBD,EAAEC,aAAaC,MAAMC,QAAQ,UAAY,IAC3DjB,EAAOoB,YAAYb,EAAKE,GACxBR,EAAQiB,KAAKJ,GACTJ,GAAiB,CACjB,IAAIW,EAAQP,EAAEC,aAAaM,MACvBA,GAASA,EAAMC,SAAWD,EAAM,GAAGE,kBAC/BF,EAAM,GAAGG,YACbpB,EAASqB,IACL3B,EAAO4B,IAAIL,EAAO,SAASM,GACvB,OAAIA,EAAKJ,iBACEI,EAAKJ,mBAETI,EAAKH,gBAElBI,KAAKlB,GAEPA,EAAgBI,EAAEC,aAAaV,UAMxCwB,KAWX,OATAxB,EAAMC,SAAWA,EAEjBJ,EAAK4B,UACD,YACFzB,GAGFF,EAAE4B,GAAGzB,SAAWH,EAAE6B,MAAMC,kBAAkB5B,EAAMC,SAAUD,GAEnDC","file":"../dropzone.js","sourcesContent":["  define([\r\n    \"skylark-langx/arrays\",\r\n    \"skylark-langx/deferred\",\r\n    \"skylark-domx-styler\",\r\n    \"skylark-domx-eventer\",\r\n    \"skylark-domx-velm\",\r\n    \"skylark-domx-query\",   \r\n    \"skylark-io-diskfs/webentry\",   \r\n    \"./files\"\r\n],function(arrays,Deferred, styler, eventer, velm, $, webentry, files){  /*\r\n     * Make the specified element to could accept HTML5 file drag and drop.\r\n     * @param {HTMLElement} elm\r\n     * @param {PlainObject} params\r\n     */\r\n    function dropzone(elm, params) {\r\n        params = params || {};\r\n        var hoverClass = params.hoverClass || \"hover\",\r\n            droppedCallback = params.dropped;\r\n\r\n        var enterdCount = 0;\r\n        eventer.on(elm, \"dragenter\", function(e) {\r\n            if (e.dataTransfer && e.dataTransfer.types.indexOf(\"Files\") > -1) {\r\n                eventer.stop(e);\r\n                enterdCount++;\r\n                styler.addClass(elm, hoverClass)\r\n            }\r\n        });\r\n\r\n        eventer.on(elm, \"dragover\", function(e) {\r\n            if (e.dataTransfer && e.dataTransfer.types.indexOf(\"Files\") > -1) {\r\n                eventer.stop(e);\r\n            }\r\n        });\r\n\r\n        eventer.on(elm, \"dragleave\", function(e) {\r\n            if (e.dataTransfer && e.dataTransfer.types.indexOf(\"Files\") > -1) {\r\n                enterdCount--\r\n                if (enterdCount == 0) {\r\n                    styler.removeClass(elm, hoverClass);\r\n                }\r\n            }\r\n        });\r\n\r\n        eventer.on(elm, \"drop\", function(e) {\r\n            if (e.dataTransfer && e.dataTransfer.types.indexOf(\"Files\") > -1) {\r\n                styler.removeClass(elm, hoverClass)\r\n                eventer.stop(e);\r\n                if (droppedCallback) {\r\n                    var items = e.dataTransfer.items;\r\n                    if (items && items.length && (items[0].webkitGetAsEntry ||\r\n                            items[0].getAsEntry)) {\r\n                        webentry.all(\r\n                            arrays.map(items, function(item) {\r\n                                if (item.webkitGetAsEntry) {\r\n                                    return item.webkitGetAsEntry();\r\n                                }\r\n                                return item.getAsEntry();\r\n                            })\r\n                        ).then(droppedCallback);\r\n                    } else {\r\n                        droppedCallback(e.dataTransfer.files);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        return this;\r\n    }\r\n    files.dropzone = dropzone;\r\n\r\n    velm.delegate([\r\n        \"dropzone\"\r\n    ],files);\r\n\r\n\r\n    $.fn.dropzone = $.wraps.wrapper_every_act(files.dropzone, files);\r\n\r\n    return dropzone;\r\n});"]}