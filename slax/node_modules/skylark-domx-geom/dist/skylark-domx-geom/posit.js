/**
 * skylark-domx-geom - The skylark geom library for dom api extension.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-noder","skylark-domx-styler","./geom"],function(t,e,i,o){"use strict";var l=Math.max,n=Math.abs,s=/left|center|right/,f=/top|center|bottom/,r=/[\+\-]\d+(\.[\d]+)?%?/,h=/^\w+/,c=/%$/;function a(t,e,i){return[parseFloat(t[0])*(c.test(t[0])?e/100:1),parseFloat(t[1])*(c.test(t[1])?i/100:1)]}function p(t,e){return parseInt(i.css(t,e),10)||0}var g={fit:{left:function(t,e){var i,o=e.within,n=o.isWindow?o.scrollLeft:o.offset.left,s=o.width,f=t.left-e.collisionPosition.marginLeft,r=n-f,h=f+e.collisionWidth-s-n;e.collisionWidth>s?r>0&&h<=0?(i=t.left+r+e.collisionWidth-s-n,t.left+=r-i):t.left=h>0&&r<=0?n:r>h?n+s-e.collisionWidth:n:r>0?t.left+=r:h>0?t.left-=h:t.left=l(t.left-f,t.left)},top:function(t,e){var i,o=e.within,n=o.isWindow?o.scrollTop:o.offset.top,s=e.within.height,f=t.top-e.collisionPosition.marginTop,r=n-f,h=f+e.collisionHeight-s-n;e.collisionHeight>s?r>0&&h<=0?(i=t.top+r+e.collisionHeight-s-n,t.top+=r-i):t.top=h>0&&r<=0?n:r>h?n+s-e.collisionHeight:n:r>0?t.top+=r:h>0?t.top-=h:t.top=l(t.top-f,t.top)}},flip:{left:function(t,e){var i,o,l=e.within,s=l.offset.left+l.scrollLeft,f=l.width,r=l.isWindow?l.scrollLeft:l.offset.left,h=t.left-e.collisionPosition.marginLeft,c=h-r,a=h+e.collisionWidth-f-r,p="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,g="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,m=-2*e.offset[0];c<0?((i=t.left+p+g+m+e.collisionWidth-f-s)<0||i<n(c))&&(t.left+=p+g+m):a>0&&((o=t.left-e.collisionPosition.marginLeft+p+g+m-r)>0||n(o)<a)&&(t.left+=p+g+m)},top:function(t,e){var i,o,l=e.within,s=l.offset.top+l.scrollTop,f=l.height,r=l.isWindow?l.scrollTop:l.offset.top,h=t.top-e.collisionPosition.marginTop,c=h-r,a=h+e.collisionHeight-f-r,p="top"===e.my[1]?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,g="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,m=-2*e.offset[1];c<0?((o=t.top+p+g+m+e.collisionHeight-f-s)<0||o<n(c))&&(t.top+=p+g+m):a>0&&((i=t.top-e.collisionPosition.marginTop+p+g+m-r)>0||n(i)<a)&&(t.top+=p+g+m)}},flipfit:{left:function(){g.flip.left.apply(this,arguments),g.fit.left.apply(this,arguments)},top:function(){g.flip.top.apply(this,arguments),g.fit.top.apply(this,arguments)}}};return o.posit=function(c,m){var d,w,u,W,y,v,x,z,H,T,L,P,b,k=(m=t.extend({},m)).of,D=(x=m.within,z=x||window,H=e.isWindow(z),T=!!z&&9===z.nodeType,L=!H&&!T,P=o.marginSize(z),{element:z,isWindow:H,isDocument:T,offset:L?o.pagePosition(x):{left:0,top:0},scrollLeft:o.scrollLeft(z),scrollTop:o.scrollTop(z),width:P.width,height:P.height}),F=function(t){var e=t.isWindow||t.isDocument?"":i.css(t.element,"overflow-x"),l=t.isWindow||t.isDocument?"":i.css(t.element,"overflow-y"),n="scroll"===e||"auto"===e&&t.width<o.scrollWidth(t.element);return{width:"scroll"===l||"auto"===l&&t.height<o.scrollHeight(t.element)?o.scrollbarWidth():0,height:n?o.scrollbarWidth():0}}(D),M=(m.collision||"flip").split(" "),S={};return v=9===(b=k).nodeType?{size:size(b),offset:{top:0,left:0}}:e.isWindow(b)?{size:o.size(b),offset:{top:o.scrollTop(b),left:o.scrollLeft(b)}}:b.preventDefault?{size:{width:0,height:0},offset:{top:b.pageY,left:b.pageX}}:{size:o.size(b),offset:o.pagePosition(b)},k.preventDefault&&(m.at="left top"),w=v.size.width,u=v.size.height,W=v.offset,y=t.extend({},W),t.each(["my","at"],function(){var t,e,i=(m[this]||"").split(" ");1===i.length&&(i=s.test(i[0])?i.concat(["center"]):f.test(i[0])?["center"].concat(i):["center","center"]),i[0]=s.test(i[0])?i[0]:"center",i[1]=f.test(i[1])?i[1]:"center",t=r.exec(i[0]),e=r.exec(i[1]),S[this]=[t?t[0]:0,e?e[0]:0],m[this]=[h.exec(i[0])[0],h.exec(i[1])[0]]}),1===M.length&&(M[1]=M[0]),"right"===m.at[0]?y.left+=w:"center"===m.at[0]&&(y.left+=w/2),"bottom"===m.at[1]?y.top+=u:"center"===m.at[1]&&(y.top+=u/2),d=a(S.at,w,u),y.left+=d[0],y.top+=d[1],function(e){var i,s,f=o.marginSize(e),r=f.width,h=f.height,c=p(e,"marginLeft"),v=p(e,"marginTop"),x=r+c+p(e,"marginRight")+F.width,z=h+v+p(e,"marginBottom")+F.height,H=t.extend({},y),T=a(S.my,f.width,f.height);"right"===m.my[0]?H.left-=r:"center"===m.my[0]&&(H.left-=r/2),"bottom"===m.my[1]?H.top-=h:"center"===m.my[1]&&(H.top-=h/2),H.left+=T[0],H.top+=T[1],i={marginLeft:c,marginTop:v},t.each(["left","top"],function(t,o){g[M[t]]&&g[M[t]][o](H,{targetWidth:w,targetHeight:u,elemWidth:r,elemHeight:h,collisionPosition:i,collisionWidth:x,collisionHeight:z,offset:[d[0]+T[0],d[1]+T[1]],my:m.my,at:m.at,within:D,elem:e})}),m.using&&(s=function(t){var i=W.left-H.left,o=i+w-r,s=W.top-H.top,f=s+u-h,c={target:{element:k,left:W.left,top:W.top,width:w,height:u},element:{element:e,left:H.left,top:H.top,width:r,height:h},horizontal:o<0?"left":i>0?"right":"center",vertical:f<0?"top":s>0?"bottom":"middle"};w<r&&n(i+o)<w&&(c.horizontal="center"),u<h&&n(s+f)<u&&(c.vertical="middle"),l(n(i),n(o))>l(n(s),n(f))?c.important="horizontal":c.important="vertical",m.using.call(this,t,c)}),o.pagePosition(e,t.extend(H,{using:s}))}(c)}});
//# sourceMappingURL=sourcemaps/posit.js.map
