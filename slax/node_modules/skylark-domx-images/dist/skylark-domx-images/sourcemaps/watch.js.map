{"version":3,"sources":["watch.js"],"names":["define","langx","eventer","images","isCompleted","isLoaded","watch","imgs","isArray","totalCount","length","progressedCount","successedCount","faileredCount","d","Deferred","complete","resolve","total","successed","failered","progress","img","progressed","defer","forEach","on","load","error","promise"],"mappings":";;;;;;;AAAAA,QACI,sBACA,uBACA,WACA,iBACA,eACD,SAASC,EAAMC,EAAQC,EAAOC,EAAYC,GA8E3C,OAAOF,EAAOG,MA5Ed,SAAeC,GACRN,EAAMO,QAAQD,KACjBA,GAAQA,IAEV,IAAIE,EAAaF,EAAKG,OAClBC,EAAkB,EAClBC,EAAiB,EACjBC,EAAgB,EAChBC,EAAI,IAAIb,EAAMc,SAGlB,SAASC,IAEPF,EAAEG,SACAC,MAAUT,EACVU,UAAcP,EACdQ,SAAaP,EACbN,KAASA,IAIb,SAASc,EAASC,EAAIjB,GAEpBM,IACIN,EACFO,IAEAC,IAIFC,EAAEO,UACAC,IAAQA,EACRjB,SAAaA,EACbkB,WAAeZ,EACfO,MAAUT,EACVF,KAASA,IAINI,GAAmBF,GACtBO,IA8BJ,OAHAf,EAAMuB,MAvBN,WACOjB,EAAKG,OAKVH,EAAKkB,QAAQ,SAASH,GAChBlB,EAAYkB,GACdD,EAASC,EAAIjB,EAASiB,IAEtBpB,EAAQwB,GAAGJ,GACTK,KAAS,WACPN,EAASC,GAAI,IAGfM,MAAU,WACRP,EAASC,GAAI,QAdnBN,MAuBJF,EAAEe,QAAQpB,WAAaA,EAChBK,EAAEe","file":"../watch.js","sourcesContent":["define([\r\n    \"skylark-langx/langx\",\r\n    \"skylark-domx-eventer\",\r\n    \"./images\",\r\n    \"./is-completed\",\r\n    \"./is-loaded\"\r\n], function(langx,eventer,images,isCompleted,isLoaded) {\r\n\r\n  function watch(imgs) {\r\n    if (!langx.isArray(imgs)) {\r\n      imgs = [imgs];\r\n    }\r\n    var totalCount = imgs.length,\r\n        progressedCount = 0,\r\n        successedCount = 0,\r\n        faileredCount = 0,\r\n        d = new langx.Deferred();\r\n\r\n\r\n    function complete() {\r\n\r\n      d.resolve({\r\n        \"total\" : totalCount,\r\n        \"successed\" : successedCount,\r\n        \"failered\" : faileredCount,\r\n        \"imgs\" : imgs \r\n      });\r\n    }\r\n\r\n    function progress(img,isLoaded) {\r\n\r\n      progressedCount++;\r\n      if (isLoaded) {\r\n        successedCount ++ ; \r\n      } else {\r\n        faileredCount ++ ;\r\n      }\r\n\r\n      // progress event\r\n      d.progress({\r\n        \"img\" : img,\r\n        \"isLoaded\" : isLoaded,\r\n        \"progressed\" : progressedCount,\r\n        \"total\" : totalCount,\r\n        \"imgs\" : imgs \r\n      });\r\n\r\n      // check if completed\r\n      if ( progressedCount == totalCount ) {\r\n        complete();\r\n      }\r\n    }\r\n\r\n    function check() {\r\n      if (!imgs.length ) {\r\n        complete();\r\n        return;\r\n      }\r\n\r\n      imgs.forEach(function(img) {\r\n        if (isCompleted(img)) {\r\n          progress(img,isLoaded(img));\r\n        } else {\r\n          eventer.on(img,{\r\n            \"load\" : function() {\r\n              progress(img,true);\r\n            },\r\n\r\n            \"error\" : function() {\r\n              progress(img,false);\r\n            }\r\n          });      \r\n        }\r\n      });\r\n    }\r\n\r\n    langx.defer(check);\r\n\r\n    d.promise.totalCount = totalCount;\r\n    return d.promise;\r\n  }\r\n\r\n\r\n\r\n  return images.watch = watch;\r\n});\r\n"]}