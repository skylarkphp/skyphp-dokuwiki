{"version":3,"sources":["droppable.js"],"names":["define","langx","noder","datax","finder","geom","eventer","styler","plugins","dnd","manager","on","off","attr","removeAttr","pagePosition","addClass","height","Droppable","Plugin","inherit","klassName","pluginName","options","draggingClass","_construct","elm","this","overrided","hoverClass","activeClass","self","acceptable","forEach","eventName","isFunction","dragover","e","stopPropagation","e2","create","overElm","target","transfer","draggingTransfer","trigger","preventDefault","dataTransfer","dropEffect","dragenter","_elm","dragleave","removeClass","drop","stop","dragging","end","register"],"mappings":";;;;;;;AAAAA,QACI,sBACA,qBACA,oBACA,sBACA,oBACA,uBACA,sBACA,4BACA,QACA,aACD,SAASC,EAAOC,EAAOC,EAAOC,EAAQC,EAAMC,EAASC,EAAQC,EAASC,EAAIC,GAChEJ,EAAQK,GACPL,EAAQM,IACPT,EAAMU,KACAV,EAAMW,WACVT,EAAKU,aACHR,EAAOS,SACTX,EAAKY,OANlB,IASIC,EAAYV,EAAQW,OAAOC,SAC3BC,UAAW,YAEXC,WAAa,qBAEbC,SACIC,cAAgB,YAGpBC,WAAY,SAASC,EAAKH,GACtBI,KAAKC,UAAUF,EAAIH,GAEnB,IAGIM,EACAC,EAJAC,EAAOJ,KAKPK,IAJAT,EAAUQ,EAAKR,SACSC,eAGX,IAEhB,UAAW,UAAW,SAAU,UAAW,WAAWS,QAAQ,SAASC,GAChEjC,EAAMkC,WAAWZ,EAAQW,KACzBH,EAAKpB,GAAGuB,EAAWX,EAAQW,MAInC5B,EAAQK,GAAGe,GACPU,SAAY,SAASC,GAGjB,GAFAA,EAAEC,kBAEGN,EAAL,CAIA,IAAIO,EAAKjC,EAAQkC,OAAO,WACpBC,QAASJ,EAAEK,OACXC,SAAUjC,EAAQkC,iBAClBZ,YAAY,IAEhBD,EAAKc,QAAQN,GAETA,EAAGP,aACHK,EAAES,iBAEFT,EAAEU,aAAaC,WAAa,cAKpCC,UAAa,SAASZ,GACJN,EAAKR,QAAnB,IACIG,EAAMK,EAAKmB,KAEXX,EAAKjC,EAAQkC,OAAO,WACpBG,SAAUjC,EAAQkC,mBAGtBb,EAAKc,QAAQN,GAEbF,EAAEC,kBAEET,GAAcG,GACdzB,EAAOS,SAASU,EAAKG,IAI7BsB,UAAa,SAASd,GACJN,EAAKR,QAAnB,IACIG,EAAMK,EAAKmB,KACf,IAAKlB,EAAY,OAAO,EAExB,IAAIO,EAAKjC,EAAQkC,OAAO,UACpBG,SAAUjC,EAAQkC,mBAGtBb,EAAKc,QAAQN,GAEbF,EAAEC,kBAEET,GAAcG,GACdzB,EAAO6C,YAAY1B,EAAKG,IAIhCwB,KAAQ,SAAShB,GACCN,EAAKR,QAAnB,IACIG,EAAMK,EAAKmB,KAIf,GAFA5C,EAAQgD,KAAKjB,GAER3B,EAAQ6C,SAAb,CAII1B,GAAcG,GACdzB,EAAOS,SAASU,EAAKG,GAGzB,IAAIU,EAAKjC,EAAQkC,OAAO,WACpBG,SAAUjC,EAAQkC,mBAGtBb,EAAKc,QAAQN,GAEb7B,EAAQ8C,KAAI,OAIpB9C,EAAQC,GAAG,aAAc,SAAS0B,GAC9B,IAAIE,EAAKjC,EAAQkC,OAAO,WACpBG,SAAUjC,EAAQkC,iBAClBZ,YAAY,IAGhBD,EAAKc,QAAQN,GAEbP,EAAaO,EAAGP,WAChBH,EAAaU,EAAGV,YAChBC,EAAcS,EAAGT,cAEEE,GACfzB,EAAOS,SAASU,EAAKI,KAG1BnB,GAAG,WAAY,SAAS0B,GACvB,IAAIE,EAAKjC,EAAQkC,OAAO,SACpBG,SAAUjC,EAAQkC,iBAClBZ,YAAY,IAGhBD,EAAKc,QAAQN,GAETV,GAAcG,GACdzB,EAAO6C,YAAY1B,EAAKG,GAExBC,GAAeE,GACfzB,EAAO6C,YAAY1B,EAAKI,GAG5BE,GAAa,EACbF,EAAc,KACdD,EAAa,UAQzB,OAFArB,EAAQiD,SAASvC,EAAU,aAEpBT,EAAIS,UAAYA","file":"../droppable.js","sourcesContent":["define([\r\n    \"skylark-langx/langx\",\r\n    \"skylark-domx-noder\",\r\n    \"skylark-domx-data\",\r\n    \"skylark-domx-finder\",\r\n    \"skylark-domx-geom\",\r\n    \"skylark-domx-eventer\",\r\n    \"skylark-domx-styler\",\r\n    \"skylark-domx-plugins-base\",\r\n    \"./dnd\",\r\n    \"./manager\"\r\n], function(langx, noder, datax, finder, geom, eventer, styler, plugins, dnd,manager) {\r\n    var on = eventer.on,\r\n        off = eventer.off,\r\n        attr = datax.attr,\r\n        removeAttr = datax.removeAttr,\r\n        offset = geom.pagePosition,\r\n        addClass = styler.addClass,\r\n        height = geom.height;\r\n\r\n\r\n    var Droppable = plugins.Plugin.inherit({\r\n        klassName: \"Droppable\",\r\n\r\n        pluginName : \"lark.dnd.droppable\",\r\n\r\n        options : {\r\n            draggingClass : \"dragging\"\r\n        },\r\n\r\n        _construct: function(elm, options) {\r\n            this.overrided(elm,options);\r\n\r\n            var self = this,\r\n                options = self.options,\r\n                draggingClass = options.draggingClass,\r\n                hoverClass,\r\n                activeClass,\r\n                acceptable = true;\r\n\r\n            [\"started\", \"entered\", \"leaved\", \"dropped\", \"overing\"].forEach(function(eventName) {\r\n                if (langx.isFunction(options[eventName])) {\r\n                    self.on(eventName, options[eventName]);\r\n                }\r\n            });\r\n\r\n            eventer.on(elm, {\r\n                \"dragover\": function(e) {\r\n                    e.stopPropagation()\r\n\r\n                    if (!acceptable) {\r\n                        return\r\n                    }\r\n\r\n                    var e2 = eventer.create(\"overing\", {\r\n                        overElm: e.target,\r\n                        transfer: manager.draggingTransfer,\r\n                        acceptable: true\r\n                    });\r\n                    self.trigger(e2);\r\n\r\n                    if (e2.acceptable) {\r\n                        e.preventDefault() // allow drop\r\n\r\n                        e.dataTransfer.dropEffect = \"copyMove\";\r\n                    }\r\n\r\n                },\r\n\r\n                \"dragenter\": function(e) {\r\n                    var options = self.options,\r\n                        elm = self._elm;\r\n\r\n                    var e2 = eventer.create(\"entered\", {\r\n                        transfer: manager.draggingTransfer\r\n                    });\r\n\r\n                    self.trigger(e2);\r\n\r\n                    e.stopPropagation()\r\n\r\n                    if (hoverClass && acceptable) {\r\n                        styler.addClass(elm, hoverClass)\r\n                    }\r\n                },\r\n\r\n                \"dragleave\": function(e) {\r\n                    var options = self.options,\r\n                        elm = self._elm;\r\n                    if (!acceptable) return false\r\n\r\n                    var e2 = eventer.create(\"leaved\", {\r\n                        transfer: manager.draggingTransfer\r\n                    });\r\n\r\n                    self.trigger(e2);\r\n\r\n                    e.stopPropagation()\r\n\r\n                    if (hoverClass && acceptable) {\r\n                        styler.removeClass(elm, hoverClass);\r\n                    }\r\n                },\r\n\r\n                \"drop\": function(e) {\r\n                    var options = self.options,\r\n                        elm = self._elm;\r\n\r\n                    eventer.stop(e); // stops the browser from redirecting.\r\n\r\n                    if (!manager.dragging) return\r\n\r\n                    // manager.dragging.elm.removeClass('dragging');\r\n\r\n                    if (hoverClass && acceptable) {\r\n                        styler.addClass(elm, hoverClass)\r\n                    }\r\n\r\n                    var e2 = eventer.create(\"dropped\", {\r\n                        transfer: manager.draggingTransfer\r\n                    });\r\n\r\n                    self.trigger(e2);\r\n\r\n                    manager.end(true)\r\n                }\r\n            });\r\n\r\n            manager.on(\"dndStarted\", function(e) {\r\n                var e2 = eventer.create(\"started\", {\r\n                    transfer: manager.draggingTransfer,\r\n                    acceptable: false\r\n                });\r\n\r\n                self.trigger(e2);\r\n\r\n                acceptable = e2.acceptable;\r\n                hoverClass = e2.hoverClass;\r\n                activeClass = e2.activeClass;\r\n\r\n                if (activeClass && acceptable) {\r\n                    styler.addClass(elm, activeClass);\r\n                }\r\n\r\n            }).on(\"dndEnded\", function(e) {\r\n                var e2 = eventer.create(\"ended\", {\r\n                    transfer: manager.draggingTransfer,\r\n                    acceptable: false\r\n                });\r\n\r\n                self.trigger(e2);\r\n\r\n                if (hoverClass && acceptable) {\r\n                    styler.removeClass(elm, hoverClass);\r\n                }\r\n                if (activeClass && acceptable) {\r\n                    styler.removeClass(elm, activeClass);\r\n                }\r\n\r\n                acceptable = false;\r\n                activeClass = null;\r\n                hoverClass = null;\r\n            });\r\n\r\n        }\r\n    });\r\n\r\n    plugins.register(Droppable,\"droppable\");\r\n\r\n    return dnd.Droppable = Droppable;\r\n});"]}