/**
 * skylark-domx-plugins-embeds - The skylark embed plugin library for dom api extension.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx-plugins/skylark-domx-plugins-embeds/
 * @license MIT
 */
!function(e,t){var n=t.define,require=t.require,s="function"==typeof n&&n.amd,i=!s&&"undefined"!=typeof exports;if(!s&&!n){var o={};n=t.define=function(e,t,n){"function"==typeof n?(o[e]={factory:n,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var n=t.split("/"),s=e.split("/");n.pop();for(var i=0;i<s.length;i++)"."!=s[i]&&(".."==s[i]?n.pop():n.push(s[i]));return n.join("/")}(t,e)}),resolved:!1,exports:null},require(e)):o[e]={factory:null,resolved:!0,exports:n}},require=t.require=function(e){if(!o.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=o[e];if(!module.resolved){var n=[];module.deps.forEach(function(e){n.push(require(e))}),module.exports=module.factory.apply(t,n)||null,module.resolved=!0}return module.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-domx-plugins-embeds/embeds",["skylark-domx-plugins-base/plugins"],function(e){"use strict";return e.embeds={}}),e("skylark-domx-plugins-embeds/embed-runner",["skylark-domx-iframes/create","skylark-domx/query","skylark-domx-plugins-base","./embeds"],function(e,t,n,s){"use strict";var i=t(window),o=t(document),a=n.Plugin.inherit({klassName:"EmbedRunner",pluginName:"lark.embeds.runner",options:{runnerUrl:"",runnerName:""},_construct:function(e,t){this.overrided(e,t),this.runner={},this.runner.origin="*"},prepare:function(){return this._inited?this._inited.promise:(this._inited=new Deferred,e({url:this.options.runnerUrl,className:"stretch",sandbox:"allow-modals allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts",frameBorder:"0",name:"<proxy>",contentWindowName:this.options.runnerName,onload:()=>{window.postMessage&&(i.on("message",e=>{this.handleMessage(e.originalEvent)}),this.setup(iframe),this._inited.resolve())},onerror:e=>{this._inited.reject(e)}},this._elm),o.on("codeChange.live",(e,t)=>{"setValue"!==t.origin&&t.origin}),o.on("console:run",(e,t)=>{this.postMessage("console:run",t)}),o.on("console:load:script",(e,t)=>{this.postMessage("console:load:script",t)}),o.on("console:load:dom",(e,t)=>{this.postMessage("console:load:dom",t)}),inited.promise)},setup:function(e){this.runner.window=e.contentWindow,this.runner.iframe=e},error:function(){window.console.warn.apply(console,["Renderer:"].concat([].slice.call(arguments)))},handleMessage:function(e){if(e.origin){var t=e.data;if("string"==typeof t){try{t="string"==typeof e.data?JSON.parse(e.data):e.data}catch(e){return this.error("Error parsing event data:",e.message)}if("function"!=typeof this[t.type])return!1;try{this[t.type](t.data)}catch(e){this.error(e.message)}}}},postMessage:function(e,t){if(!this.runner.window)return this.error("postMessage: No connection to runner window.");this.runner.window.postMessage(JSON.stringify({type:e,data:t}),this.runner.origin)},complete:function(){try{store.sessionStorage.removeItem("runnerPending")}catch(e){}},focus:function(){},console:function(e){var t=e.method,n=e.args;window._console&&(window._console[t]||(t="log"),window._console[t].apply(window._console,n))},"console:load:script:success":function(e){o.trigger("console:load:script:success",e)},"console:load:script:error":function(e){o.trigger("console:load:script:error",e)},"console:load:dom:success":function(e){o.trigger("console:load:dom:success",e)},"console:load:dom:error":function(e){o.trigger("console:load:dom:error",e)}});return s.EmbedRunner=a}),e("skylark-domx-plugins-embeds/embed-vimeo",["skylark-langx/langx","skylark-domx-noder","skylark-domx-query","skylark-domx-plugins-base","./embeds"],function(e,t,n,s,i){"use strict";var o=s.Plugin.inherit({klassName:"EmbedVimeo",pluginName:"lark.embeds.vimeo",options:{},_construct:function(e,t){s.Plugin.prototype._construct.call(this,e,t),this.url=t.url,this.videoId=t.videoId,this.playerId=t.playerId,this.clickToPlay=t.clickToPlay},canPlayType:function(){return!0},loadAPI:function(){var e,t,s=this,i="//f.vimeocdn.com/js/froogaloop2.min.js",o=document.getElementsByTagName("script"),a=o.length;function r(){!t&&s.playOnReady&&s.play(),t=!0}for(;a;)if(o[a-=1].src===i){e=o[a];break}e||((e=document.createElement("script")).src=i),n(e).on("load",r),o[0].parentNode.insertBefore(e,o[0]),/loaded|complete/.test(e.readyState)&&r()},onReady:function(){var e=this;this.ready=!0,this.player.addEvent("play",function(){e.hasPlayed=!0,e.onPlaying()}),this.player.addEvent("pause",function(){e.onPause()}),this.player.addEvent("finish",function(){e.onPause()}),this.playOnReady&&this.play()},onPlaying:function(){this.playStatus<2&&(this.emit("playing"),this.playStatus=2)},onPause:function(){this.emit("pause"),delete this.playStatus},insertIframe:function(){var e=document.createElement("iframe");e.src=this.url.replace("VIDEO_ID",this.videoId).replace("PLAYER_ID",this.playerId),e.id=this.playerId,this._elm.parentNode.replaceChild(e,this._elm),this._elm=e},play:function(){var e=this;this.playStatus||(this.emit("play"),this.playStatus=1),this.ready?!this.hasPlayed&&(this.clickToPlay||window.navigator&&/iP(hone|od|ad)/.test(window.navigator.platform))?this.onPlaying():this.player.api("play"):(this.playOnReady=!0,window.$f?this.player||(this.insertIframe(),this.player=$f(this._elm),this.player.addEvent("ready",function(){e.onReady()})):this.loadAPI())},pause:function(){this.ready?this.player.api("pause"):this.playStatus&&(delete this.playOnReady,this.emit("pause"),delete this.playStatus)}});return i.EmbedVimeo=o}),e("skylark-domx-plugins-embeds/embed-youtube",["skylark-langx/langx","skylark-domx-noder","skylark-domx-query","skylark-domx-plugins-base","./embeds"],function(e,t,n,s,i){"use strict";var o=s.Plugin.inherit({klassName:"EmbedYoutube",pluginName:"lark.embeds.youtube",options:{},_construct:function(e,t){s.Plugin.prototype._construct.call(this,e,t),this.videoId=t.videoId,this.playerVars=t.playerVars,this.clickToPlay=t.clickToPlay},canPlayType:function(){return!0},loadAPI:function(){var e,t=this,n=window.onYouTubeIframeAPIReady,s="https://www.youtube.com/iframe_api",i=document.getElementsByTagName("script"),o=i.length;for(window.onYouTubeIframeAPIReady=function(){n&&n.apply(this),t.playOnReady&&t.play()};o;)if(i[o-=1].src===s)return;(e=document.createElement("script")).src=s,i[0].parentNode.insertBefore(e,i[0])},onReady:function(){this.ready=!0,this.playOnReady&&this.play()},onPlaying:function(){this.playStatus<2&&(this.emit("playing"),this.playStatus=2)},onPause:function(){e.defer(()=>{this.checkSeek()},2e3)},checkSeek:function(){this.stateChange!==YT.PlayerState.PAUSED&&this.stateChange!==YT.PlayerState.ENDED||(this.emit("pause"),delete this.playStatus)},onStateChange:function(e){switch(e.data){case YT.PlayerState.PLAYING:this.hasPlayed=!0,this.onPlaying();break;case YT.PlayerState.PAUSED:case YT.PlayerState.ENDED:this.onPause()}this.stateChange=e.data},onError:function(e){this.trigger("error",e)},play:function(){var e=this;this.playStatus||(this.emit("play"),this.playStatus=1),this.ready?!this.hasPlayed&&(this.clickToPlay||window.navigator&&/iP(hone|od|ad)/.test(window.navigator.platform))?this.onPlaying():this.player.playVideo():(this.playOnReady=!0,window.YT&&YT.Player?this.player||(this.player=new YT.Player(this._elm,{videoId:this.videoId,playerVars:this.playerVars,events:{onReady:function(){e.onReady()},onStateChange:function(t){e.onStateChange(t)},onError:function(t){e.onError(t)}}})):this.loadAPI())},pause:function(){this.ready?this.player.pauseVideo():this.playStatus&&(delete this.playOnReady,this.emit("pause"),delete this.playStatus)}});return i.EmbedYoutube=o}),e("skylark-domx-plugins-embeds/main",["./embeds","./embed-runner","./embed-vimeo","./embed-youtube"],function(e){return e}),e("skylark-domx-plugins-embeds",["skylark-domx-plugins-embeds/main"],function(e){return e})}(n),!s){var a=require("skylark-langx-ns");i?module.exports=a:t.skylarkjs=a}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-domx-plugins-embeds.js.map
