{"version":3,"sources":["dropdown.js"],"names":["define","langx","browser","eventer","noder","geom","$","plugins","popups","backdrop","toggle","Dropdown","Plugin","inherit","klassName","pluginName","options","selectors","toggler","_construct","elm","this","overrided","$el","$element","_elm","on","keydown","e","$this","is","$parent","getParent","isActive","hasClass","clearMenus","document","documentElement","closest","length","createElement","addClass","insertAfter","relatedTarget","trigger","create","isDefaultPrevented","attr","toggleClass","test","which","target","tagName","preventDefault","stopPropagation","find","$items","index","eq","selector","replace","parent","remove","each","type","contains","removeClass","register"],"mappings":"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","file":"../dropdown.js","sourcesContent":["define([\n  \"skylark-langx/langx\",\n  \"skylark-domx-browser\",\n  \"skylark-domx-eventer\",\n  \"skylark-domx-noder\",\n  \"skylark-domx-geom\",\n  \"skylark-domx-query\",\n  \"skylark-domx-plugins-base\",\n  \"./popups\"\n],function(langx,browser,eventer,noder,geom,$,plugins,popups){\n\n  'use strict';\n\n  // DROPDOWN CLASS DEFINITION\n  // =========================\n\n  var backdrop = '.dropdown-backdrop';\n  var toggle   = '[data-toggle=\"dropdown\"]';\n\n  var Dropdown = plugins.Plugin.inherit({\n    klassName: \"Dropdown\",\n\n    pluginName : \"lark.popups.dropdown\",\n\n    options : {\n      \"selectors\" : {\n        \"toggler\" : '[data-toggle=\"dropdown\"],.dropdown-menu'\n      }\n\n    },\n\n    _construct : function(elm,options) {\n      this.overrided(elm,options);\n\n      var $el = this.$element = $(this._elm);\n      $el.on('click.dropdown', this.toggle);\n      $el.on('keydown.dropdown', this.options.selectors.toggler,this.keydown);\n    },\n\n    toggle : function (e) {\n      var $this = $(this)\n\n      if ($this.is('.disabled, :disabled')) {\n        return;\n      }\n\n      var $parent  = getParent($this)\n      var isActive = $parent.hasClass('open');\n\n      clearMenus()\n\n      if (!isActive) {\n        if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {\n          // if mobile we use a backdrop because click events don't delegate\n          $(document.createElement('div'))\n            .addClass('dropdown-backdrop')\n            .insertAfter($(this))\n            .on('click', clearMenus)\n        }\n\n        var relatedTarget = { relatedTarget: this }\n        $parent.trigger(e = eventer.create('show.dropdown', relatedTarget))\n\n        if (e.isDefaultPrevented()) {\n          return;\n        }\n\n        $this\n          .trigger('focus')\n          .attr('aria-expanded', 'true')\n\n        $parent\n          .toggleClass('open')\n          .trigger(eventer.create('shown.dropdown', relatedTarget))\n      }\n\n      return false\n    },\n\n    keydown : function (e) {\n      if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) {\n        return;\n      }\n\n      var $this = $(this);\n\n      e.preventDefault()\n      e.stopPropagation()\n\n      if ($this.is('.disabled, :disabled')) {\n        return;\n      }\n\n      var $parent  = getParent($this)\n      var isActive = $parent.hasClass('open')\n\n      if (!isActive && e.which != 27 || isActive && e.which == 27) {\n        if (e.which == 27) $parent.find(toggle).trigger('focus')\n        return $this.trigger('click')\n      }\n\n      var desc = ' li:not(.disabled):visible a'\n      var $items = $parent.find('.dropdown-menu' + desc)\n\n      if (!$items.length) return\n\n      var index = $items.index(e.target)\n\n      if (e.which == 38 && index > 0)                 index--         // up\n      if (e.which == 40 && index < $items.length - 1) index++         // down\n      if (!~index)                                    index = 0\n\n      $items.eq(index).trigger('focus');\n    }\n\n  });\n\n  function getParent($this) {\n    var selector = $this.attr('data-target')\n\n    if (!selector) {\n      selector = $this.attr('href')\n      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\\s]*$)/, '') // strip for ie7\n    }\n\n    var $parent = selector && $(selector);\n\n    return $parent && $parent.length ? $parent : $this.parent();\n  }\n\n  function clearMenus(e) {\n    if (e && e.which === 3) return\n    $(backdrop).remove()\n    $(toggle).each(function () {\n      var $this         = $(this)\n      var $parent       = getParent($this)\n      var relatedTarget = { relatedTarget: this }\n\n      if (!$parent.hasClass('open')) return\n\n      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && noder.contains($parent[0], e.target)) return\n\n      $parent.trigger(e = eventer.create('hide.dropdown', relatedTarget))\n\n      if (e.isDefaultPrevented()) return\n\n      $this.attr('aria-expanded', 'false')\n      $parent.removeClass('open').trigger(eventer.create('hidden.dropdown', relatedTarget))\n    })\n  }\n\n\n\n  // APPLY TO STANDARD DROPDOWN ELEMENTS\n  // ===================================\n  $(document)\n    .on('click.dropdown.data-api', clearMenus)\n    .on('click.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() });\n\n  plugins.register(Dropdown);\n\n  return popups.Dropdown = Dropdown;\n\n});\n"]}