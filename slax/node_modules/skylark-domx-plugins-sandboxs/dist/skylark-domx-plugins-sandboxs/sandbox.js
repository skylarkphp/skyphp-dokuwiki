/**
 * skylark-domx-plugins-sandboxs - The skylark sandbox plugins library for dom api extension
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx-plugins/skylark-domx-plugins-sandboxs/
 * @license MIT
 */
define(["skylark-langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-eventer","skylark-domx-query","skylark-domx-plugins-base","./sandboxs"],function(t,e,n,o,r,i,s){"use strict";var a=function(t){return t.contentWindow||t.contentDocument.parentWindow},c=i.Plugin.inherit({klassName:"Sandbox",pluginName:"lark.sandboxs.sandbox",options:{name:"Output",allows:"allow-modals allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts",frameBorder:"0",cssTextTagId:"sandbox-css"},_construct:function(t,e){this.overrided(t,e),this.target=t,this.old=null,this.active=null,this.state={},this.guid=+new Date},create:function(){var t=document.createElement("iframe");return t.setAttribute("sandbox",this.options.allows),t.setAttribute("frameBorder",this.options.frameBorder),t.setAttribute("name",this.options.name),t.id=this.guid++,t},use:function(e,o){if(!this.target)throw new Error("Sandbox has no target element.");this.old=this.active,this.saveState(this.old),this.active=e,n.prepend(this.target,e),t.defer(function(){o&&o();for(var t,e=this.target.getElementsByTagName("iframe"),r=e.length,i=0,s=this.active.id;t=e[i],i<r;i++)t.id!==s&&(n.remove(t),r--)}.bind(this))},restoreState:function(t,e){if(!t)return{};var n=a(t);if(!n)return{};e.scroll&&n.scrollTo(e.scroll.x,e.scroll.y)},saveState:function(t){if(!t)return{};var e=a(t);return e?{scroll:{x:e.scrollX,y:e.scrollY}}:{}},wrap:function(t,e){t&&(e=e||{},o.on(t,"resize",function(){o.resized(this._elm)}),o.on(t,"focus",()=>{o.trigger(this._elm,"focused")}))},getSizeProperties:function(t){return{width:t.innerWidth||t.document.documentElement.clientWidth,height:t.innerHeight||t.document.documentElement.clientHeight,offsetWidth:t.document.documentElement.offsetWidth,offsetHeight:t.document.documentElement.offsetHeight}},eval:function(t){if(!this.active)throw new Error("sandbox.eval: has no active iframe.");var e=/(^.|\b)console\.(\S+)/g;if(e.test(t)){t=t.replace(e,function(t,e,n){return"window.runnerWindow.proxyConsole."+n})}var n=this.active.contentWindow,o=null,r="log";try{o=n.eval(t)}catch(t){o=t.message,r="error"}return proxyConsole[r](o)},injectScript:function(t,e){if(!this.active)throw new Error("sandbox.injectScript: has no active iframe.");var n=this.active.contentWindow.document,o=n.createElement("script");o.src=t,o.onload=function(){e()},o.onerror=function(){e('Failed to load "'+t+'"')},n.body.appendChild(o)},injectDOM:function(t,e){if(!this.active)throw new Error("sandbox.injectDOM: has no active iframe.");var n=this.active.contentWindow.document;try{n.body.innerHTML=t}catch(t){e("Failed to load DOM.")}e()},injectCssText:function(t){if(this.active){var e=this.active.contentDocument.getElementById(this.options.cssTextTagId);if(e)return void(e.innerHTML=t)}},render:function(t,e){var n=this.create(e);this.use(n,()=>{var o=n.contentDocument,r=n.contentWindow||n.contentDocument.parentWindow;o||(o=r.document);let i=e.proxyConsole,s=e.loopProtect;i.methods.forEach(function(t){delete i[t]}),o.open(),o.write(""),r.runnerWindow={proxyConsole:i,protect:s},r.console=i,r.onerror=function(t,e,n,o,r){i._raw("error",r&&r.stack?r.stack:t+" (line "+n+")")},o.write(t),o.close(),this.wrap(r,e)})}});return i.register(c),s.Sandbox=c});
//# sourceMappingURL=sourcemaps/sandbox.js.map
