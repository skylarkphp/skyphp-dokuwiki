{"version":3,"sources":["skylark-domx-plugins.js"],"names":["define","skylark","langx","noder","datax","eventer","finder","geom","styler","fx","$","elmx","slice","Array","prototype","pluginKlasses","concat","shortcuts","instantiate","elm","pluginName","options","pair","split","instanceDataName","pluginInstance","data","Error","destroy","removeData","undefined","reset","pluginKlass","Plugin","Evented","inherit","klassName","_construct","this","_elm","_initOptions","ctor","constructor","cache","defaults","ctors","unshift","superclass","i","length","hasOwnProperty","mixin","Object","defineProperty","value","_destroy","noop","_delay","handler","delay","instance","setTimeout","apply","arguments","option","key","parts","curOption","shift","pop","_setOptions","_setOption","getUID","prefix","Math","random","document","getElementById","plugins","fn","plugin","name","args","call","self","returnValue","each","partial","domNode","register","shortcutName","extfn","isFunction","shortcut","methodName","charAt","shortcutter","args2","ret","attach","main"],"mappings":"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","file":"../skylark-domx-plugins.js","sourcesContent":["define('skylark-domx-plugins/plugins',[\r\n    \"skylark-langx/skylark\",\r\n    \"skylark-langx/langx\",\r\n    \"skylark-domx-noder\",\r\n    \"skylark-domx-data\",\r\n    \"skylark-domx-eventer\",\r\n    \"skylark-domx-finder\",\r\n    \"skylark-domx-geom\",\r\n    \"skylark-domx-styler\",\r\n    \"skylark-domx-fx\",\r\n    \"skylark-domx-query\",\r\n    \"skylark-domx-velm\"\r\n], function(skylark, langx, noder, datax, eventer, finder, geom, styler, fx, $, elmx) {\r\n    \"use strict\";\r\n\r\n    var slice = Array.prototype.slice,\r\n        concat = Array.prototype.concat,\r\n        pluginKlasses = {},\r\n        shortcuts = {};\r\n\r\n    /*\r\n     * Create or get or destory a plugin instance assocated with the element.\r\n     */\r\n    function instantiate(elm,pluginName,options) {\r\n        var pair = pluginName.split(\":\"),\r\n            instanceDataName = pair[1];\r\n        pluginName = pair[0];\r\n\r\n        if (!instanceDataName) {\r\n            instanceDataName = pluginName;\r\n        }\r\n\r\n        var pluginInstance = datax.data( elm, instanceDataName );\r\n\r\n        if (options === \"instance\") {\r\n            return pluginInstance;\r\n        } else if (options === \"destroy\") {\r\n            if (!pluginInstance) {\r\n                throw new Error (\"The plugin instance is not existed\");\r\n            }\r\n            pluginInstance.destroy();\r\n            datax.removeData( elm, pluginName);\r\n            pluginInstance = undefined;\r\n        } else {\r\n            if (!pluginInstance) {\r\n                if (options !== undefined && typeof options !== \"object\") {\r\n                    throw new Error (\"The options must be a plain object\");\r\n                }\r\n                var pluginKlass = pluginKlasses[pluginName]; \r\n                pluginInstance = new pluginKlass(elm,options);\r\n                datax.data( elm, instanceDataName,pluginInstance );\r\n            } else if (options) {\r\n                pluginInstance.reset(options);\r\n            }\r\n        }\r\n\r\n        return pluginInstance;\r\n    }\r\n\r\n    function shortcutter(pluginName,extfn) {\r\n       /*\r\n        * Create or get or destory a plugin instance assocated with the element,\r\n        * and also you can execute the plugin method directory;\r\n        */\r\n        return function (elm,options) {\r\n            var  plugin = instantiate(elm, pluginName,\"instance\");\r\n            if ( options === \"instance\" ) {\r\n              return plugin || null;\r\n            }\r\n            if (!plugin) {\r\n                plugin = instantiate(elm, pluginName,typeof options == 'object' && options || {});\r\n                return this;\r\n            } else  if (options) {\r\n                var args = slice.call(arguments,1); //2\r\n                if (extfn) {\r\n                    var ret =  extfn.apply(plugin,args);\r\n                    if (ret === undefined) {\r\n                        ret = this;\r\n                    }\r\n                    return ret;\r\n                } else {\r\n                    if (typeof options == 'string') {\r\n                        var methodName = options;\r\n\r\n                        if ( !plugin ) {\r\n                            throw new Error( \"cannot call methods on \" + pluginName +\r\n                                \" prior to initialization; \" +\r\n                                \"attempted to call method '\" + methodName + \"'\" );\r\n                        }\r\n\r\n                        if ( !langx.isFunction( plugin[ methodName ] ) || methodName.charAt( 0 ) === \"_\" ) {\r\n                            throw new Error( \"no such method '\" + methodName + \"' for \" + pluginName +\r\n                                \" plugin instance\" );\r\n                        }\r\n\r\n                        return plugin[methodName].apply(plugin,args);\r\n                    }                \r\n                }                \r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    function shortcutter(pluginName,extfn) {\r\n       /*\r\n        * Create or get or destory a plugin instance assocated with the element,\r\n        * and also you can execute the plugin method directory;\r\n        */\r\n        return function (elm,options) {\r\n            var  plugin = instantiate(elm, pluginName,\"instance\");\r\n            if ( options === \"instance\" ) {\r\n              return plugin || null;\r\n            }\r\n            if (!plugin) {\r\n                plugin = instantiate(elm, pluginName,typeof options == 'object' && options || {});\r\n            } else  if (options) {\r\n                var args = slice.call(arguments,1); //2\r\n                if (extfn) {\r\n                    return extfn.apply(plugin,args);\r\n                } else {\r\n                    if (typeof options == 'string') {\r\n                        var methodName = options;\r\n\r\n                        if ( !plugin ) {\r\n                            throw new Error( \"cannot call methods on \" + pluginName +\r\n                                \" prior to initialization; \" +\r\n                                \"attempted to call method '\" + methodName + \"'\" );\r\n                        }\r\n\r\n                        if ( !langx.isFunction( plugin[ methodName ] ) || methodName.charAt( 0 ) === \"_\" ) {\r\n                            throw new Error( \"no such method '\" + methodName + \"' for \" + pluginName +\r\n                                \" plugin instance\" );\r\n                        }\r\n\r\n                        return plugin[methodName].apply(plugin,args);\r\n                    }                \r\n                }                \r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /*\r\n     * Register a plugin type\r\n     */\r\n    function register( pluginKlass,shortcutName,instanceDataName,extfn) {\r\n        var pluginName = pluginKlass.prototype.pluginName;\r\n        \r\n        pluginKlasses[pluginName] = pluginKlass;\r\n\r\n        if (shortcutName) {\r\n            if (instanceDataName && langx.isFunction(instanceDataName)) {\r\n                extfn = instanceDataName;\r\n                instanceDataName = null;\r\n            } \r\n            if (instanceDataName) {\r\n                pluginName = pluginName + \":\" + instanceDataName;\r\n            }\r\n\r\n            var shortcut = shortcuts[shortcutName] = shortcutter(pluginName,extfn);\r\n                \r\n            $.fn[shortcutName] = function(options) {\r\n                var returnValue = this;\r\n\r\n                if ( !this.length && options === \"instance\" ) {\r\n                  returnValue = undefined;\r\n                } else {\r\n                  var args = slice.call(arguments);\r\n                  this.each(function () {\r\n                    var args2 = slice.call(args);\r\n                    args2.unshift(this);\r\n                    var  ret  = shortcut.apply(null,args2);\r\n                    if (ret !== undefined) {\r\n                        returnValue = ret;\r\n                        return false;\r\n                    }\r\n                  });\r\n                }\r\n\r\n                return returnValue;\r\n            };\r\n\r\n            elmx.partial(shortcutName,function(options) {\r\n                var  ret  = shortcut(this._elm,options);\r\n                if (ret === undefined) {\r\n                    ret = this;\r\n                }\r\n                return ret;\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n \r\n    var Plugin =   langx.Evented.inherit({\r\n        klassName: \"Plugin\",\r\n\r\n        _construct : function(elm,options) {\r\n           this._elm = elm;\r\n           this._initOptions(options);\r\n        },\r\n\r\n        _initOptions : function(options) {\r\n          var ctor = this.constructor,\r\n              cache = ctor.cache = ctor.cache || {},\r\n              defaults = cache.defaults;\r\n          if (!defaults) {\r\n            var  ctors = [];\r\n            do {\r\n              ctors.unshift(ctor);\r\n              if (ctor === Plugin) {\r\n                break;\r\n              }\r\n              ctor = ctor.superclass;\r\n            } while (ctor);\r\n\r\n            defaults = cache.defaults = {};\r\n            for (var i=0;i<ctors.length;i++) {\r\n              ctor = ctors[i];\r\n              if (ctor.prototype.hasOwnProperty(\"options\")) {\r\n                langx.mixin(defaults,ctor.prototype.options,true);\r\n              }\r\n              if (ctor.hasOwnProperty(\"options\")) {\r\n                langx.mixin(defaults,ctor.options,true);\r\n              }\r\n            }\r\n          }\r\n          Object.defineProperty(this,\"options\",{\r\n            value :langx.mixin({},defaults,options,true)\r\n          });\r\n\r\n          //return this.options = langx.mixin({},defaults,options);\r\n          return this.options;\r\n        },\r\n\r\n\r\n        destroy: function() {\r\n            var that = this;\r\n\r\n            this._destroy();\r\n            // We can probably remove the unbind calls in 2.0\r\n            // all event bindings should go through this._on()\r\n            datax.removeData(this._elm,this.pluginName );\r\n        },\r\n\r\n        _destroy: langx.noop,\r\n\r\n        _delay: function( handler, delay ) {\r\n            function handlerProxy() {\r\n                return ( typeof handler === \"string\" ? instance[ handler ] : handler )\r\n                    .apply( instance, arguments );\r\n            }\r\n            var instance = this;\r\n            return setTimeout( handlerProxy, delay || 0 );\r\n        },\r\n\r\n        option: function( key, value ) {\r\n            var options = key;\r\n            var parts;\r\n            var curOption;\r\n            var i;\r\n\r\n            if ( arguments.length === 0 ) {\r\n\r\n                // Don't return a reference to the internal hash\r\n                return langx.mixin( {}, this.options );\r\n            }\r\n\r\n            if ( typeof key === \"string\" ) {\r\n\r\n                // Handle nested keys, e.g., \"foo.bar\" => { foo: { bar: ___ } }\r\n                options = {};\r\n                parts = key.split( \".\" );\r\n                key = parts.shift();\r\n                if ( parts.length ) {\r\n                    curOption = options[ key ] = langx.mixin( {}, this.options[ key ] );\r\n                    for ( i = 0; i < parts.length - 1; i++ ) {\r\n                        curOption[ parts[ i ] ] = curOption[ parts[ i ] ] || {};\r\n                        curOption = curOption[ parts[ i ] ];\r\n                    }\r\n                    key = parts.pop();\r\n                    if ( arguments.length === 1 ) {\r\n                        return curOption[ key ] === undefined ? null : curOption[ key ];\r\n                    }\r\n                    curOption[ key ] = value;\r\n                } else {\r\n                    if ( arguments.length === 1 ) {\r\n                        return this.options[ key ] === undefined ? null : this.options[ key ];\r\n                    }\r\n                    options[ key ] = value;\r\n                }\r\n            }\r\n\r\n            this._setOptions( options );\r\n\r\n            return this;\r\n        },\r\n\r\n        _setOptions: function( options ) {\r\n            var key;\r\n\r\n            for ( key in options ) {\r\n                this._setOption( key, options[ key ] );\r\n            }\r\n\r\n            return this;\r\n        },\r\n\r\n        _setOption: function( key, value ) {\r\n\r\n            this.options[ key ] = value;\r\n\r\n            return this;\r\n        },\r\n\r\n        getUID : function (prefix) {\r\n            prefix = prefix || \"plugin\";\r\n            do prefix += ~~(Math.random() * 1000000)\r\n            while (document.getElementById(prefix))\r\n            return prefix;\r\n        },\r\n\r\n        elm : function() {\r\n            return this._elm;\r\n        }\r\n\r\n    });\r\n\r\n    $.fn.plugin = function(name,options) {\r\n        var args = slice.call( arguments, 1 ),\r\n            self = this,\r\n            returnValue = this;\r\n\r\n        this.each(function(){\r\n            returnValue = instantiate.apply(self,[this,name].concat(args));\r\n        });\r\n        return returnValue;\r\n    };\r\n\r\n    elmx.partial(\"plugin\",function(name,options) {\r\n        var args = slice.call( arguments, 1 );\r\n        return instantiate.apply(this,[this.domNode,name].concat(args));\r\n    }); \r\n\r\n\r\n    function plugins() {\r\n        return plugins;\r\n    }\r\n     \r\n    langx.mixin(plugins, {\r\n        instantiate,\r\n        Plugin,\r\n        register,\r\n        shortcuts\r\n    });\r\n\r\n    return  skylark.attach(\"domx.plugins\",plugins);\r\n});\ndefine('skylark-domx-plugins/main',[\r\n\t\"./plugins\"\r\n],function(plugins){\r\n\treturn plugins;\r\n});\ndefine('skylark-domx-plugins', ['skylark-domx-plugins/main'], function (main) { return main; });\n\n"]}