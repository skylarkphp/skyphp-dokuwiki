{"version":3,"sources":["skylark-domx-transforms.js"],"names":["define","skylark","langx","browser","datax","styler","css3Transform","normalizeCssProperty","getZoom","scale","zoom","change","el","d","radian","x","y","Cos","Sin","matrix","Math","cos","sin","M11","M12","M21","M22","css","toFixed","transformData","data","calcs","vertical","PI","horizontal","rotate","degress","left","right","hZoom","vZoom","zoomin","zoomout","transforms","forEach","name","calcFunc","args","makeArray","arguments","shift","unshift","apply","this","mixin","reset","appliedTransforms","transform","parentElement","window","DOMMatrix","WebKitCSSMatrix","CSSMatrix","attach","main"],"mappings":"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","file":"../skylark-domx-transforms.js","sourcesContent":["define('skylark-domx-transforms/transforms',[\r\n    \"skylark-langx/skylark\",\r\n    \"skylark-langx/langx\",\r\n    \"skylark-domx-browser\",\r\n    \"skylark-domx-data\",\r\n    \"skylark-domx-styler\"\r\n], function(skylark,langx,browser,datax,styler) {\r\n  var css3Transform = browser.normalizeCssProperty(\"transform\");\r\n\r\n  function getMatrix(radian, x, y) {\r\n    var Cos = Math.cos(radian), Sin = Math.sin(radian);\r\n    return {\r\n      M11: Cos * x, \r\n      M12: -Sin * y,\r\n      M21: Sin * x, \r\n      M22: Cos * y\r\n    };\r\n  }\r\n\r\n  function getZoom(scale, zoom) {\r\n      return scale > 0 && scale > -zoom ? zoom :\r\n        scale < 0 && scale < zoom ? -zoom : 0;\r\n  }\r\n\r\n  function change(el,d) {\r\n      var matrix = getMatrix(d.radian, d.y, d.x);\r\n      styler.css(el,css3Transform, \"matrix(\"\r\n        + matrix.M11.toFixed(16) + \",\" + matrix.M21.toFixed(16) + \",\"\r\n        + matrix.M12.toFixed(16) + \",\" + matrix.M22.toFixed(16) + \", 0, 0)\"\r\n      );      \r\n  }\r\n\r\n  function transformData(el,d) {\r\n    if (d) {\r\n      datax.data(el,\"transform\",d);\r\n    } else {\r\n      d = datax.data(el,\"transform\") || {};\r\n      d.radian = d.radian || 0;\r\n      d.x = d.x || 1;\r\n      d.y = d.y || 1;\r\n      d.zoom = d.zoom || 1;\r\n      return d;     \r\n    }\r\n  }\r\n\r\n  var calcs = {\r\n    //Vertical flip\r\n    vertical : function (d) {\r\n        d.radian = Math.PI - d.radian; \r\n        d.y *= -1;\r\n    },\r\n\r\n   //Horizontal flip\r\n    horizontal : function (d) {\r\n        d.radian = Math.PI - d.radian; \r\n        d.x *= -1;\r\n    },\r\n\r\n    //Rotate according to angle\r\n    rotate : function (d,degress) {\r\n        d.radian = degress * Math.PI / 180;; \r\n    },\r\n\r\n    //Turn left 90 degrees\r\n    left : function (d) {\r\n        d.radian -= Math.PI / 2; \r\n    },\r\n\r\n    //Turn right 90 degrees\r\n    right : function (d) {\r\n        d.radian += Math.PI / 2; \r\n    },\r\n \r\n    //zoom\r\n    scale: function (d,zoom) {\r\n        var hZoom = getZoom(d.y, zoom), vZoom = getZoom(d.x, zoom);\r\n        if (hZoom && vZoom) {\r\n          d.y += hZoom; \r\n          d.x += vZoom;\r\n        }\r\n    }, \r\n\r\n    //zoom in\r\n    zoomin: function (d) { \r\n      calcs.scale(d,0.1); \r\n    },\r\n    \r\n    //zoom out\r\n    zoomout: function (d) { \r\n      calcs.scale(d,-0.1); \r\n    }\r\n\r\n  };\r\n  \r\n  \r\n  function _createApiMethod(calcFunc) {\r\n    return function() {\r\n      var args = langx.makeArray(arguments),\r\n        el = args.shift(),\r\n          d = transformData(el);\r\n        args.unshift(d);\r\n        calcFunc.apply(this,args)\r\n        change(el,d);\r\n        transformData(el,d);\r\n    }\r\n  }\r\n  \r\n\r\n  function matrix(el) {\r\n    var appliedTransforms = '';\r\n    do {\r\n      var transform = styler.css(el, 'transform');\r\n\r\n      if (transform && transform !== 'none') {\r\n        appliedTransforms = transform + ' ' + appliedTransforms;\r\n      }\r\n      /* jshint boss:true */\r\n    } while (el = el.parentElement);\r\n\r\n    if (window.DOMMatrix) {\r\n      return new DOMMatrix(appliedTransforms);\r\n    } else if (window.WebKitCSSMatrix) {\r\n      return new WebKitCSSMatrix(appliedTransforms);\r\n    } else if (window.CSSMatrix) {\r\n      return new CSSMatrix(appliedTransforms);\r\n    }\r\n  }\r\n   \r\n  function transforms() {\r\n    return transforms;\r\n  }\r\n\r\n  [\"vertical\",\"horizontal\",\"rotate\",\"left\",\"right\",\"scale\",\"zoom\",\"zoomin\",\"zoomout\"].forEach(function(name){\r\n    transforms[name] = _createApiMethod(calcs[name]);\r\n  });\r\n\r\n  langx.mixin(transforms, {\r\n    reset : function(el) {\r\n      var d = {\r\n        x : 1,\r\n        y : 1,\r\n        radian : 0,\r\n      }\r\n      change(el,d);\r\n      transformData(el,d);\r\n    },\r\n    matrix\r\n  });\r\n\r\n\r\n  return skylark.attach(\"domx.transforms\", transforms);\r\n});\r\n\ndefine('skylark-domx-transforms/main',[\r\n\t\"./transforms\"\r\n],function(transforms){\r\n\treturn transforms;\r\n});\ndefine('skylark-domx-transforms', ['skylark-domx-transforms/main'], function (main) { return main; });\n\n"]}