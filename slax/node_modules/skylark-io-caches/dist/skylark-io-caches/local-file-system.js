/**
 * skylark-io-caches - The skylarkjs web local storage classes library.
 * @author 
 * @version v0.9.0
 * @link 
 * @license MIT
 */
define(["skylark-langx-objects/mixin","skylark-langx-events/Emitter","skylark-langx-async/Deferred","./caches"],function(e,i,t,n){"use strict";var r=window.requestFileSystem||window.webkitRequestFileSystem;window.resolveLocalFileSystemURL||window.webkitResolveLocalFileSystemURL,window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder;function o(e){var i="";switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:i="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:i="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:i="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:i="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:i="INVALID_STATE_ERR";break;default:i="Unknown Error"}return i}var c=i.inherit({_fs:null,_isPersisted:!0,_cwd:null,init:function(e){this._fs=e,this._cwd=e.root},readfileAsArrayBuffer:function(e,i,t){this._cwd.getFile(e,{},function(e){e.file(function(e){var t=new FileReader;t.onloadend=function(){i(null,this.result)},t.readAsArrayBuffer(e)},t)},t)},readfileAsDataURL:function(e,i,t){this._cwd.getFile(e,{},function(e){e.file(function(e){var t=new FileReader;t.onloadend=function(){i(null,this.result)},t.readAsDataURL(e)},t)},t)},readfileAsText:function(e,i,t){this._cwd.getFile(e,{},function(e){e.file(function(e){var t=new FileReader;t.onloadend=function(){i(null,this.result)},t.readAsText(e)},t)},t)},writefile:function(e,i,t,n){var r=this,o=e.split("/");o=o.slice(0,o.length-1),this.mkdir(o.join("/"),function(){r._cwd.getFile(e,{create:!0},function(e){e.createWriter(function(e){var r=!1;e.onwriteend=function(){if(!r)return r=!0,void this.truncate(this.position);t&&t()},e.onerror=n;var o=i;!o instanceof Blob&&(o=new Blob([i],{type:"text/plain"})),e.write(o)},n)},n)})},rmfile:function(e,i,t){this._cwd.getFile(e,{},function(e){e.remove(function(){i()},t)},t)},readdir:function(e,i,t){this._cwd.getDirectory(e,{},function(e){var n=e.createReader(),r=[];!function e(){n.readEntries(function(t){t.length?(r=r.concat(Array.prototype.slice.call(t).map(function(e){return e.name+(e.isDirectory?"/":"")})),e()):i(null,r)},t)}()},t)},mkdir:function(e,i,t){var n=e.split("/"),r=function(o,c){"."!=c[0]&&""!=c[0]||(c=c.slice(1)),0!=c.length?o.getDirectory(c[0],{create:!0,exclusive:!1},function(o){if(o.isDirectory)c.length&&1!=n.length?r(o,c.slice(1)):i&&i(o);else{var l=new Error(e+" is not a directory");if(!t)throw l;t(l)}},function(e){if(!t)throw e;t(e)}):i(o)};r(this._cwd,n)},rmdir:function(e,i,t){this._cwd.getDirectory(e,{},function(e){e.removeRecursively(function(){i()},t)},t)},copy:function(e,i,t){this._cwd.getFile(e,{},function(e){cwd.getDirectory(i,{},function(i){e.copyTo(i,function(){t()},t)},t)},t)},move:function(e,i,t){this._cwd.getFile(e,{},function(e){cwd.getDirectory(i,{},function(i){e.moveTo(i,function(){t()},t)},t)},t)},chdir:function(e,i){this._cwd.getDirectory(e,{},function(e){cwd=e,fs.onchdir&&fs.onchdir(cwd.fullPath),i()},i)},importFromHost:function(e){for(var i,n=new t,r=0;i=e[r];++r)!function(e){cwd.getFile(i.name,{create:!0,exclusive:!0},function(i){i.createWriter(function(i){i.write(e)},o)},o)}(i);return n.promise},exportToHost:function(){}});return e(c,{isSupported:function(){return!!r},request:function(e,i){e=e||10485760;var n=i?PERSISTENT:TEMPORARY,o=new t;return r(n,e,function(e){var t=new c(e,!!i);o.resolve(t)},function(e){o.reject(e)}),o.promise}}),n.requestLocalFileSystem=c.request,n.LocalFileSystem=c});
//# sourceMappingURL=sourcemaps/local-file-system.js.map
