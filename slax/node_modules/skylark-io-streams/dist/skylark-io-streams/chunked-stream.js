/**
 * skylark-io-streams - The stream features enhancement for skylark utils.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["./streams","./_stream"],function(t,n){var e=n.inherit({klassName:"ChunkedStream",numChunks:0,numChunksLoaded:0,_construct:function(t){for(var n=t.length,e=new Uint8Array(n),s=0;s<n;++s)e[s]=t.charCodeAt(s);DecodeStream.prototype._construct.call(e),this.dict=stream.dict},numChunks:function(){},getMissingChunks:function(){for(var t=[],n=0,e=this.numChunks;n<e;++n)n in this.loadedChunks||t.push(n);return t},getBaseStreams:function(){return[this]},allChunksLoaded:function(){var t=this._;return t.numChunksLoaded===t.numChunks},onReceiveData:function(t,n){var e=t+n.byteLength;assert(t%this.chunkSize==0,"Bad begin offset: "+t);var s=this.bytes.length;assert(e%this.chunkSize==0||e===s,"Bad end offset: "+e),this.bytes.set(new Uint8Array(n),t);var i=this.chunkSize,h=Math.floor(t/i),r=Math.floor((e-1)/i)+1;for(n=h;n<r;++n)n in this.loadedChunks||(this.loadedChunks[n]=!0,++this.numChunksLoaded)},onReceiveInitialData:function(t){this.bytes.set(t),this.initialDataLength=t.length;for(var n=this.end===t.length?this.numChunks:Math.floor(t.length/this.chunkSize),e=0;e<n;e++)this.loadedChunks[e]=!0,++this.numChunksLoaded},ensureRange:function(t,n){if(!(t>=n||n<=this.initialDataLength))for(var e=this.chunkSize,s=Math.floor(t/e),i=Math.floor((n-1)/e)+1,h=s;h<i;++h)if(!(h in this.loadedChunks))throw new MissingDataException(t,n)},nextEmptyChunk:function(t){for(var n=t,e=this.numChunks;n<e;++n)if(!(n in this.loadedChunks))return n;for(n=0;n<t;++n)if(!(n in this.loadedChunks))return n;return null},hasChunk:function(t){return t in this._.loadedChunks},getByte:function(){var t=this.pos;return t>=this.end?-1:(this.ensureRange(t,t+1),this.bytes[this.pos++])},getBytes:function(t){var n=this.bytes,e=this.pos,s=this.end;if(!t)return this.ensureRange(e,s),n.subarray(e,s);var i=e+t;return i>s&&(i=s),this.ensureRange(e,i),this.pos=i,n.subarray(e,i)},peekBytes:function(t){var n=this.getBytes(t);return this.pos-=n.length,n},getByteRange:function(t,n){return this.ensureRange(t,n),this.bytes.subarray(t,n)},skip:function(t){t||(t=1),this.pos+=t},reset:function(){this.pos=this.start},moveStart:function(){this.start=this.pos},makeSubStream:function(t,n,e){function s(){}s.prototype=Object.create(this),s.prototype.getMissingChunks=function(){for(var t=this.chunkSize,n=Math.floor(this.start/t),e=Math.floor((this.end-1)/t)+1,s=[],i=n;i<e;++i)i in this.loadedChunks||s.push(i);return s};var i=new s;return i.pos=i.start=t,i.end=t+n||this.end,i.dict=e,i}});return t.ChunkedStream=e});
//# sourceMappingURL=sourcemaps/chunked-stream.js.map
