{"version":3,"sources":["Droppable.js"],"names":["define","langx","eventer","noder","$","plugins","JqPlugin","patch","ddmanager","Droppable","inherit","klassName","pluginName","widgetEventPrefix","options","accept","addClasses","greedy","scope","tolerance","activate","deactivate","drop","out","over","_create","proportions","o","this","isover","isout","isFunction","d","is","arguments","length","width","element","offsetWidth","height","offsetHeight","_addToManager","_addClass","droppables","push","_splice","i","splice","_destroy","_setOption","key","value","_super","_activate","event","draggable","current","_addActiveClass","_trigger","ui","_deactivate","_removeActiveClass","_over","currentItem","call","_addHoverClass","_out","_removeHoverClass","_drop","custom","childrenIntersection","find","not","each","inst","droppable","disabled","intersect","extend","offset","c","helper","position","positionAbs","_removeClass","register"],"mappings":"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","file":"../Droppable.js","sourcesContent":["define( [\r\n\t\"skylark-langx/langx\",\r\n\t\"skylark-domx-eventer\",\r\n\t\"skylark-domx-noder\",\r\n\t\"skylark-domx-query\",\r\n\t\"skylark-domx-plugins-base\",\r\n\t\"skylark-jquery/JqueryPlugin\",\r\n\t\"./patch\",\r\n\t\"./ddmanager\",\r\n],function(langx, eventer, noder, $, plugins, JqPlugin, patch, ddmanager) {\r\n\r\n\tvar Droppable = JqPlugin.inherit({\r\n\t\tklassName: \"Droppable\",\r\n\r\n\t\tpluginName : \"ui.Droppable\",\r\n\r\n\t\twidgetEventPrefix: \"drop\",\r\n\t\t\r\n\t\toptions: {\r\n\t\t\taccept: \"*\",\r\n\t\t\taddClasses: true,\r\n\t\t\tgreedy: false,\r\n\t\t\tscope: \"default\",\r\n\t\t\ttolerance: \"intersect\",\r\n\r\n\t\t\t// Callbacks\r\n\t\t\tactivate: null,\r\n\t\t\tdeactivate: null,\r\n\t\t\tdrop: null,\r\n\t\t\tout: null,\r\n\t\t\tover: null\r\n\t\t},\r\n\t\t_create: function() {\r\n\r\n\t\t\tvar proportions,\r\n\t\t\t\to = this.options,\r\n\t\t\t\taccept = o.accept;\r\n\r\n\t\t\tthis.isover = false;\r\n\t\t\tthis.isout = true;\r\n\r\n\t\t\tthis.accept = langx.isFunction( accept ) ? accept : function( d ) {\r\n\t\t\t\treturn d.is( accept );\r\n\t\t\t};\r\n\r\n\t\t\tthis.proportions = function( /* valueToWrite */ ) {\r\n\t\t\t\tif ( arguments.length ) {\r\n\r\n\t\t\t\t\t// Store the droppable's proportions\r\n\t\t\t\t\tproportions = arguments[ 0 ];\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// Retrieve or derive the droppable's proportions\r\n\t\t\t\t\treturn proportions ?\r\n\t\t\t\t\t\tproportions :\r\n\t\t\t\t\t\tproportions = {\r\n\t\t\t\t\t\t\twidth: this.element[ 0 ].offsetWidth,\r\n\t\t\t\t\t\t\theight: this.element[ 0 ].offsetHeight\r\n\t\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tthis._addToManager( o.scope );\r\n\r\n\t\t\to.addClasses && this._addClass( \"ui-droppable\" );\r\n\r\n\t\t},\r\n\r\n\t\t_addToManager: function( scope ) {\r\n\r\n\t\t\t// Add the reference and positions to the manager\r\n\t\t\tddmanager.droppables[ scope ] = ddmanager.droppables[ scope ] || [];\r\n\t\t\tddmanager.droppables[ scope ].push( this );\r\n\t\t},\r\n\r\n\t\t_splice: function( drop ) {\r\n\t\t\tvar i = 0;\r\n\t\t\tfor ( ; i < drop.length; i++ ) {\r\n\t\t\t\tif ( drop[ i ] === this ) {\r\n\t\t\t\t\tdrop.splice( i, 1 );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_destroy: function() {\r\n\t\t\tvar drop = ddmanager.droppables[ this.options.scope ];\r\n\r\n\t\t\tthis._splice( drop );\r\n\t\t},\r\n\r\n\t\t_setOption: function( key, value ) {\r\n\r\n\t\t\tif ( key === \"accept\" ) {\r\n\t\t\t\tthis.accept = langx.isFunction( value ) ? value : function( d ) {\r\n\t\t\t\t\treturn d.is( value );\r\n\t\t\t\t};\r\n\t\t\t} else if ( key === \"scope\" ) {\r\n\t\t\t\tvar drop = ddmanager.droppables[ this.options.scope ];\r\n\r\n\t\t\t\tthis._splice( drop );\r\n\t\t\t\tthis._addToManager( value );\r\n\t\t\t}\r\n\r\n\t\t\tthis._super( key, value );\r\n\t\t},\r\n\r\n\t\t_activate: function( event ) {\r\n\t\t\tvar draggable = ddmanager.current;\r\n\r\n\t\t\tthis._addActiveClass();\r\n\t\t\tif ( draggable ) {\r\n\t\t\t\tthis._trigger( \"activate\", event, this.ui( draggable ) );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_deactivate: function( event ) {\r\n\t\t\tvar draggable = ddmanager.current;\r\n\r\n\t\t\tthis._removeActiveClass();\r\n\t\t\tif ( draggable ) {\r\n\t\t\t\tthis._trigger( \"deactivate\", event, this.ui( draggable ) );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_over: function( event ) {\r\n\r\n\t\t\tvar draggable = ddmanager.current;\r\n\r\n\t\t\t// Bail if draggable and droppable are same element\r\n\t\t\tif ( !draggable || ( draggable.currentItem ||\r\n\t\t\t\t\tdraggable.element )[ 0 ] === this.element[ 0 ] ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.accept.call( this.element[ 0 ], ( draggable.currentItem ||\r\n\t\t\t\t\tdraggable.element ) ) ) {\r\n\t\t\t\tthis._addHoverClass();\r\n\t\t\t\tthis._trigger( \"over\", event, this.ui( draggable ) );\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t_out: function( event ) {\r\n\r\n\t\t\tvar draggable = ddmanager.current;\r\n\r\n\t\t\t// Bail if draggable and droppable are same element\r\n\t\t\tif ( !draggable || ( draggable.currentItem ||\r\n\t\t\t\t\tdraggable.element )[ 0 ] === this.element[ 0 ] ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.accept.call( this.element[ 0 ], ( draggable.currentItem ||\r\n\t\t\t\t\tdraggable.element ) ) ) {\r\n\t\t\t\tthis._removeHoverClass();\r\n\t\t\t\tthis._trigger( \"out\", event, this.ui( draggable ) );\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\t_drop: function( event, custom ) {\r\n\r\n\t\t\tvar draggable = custom || ddmanager.current,\r\n\t\t\t\tchildrenIntersection = false;\r\n\r\n\t\t\t// Bail if draggable and droppable are same element\r\n\t\t\tif ( !draggable || ( draggable.currentItem ||\r\n\t\t\t\t\tdraggable.element )[ 0 ] === this.element[ 0 ] ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tthis.element\r\n\t\t\t\t.find( \":data(ui-droppable)\" )\r\n\t\t\t\t.not( \".ui-draggable-dragging\" )\r\n\t\t\t\t.each( function() {\r\n\t\t\t\t\tvar inst = $( this ).droppable( \"instance\" );\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tinst.options.greedy &&\r\n\t\t\t\t\t\t!inst.options.disabled &&\r\n\t\t\t\t\t\tinst.options.scope === draggable.options.scope &&\r\n\t\t\t\t\t\tinst.accept.call(\r\n\t\t\t\t\t\t\tinst.element[ 0 ], ( draggable.currentItem || draggable.element )\r\n\t\t\t\t\t\t) &&\r\n\t\t\t\t\t\tddmanager.intersect(\r\n\t\t\t\t\t\t\tdraggable,\r\n\t\t\t\t\t\t\tlangx.extend( inst, { offset: inst.element.offset() } ),\r\n\t\t\t\t\t\t\tinst.options.tolerance, event\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tchildrenIntersection = true;\r\n\t\t\t\t\t\treturn false; }\r\n\t\t\t\t} );\r\n\t\t\tif ( childrenIntersection ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.accept.call( this.element[ 0 ],\r\n\t\t\t\t\t( draggable.currentItem || draggable.element ) ) ) {\r\n\t\t\t\tthis._removeActiveClass();\r\n\t\t\t\tthis._removeHoverClass();\r\n\r\n\t\t\t\tthis._trigger( \"drop\", event, this.ui( draggable ) );\r\n\t\t\t\treturn this.element;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t},\r\n\r\n\t\tui: function( c ) {\r\n\t\t\treturn {\r\n\t\t\t\tdraggable: ( c.currentItem || c.element ),\r\n\t\t\t\thelper: c.helper,\r\n\t\t\t\tposition: c.position,\r\n\t\t\t\toffset: c.positionAbs\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t// Extension points just to make backcompat sane and avoid duplicating logic\r\n\t\t// TODO: Remove in 1.13 along with call to it below\r\n\t\t_addHoverClass: function() {\r\n\t\t\tthis._addClass( \"ui-droppable-hover\" );\r\n\t\t},\r\n\r\n\t\t_removeHoverClass: function() {\r\n\t\t\tthis._removeClass( \"ui-droppable-hover\" );\r\n\t\t},\r\n\r\n\t\t_addActiveClass: function() {\r\n\t\t\tthis._addClass( \"ui-droppable-active\" );\r\n\t\t},\r\n\r\n\t\t_removeActiveClass: function() {\r\n\t\t\tthis._removeClass( \"ui-droppable-active\" );\r\n\t\t}\r\n\t} );\r\n\r\n\tplugins.register(Droppable,\"droppable\");\r\n\r\n\treturn Droppable;\r\n\r\n});\r\n"]}