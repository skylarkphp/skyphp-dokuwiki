{"version":3,"sources":["Mouse.js"],"names":["define","browser","datax","$","plugins","JqPlugin","mouseHandled","document","on","MousePlugin","inherit","klassName","pluginName","options","cancel","distance","delay","_mouseInit","that","this","element","event","_mouseDown","data","target","removeData","stopImmediatePropagation","started","_mouseDestroy","off","_mouseMoveDelegate","_mouseUpDelegate","_mouseMoved","_mouseStarted","_mouseUp","_mouseDownEvent","btnIsLeft","which","elIsCancel","nodeName","closest","length","_mouseCapture","mouseDelayMet","_mouseDelayTimer","setTimeout","_mouseDistanceMet","_mouseDelayMet","_mouseStart","preventDefault","_mouseMove","ie","documentMode","button","originalEvent","altKey","ctrlKey","metaKey","shiftKey","ignoreMissingWhich","_mouseDrag","_mouseStop","clearTimeout","Math","max","abs","pageX","pageY","register"],"mappings":"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","file":"../Mouse.js","sourcesContent":["define( [\r\n\t\"skylark-domx-browser\",\r\n\t\"skylark-domx-data\",\r\n\t\"skylark-domx-query\",\r\n\t\"skylark-domx-plugins\",\r\n\t\"skylark-jquery/JqueryPlugin\"\r\n],function(browser, datax, $, plugins, JqPlugin) {\r\n\r\n\tvar mouseHandled = false;\r\n\t$( document ).on( \"mouseup\", function() {\r\n\t\tmouseHandled = false;\r\n\t} );\r\n\r\n\tvar MousePlugin = JqPlugin.inherit({\r\n\t\tklassName : \"MousePlugin\",\r\n\r\n\t\tpluginName : \"ui.mouse\",\r\n\r\n\t\toptions: {\r\n\t\t\tcancel: \"input, textarea, button, select, option\",\r\n\t\t\tdistance: 1,\r\n\t\t\tdelay: 0\r\n\t\t},\r\n\t\t_mouseInit: function() {\r\n\t\t\tvar that = this;\r\n\r\n\t\t\tthis.element\r\n\t\t\t\t.on( \"mousedown.\" + this.pluginName, function( event ) {\r\n\t\t\t\t\treturn that._mouseDown( event );\r\n\t\t\t\t} )\r\n\t\t\t\t.on( \"click.\" + this.pluginName, function( event ) {\r\n\t\t\t\t\tif ( true === datax.data( event.target, that.pluginName + \".preventClickEvent\" ) ) {\r\n\t\t\t\t\t\tdatax.removeData( event.target, that.pluginName + \".preventClickEvent\" );\r\n\t\t\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} );\r\n\r\n\t\t\tthis.started = false;\r\n\t\t},\r\n\r\n\t\t// TODO: make sure destroying one instance of mouse doesn't mess with\r\n\t\t// other instances of mouse\r\n\t\t_mouseDestroy: function() {\r\n\t\t\tthis.element.off( \".\" + this.pluginName );\r\n\t\t\tif ( this._mouseMoveDelegate ) {\r\n\t\t\t\tthis.document\r\n\t\t\t\t\t.off( \"mousemove.\" + this.pluginName, this._mouseMoveDelegate )\r\n\t\t\t\t\t.off( \"mouseup.\" + this.pluginName, this._mouseUpDelegate );\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_mouseDown: function( event ) {\r\n\r\n\t\t\t// don't let more than one widget handle mouseStart\r\n\t\t\tif ( mouseHandled ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis._mouseMoved = false;\r\n\r\n\t\t\t// We may have missed mouseup (out of window)\r\n\t\t\t( this._mouseStarted && this._mouseUp( event ) );\r\n\r\n\t\t\tthis._mouseDownEvent = event;\r\n\r\n\t\t\tvar that = this,\r\n\t\t\t\tbtnIsLeft = ( event.which === 1 ),\r\n\r\n\t\t\t\t// event.target.nodeName works around a bug in IE 8 with\r\n\t\t\t\t// disabled inputs (#7620)\r\n\t\t\t\telIsCancel = ( typeof this.options.cancel === \"string\" && event.target.nodeName ?\r\n\t\t\t\t\t$( event.target ).closest( this.options.cancel ).length : false );\r\n\t\t\tif ( !btnIsLeft || elIsCancel || !this._mouseCapture( event ) ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tthis.mouseDelayMet = !this.options.delay;\r\n\t\t\tif ( !this.mouseDelayMet ) {\r\n\t\t\t\tthis._mouseDelayTimer = setTimeout( function() {\r\n\t\t\t\t\tthat.mouseDelayMet = true;\r\n\t\t\t\t}, this.options.delay );\r\n\t\t\t}\r\n\r\n\t\t\tif ( this._mouseDistanceMet( event ) && this._mouseDelayMet( event ) ) {\r\n\t\t\t\tthis._mouseStarted = ( this._mouseStart( event ) !== false );\r\n\t\t\t\tif ( !this._mouseStarted ) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Click event may never have fired (Gecko & Opera)\r\n\t\t\tif ( true === datax.data( event.target, this.pluginName + \".preventClickEvent\" ) ) {\r\n\t\t\t\tdatax.removeData( event.target, this.pluginName + \".preventClickEvent\" );\r\n\t\t\t}\r\n\r\n\t\t\t// These delegates are required to keep context\r\n\t\t\tthis._mouseMoveDelegate = function( event ) {\r\n\t\t\t\treturn that._mouseMove( event );\r\n\t\t\t};\r\n\t\t\tthis._mouseUpDelegate = function( event ) {\r\n\t\t\t\treturn that._mouseUp( event );\r\n\t\t\t};\r\n\r\n\t\t\tthis.document\r\n\t\t\t\t.on( \"mousemove.\" + this.pluginName, this._mouseMoveDelegate )\r\n\t\t\t\t.on( \"mouseup.\" + this.pluginName, this._mouseUpDelegate );\r\n\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tmouseHandled = true;\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\t_mouseMove: function( event ) {\r\n\r\n\t\t\t// Only check for mouseups outside the document if you've moved inside the document\r\n\t\t\t// at least once. This prevents the firing of mouseup in the case of IE<9, which will\r\n\t\t\t// fire a mousemove event if content is placed under the cursor. See #7778\r\n\t\t\t// Support: IE <9\r\n\t\t\tif ( this._mouseMoved ) {\r\n\r\n\t\t\t\t// IE mouseup check - mouseup happened when mouse was out of window\r\n\t\t\t\tif ( browser.ie && ( !document.documentMode || document.documentMode < 9 ) &&\r\n\t\t\t\t\t\t!event.button ) {\r\n\t\t\t\t\treturn this._mouseUp( event );\r\n\r\n\t\t\t\t// Iframe mouseup check - mouseup occurred in another document\r\n\t\t\t\t} else if ( !event.which ) {\r\n\r\n\t\t\t\t\t// Support: Safari <=8 - 9\r\n\t\t\t\t\t// Safari sets which to 0 if you press any of the following keys\r\n\t\t\t\t\t// during a drag (#14461)\r\n\t\t\t\t\tif ( event.originalEvent.altKey || event.originalEvent.ctrlKey ||\r\n\t\t\t\t\t\t\tevent.originalEvent.metaKey || event.originalEvent.shiftKey ) {\r\n\t\t\t\t\t\tthis.ignoreMissingWhich = true;\r\n\t\t\t\t\t} else if ( !this.ignoreMissingWhich ) {\r\n\t\t\t\t\t\treturn this._mouseUp( event );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ( event.which || event.button ) {\r\n\t\t\t\tthis._mouseMoved = true;\r\n\t\t\t}\r\n\r\n\t\t\tif ( this._mouseStarted ) {\r\n\t\t\t\tthis._mouseDrag( event );\r\n\t\t\t\treturn event.preventDefault();\r\n\t\t\t}\r\n\r\n\t\t\tif ( this._mouseDistanceMet( event ) && this._mouseDelayMet( event ) ) {\r\n\t\t\t\tthis._mouseStarted =\r\n\t\t\t\t\t( this._mouseStart( this._mouseDownEvent, event ) !== false );\r\n\t\t\t\t( this._mouseStarted ? this._mouseDrag( event ) : this._mouseUp( event ) );\r\n\t\t\t}\r\n\r\n\t\t\treturn !this._mouseStarted;\r\n\t\t},\r\n\r\n\t\t_mouseUp: function( event ) {\r\n\t\t\tthis.document\r\n\t\t\t\t.off( \"mousemove.\" + this.pluginName, this._mouseMoveDelegate )\r\n\t\t\t\t.off( \"mouseup.\" + this.pluginName, this._mouseUpDelegate );\r\n\r\n\t\t\tif ( this._mouseStarted ) {\r\n\t\t\t\tthis._mouseStarted = false;\r\n\r\n\t\t\t\tif ( event.target === this._mouseDownEvent.target ) {\r\n\t\t\t\t\tdatax.data( event.target, this.pluginName + \".preventClickEvent\", true );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._mouseStop( event );\r\n\t\t\t}\r\n\r\n\t\t\tif ( this._mouseDelayTimer ) {\r\n\t\t\t\tclearTimeout( this._mouseDelayTimer );\r\n\t\t\t\tdelete this._mouseDelayTimer;\r\n\t\t\t}\r\n\r\n\t\t\tthis.ignoreMissingWhich = false;\r\n\t\t\tmouseHandled = false;\r\n\t\t\tevent.preventDefault();\r\n\t\t},\r\n\r\n\t\t_mouseDistanceMet: function( event ) {\r\n\t\t\treturn ( Math.max(\r\n\t\t\t\t\tMath.abs( this._mouseDownEvent.pageX - event.pageX ),\r\n\t\t\t\t\tMath.abs( this._mouseDownEvent.pageY - event.pageY )\r\n\t\t\t\t) >= this.options.distance\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t_mouseDelayMet: function( /* event */ ) {\r\n\t\t\treturn this.mouseDelayMet;\r\n\t\t},\r\n\r\n\t\t// These are placeholder methods, to be overriden by extending plugin\r\n\t\t_mouseStart: function( /* event */ ) {},\r\n\t\t_mouseDrag: function( /* event */ ) {},\r\n\t\t_mouseStop: function( /* event */ ) {},\r\n\t\t_mouseCapture: function( /* event */ ) { return true; }\r\n\t});\r\n\r\n\r\n\tplugins.register(MousePlugin);\r\n\r\n\treturn MousePlugin;\r\n});\r\n"]}