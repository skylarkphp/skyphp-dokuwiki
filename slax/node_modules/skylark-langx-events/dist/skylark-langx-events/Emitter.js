/**
 * skylark-langx-events - The skylark JavaScript language extension library.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx-types","skylark-langx-objects","skylark-langx-arrays","skylark-langx-klass","./events","./event","./listener"],function(t,n,e,i,r,s,a){var o=Array.prototype.slice,u=e.compact,h=t.isDefined,l=t.isPlainObject,c=t.isFunction,f=t.isString,p=(t.isEmptyObject,n.mixin);n.safeMixin;function d(t){var n=(""+t).split(".");return{name:n[0],ns:n.slice(1).join(" ")}}var g=new Map,m=a.inherit({_prepareArgs:function(t,n){return n=h(n)?[t].concat(n):[t]},on:function(t,n,e,i,r,s){var a=this,o=this._hub||(this._hub={});if(l(t))return r=i,each(t,function(t,i){a.on(t,n,e,i,r,s)}),this;if(f(n)||c(i)||(r=i,i=e,e=n,n=void 0),c(e)&&(r=i,i=e,e=null),!i)throw new Error("No callback function");if(!c(i))throw new Error("The callback  is not afunction");return f(t)&&(t=t.split(/\s/)),t.forEach(function(t){var a=d(t),u=a.name,h=a.ns;(o[u]||(o[u]=[])).push({fn:i,selector:n,data:e,ctx:r,ns:h,one:s})}),this},one:function(t,n,e,i,r){return this.on(t,n,e,i,r,1)},emit:function(t){if(!this._hub)return this;var n=this;f(t)&&(t=new s(t)),Object.defineProperty(t,"target",{value:this});var e=o.call(arguments,1);return e=this._prepareArgs(t,e),[t.type||t.name,"all"].forEach(function(i){var r=d(i),s=r.name,a=r.ns,o=n._hub[s];if(o){for(var h=o.length,c=!1,f=0;f<h;f++){if(t.isImmediatePropagationStopped&&t.isImmediatePropagationStopped())return this;var g=o[f];(!a||g.ns&&g.ns.startsWith(a))&&(g.data&&(t.data=p({},g.data,t.data)),2==e.length&&l(e[1])&&(t.data=t.data||{},p(t.data,e[1])),g.fn.apply(g.ctx,e),g.one&&(o[f]=null,c=!0))}c&&(n._hub[i]=u(o))}}),this},queueEmit:function(t){const n=t.type||t;let e=g.get(this);e||(e=new Map,g.set(this,e));const i=e.get(n);e.delete(n),window.clearTimeout(i);const r=window.setTimeout(()=>{0===e.size&&(e=null,g.delete(this)),this.trigger(t)},0);e.set(n,r)},listened:function(t){return((this._hub||(this._events={}))[t]||[]).length>0},off:function(t,n){if(t){var e=this._hub||(this._hub={});return f(t)&&(t=t.split(/\s/)),t.forEach(function(t){var i=d(t),r=i.name,s=i.ns,a=e[r];if(a){var o=[];if(n||s)for(var u=0,h=a.length;u<h;u++)n&&a[u].fn!==n&&a[u].fn._!==n?o.push(a[u]):!s||a[u].ns&&0==a[u].ns.indexOf(s)||o.push(a[u]);o.length?e[r]=o:delete e[r]}}),this}this._hub=null},trigger:function(){return this.emit.apply(this,arguments)},queueTrigger:function(t){return this.queueEmit.apply(this,arguments)}});return r.Emitter=m});
//# sourceMappingURL=sourcemaps/emitter.js.map
