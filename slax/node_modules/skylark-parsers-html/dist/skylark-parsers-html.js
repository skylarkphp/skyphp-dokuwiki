/**
 * skylark-parsers-html - The html features enhancement for skylark utils.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,e){var n=e.define,require=e.require,i="function"==typeof n&&n.amd,s=!i&&"undefined"!=typeof exports;if(!i&&!n){var r={};n=e.define=function(t,e,n){"function"==typeof n?(r[t]={factory:n,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var n=e.split("/"),i=t.split("/");n.pop();for(var s=0;s<i.length;s++)"."!=i[s]&&(".."==i[s]?n.pop():n.push(i[s]));return n.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):r[t]={factory:null,resolved:!0,exports:n}},require=e.require=function(t){if(!r.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=r[t];if(!module.resolved){var n=[];module.deps.forEach(function(t){n.push(require(t))}),module.exports=module.factory.apply(e,n)||null,module.resolved=!0}return module.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-parsers-html/html",["skylark-langx/skylark"],function(t){return t.attach("domx.html",{})}),t("skylark-parsers-html/primitives/beautify-html",["skylark-parsers-css/beautify","skylark-parsers-javascript/beautify"],function(t,e){function n(t){return t.replace(/\s+$/g,"")}return{html_beautify:function(i,s){return function(t,e,i,s){var r,h,a,o,_,p,l,u,c,g,f;void 0!==(e=e||{}).wrap_line_length&&0!==parseInt(e.wrap_line_length,10)||void 0===e.max_char||0===parseInt(e.max_char,10)||(e.wrap_line_length=e.max_char);h=void 0!==e.indent_inner_html&&e.indent_inner_html,a=void 0===e.indent_size?4:parseInt(e.indent_size,10),o=void 0===e.indent_char?" ":e.indent_char,p=void 0===e.brace_style?"collapse":e.brace_style,_=0===parseInt(e.wrap_line_length,10)?32786:parseInt(e.wrap_line_length||250,10),l=e.unformatted||["a","span","img","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"],u=void 0===e.preserve_newlines||e.preserve_newlines,c=u?isNaN(parseInt(e.max_preserve_newlines,10))?32786:parseInt(e.max_preserve_newlines,10):0,g=void 0!==e.indent_handlebars&&e.indent_handlebars,f=void 0!==e.end_with_newline&&e.end_with_newline,(r=new function(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.newlines=0,this.indent_content=h,this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(t,e){for(var n=0;n<e.length;n++)if(t===e[n])return!0;return!1}},this.is_whitespace=function(t){for(;0<t.length;t++)if(!this.Utils.in_array(t.charAt(0),this.Utils.whitespace))return!1;return!0},this.traverse_whitespace=function(){var t="";if(t=this.input.charAt(this.pos),this.Utils.in_array(t,this.Utils.whitespace)){for(this.newlines=0;this.Utils.in_array(t,this.Utils.whitespace);)u&&"\n"===t&&this.newlines<=c&&(this.newlines+=1),this.pos++,t=this.input.charAt(this.pos);return!0}return!1},this.space_or_wrap=function(t){this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,t),this.print_indentation(t)):(this.line_char_count++,t.push(" "))},this.get_content=function(){for(var t="",e=[];"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return e.length?e.join(""):["","TK_EOF"];if(this.traverse_whitespace())this.space_or_wrap(e);else{if(g){var n=this.input.substr(this.pos,3);if("{{#"===n||"{{/"===n)break;if("{{"===this.input.substr(this.pos,2)&&"{{else}}"===this.get_tag(!0))break}t=this.input.charAt(this.pos),this.pos++,this.line_char_count++,e.push(t)}}return e.length?e.join(""):""},this.get_contents_to=function(t){if(this.pos===this.input.length)return["","TK_EOF"];var e="",n=new RegExp("</"+t+"\\s*>","igm");n.lastIndex=this.pos;var i=n.exec(this.input),s=i?i.index:this.input.length;return this.pos<s&&(e=this.input.substring(this.pos,s),this.pos=s),e},this.record_tag=function(t){this.tags[t+"count"]?(this.tags[t+"count"]++,this.tags[t+this.tags[t+"count"]]=this.indent_level):(this.tags[t+"count"]=1,this.tags[t+this.tags[t+"count"]]=this.indent_level),this.tags[t+this.tags[t+"count"]+"parent"]=this.tags.parent,this.tags.parent=t+this.tags[t+"count"]},this.retrieve_tag=function(t){if(this.tags[t+"count"]){for(var e=this.tags.parent;e&&t+this.tags[t+"count"]!==e;)e=this.tags[e+"parent"];e&&(this.indent_level=this.tags[t+this.tags[t+"count"]],this.tags.parent=this.tags[e+"parent"]),delete this.tags[t+this.tags[t+"count"]+"parent"],delete this.tags[t+this.tags[t+"count"]],1===this.tags[t+"count"]?delete this.tags[t+"count"]:this.tags[t+"count"]--}},this.indent_to_tag=function(t){if(this.tags[t+"count"]){for(var e=this.tags.parent;e&&t+this.tags[t+"count"]!==e;)e=this.tags[e+"parent"];e&&(this.indent_level=this.tags[t+this.tags[t+"count"]])}},this.get_tag=function(t){var e,n,i="",s=[],r="",h=!1,a=this.pos,o=this.line_char_count;t=void 0!==t&&t;do{if(this.pos>=this.input.length)return t&&(this.pos=a,this.line_char_count=o),s.length?s.join(""):["","TK_EOF"];if(i=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(i,this.Utils.whitespace))h=!0;else{if("'"!==i&&'"'!==i||(i+=this.get_unformatted(i),h=!0),"="===i&&(h=!1),s.length&&"="!==s[s.length-1]&&">"!==i&&h&&(this.space_or_wrap(s),h=!1),g&&"<"===n&&i+this.input.charAt(this.pos)==="{{"&&(i+=this.get_unformatted("}}"),s.length&&" "!==s[s.length-1]&&"<"!==s[s.length-1]&&(i=" "+i),h=!0),"<"!==i||n||(e=this.pos-1,n="<"),g&&!n&&s.length>=2&&"{"===s[s.length-1]&&"{"==s[s.length-2]&&(e="#"===i||"/"===i?this.pos-3:this.pos-2,n="{"),this.line_char_count++,s.push(i),s[1]&&"!"===s[1]){s=[this.get_comment(e)];break}if(g&&"{"===n&&s.length>2&&"}"===s[s.length-2]&&"}"===s[s.length-1])break}}while(">"!==i);var _,p,u=s.join("");_=-1!==u.indexOf(" ")?u.indexOf(" "):"{"===u[0]?u.indexOf("}"):u.indexOf(">"),p="<"!==u[0]&&g?"#"===u[2]?3:2:1;var c=u.substring(p,_).toLowerCase();return"/"===u.charAt(u.length-2)||this.Utils.in_array(c,this.Utils.single_token)?t||(this.tag_type="SINGLE"):g&&"{"===u[0]&&"else"===c?t||(this.indent_to_tag("if"),this.tag_type="HANDLEBARS_ELSE",this.indent_content=!0,this.traverse_whitespace()):this.is_unformatted(c,l)?(r=this.get_unformatted("</"+c+">",u),s.push(r),this.pos,this.tag_type="SINGLE"):"script"===c&&(-1===u.search("type")||u.search("type")>-1&&u.search(/\b(text|application)\/(x-)?(javascript|ecmascript|jscript|livescript)/)>-1)?t||(this.record_tag(c),this.tag_type="SCRIPT"):"style"===c&&(-1===u.search("type")||u.search("type")>-1&&u.search("text/css")>-1)?t||(this.record_tag(c),this.tag_type="STYLE"):"!"===c.charAt(0)?t||(this.tag_type="SINGLE",this.traverse_whitespace()):t||("/"===c.charAt(0)?(this.retrieve_tag(c.substring(1)),this.tag_type="END"):(this.record_tag(c),"html"!==c.toLowerCase()&&(this.indent_content=!0),this.tag_type="START"),this.traverse_whitespace()&&this.space_or_wrap(s),this.Utils.in_array(c,this.Utils.extra_liners)&&(this.print_newline(!1,this.output),this.output.length&&"\n"!==this.output[this.output.length-2]&&this.print_newline(!0,this.output))),t&&(this.pos=a,this.line_char_count=o),s.join("")},this.get_comment=function(t){var e="",n=">",i=!1;for(this.pos=t,input_char=this.input.charAt(this.pos),this.pos++;this.pos<=this.input.length&&((e+=input_char)[e.length-1]!==n[n.length-1]||-1===e.indexOf(n));)!i&&e.length<10&&(0===e.indexOf("<![if")?(n="<![endif]>",i=!0):0===e.indexOf("<![cdata[")?(n="]]>",i=!0):0===e.indexOf("<![")?(n="]>",i=!0):0===e.indexOf("\x3c!--")&&(n="--\x3e",i=!0)),input_char=this.input.charAt(this.pos),this.pos++;return e},this.get_unformatted=function(t,e){if(e&&-1!==e.toLowerCase().indexOf(t))return"";var n="",i="",s=0,r=!0;do{if(this.pos>=this.input.length)return i;if(n=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(n,this.Utils.whitespace)){if(!r){this.line_char_count--;continue}if("\n"===n||"\r"===n){i+="\n",this.line_char_count=0;continue}}i+=n,this.line_char_count++,r=!0,g&&"{"===n&&i.length&&"{"===i[i.length-2]&&(s=(i+=this.get_unformatted("}}")).length)}while(-1===i.toLowerCase().indexOf(t,s));return i},this.get_token=function(){var t;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var e=this.last_token.substr(7);return"string"!=typeof(t=this.get_contents_to(e))?t:[t,"TK_"+e]}return"CONTENT"===this.current_mode?"string"!=typeof(t=this.get_content())?t:[t,"TK_CONTENT"]:"TAG"===this.current_mode?"string"!=typeof(t=this.get_tag())?t:[t,"TK_TAG_"+this.tag_type]:void 0},this.get_full_indent=function(t){return(t=this.indent_level+t||0)<1?"":Array(t+1).join(this.indent_string)},this.is_unformatted=function(t,e){if(!this.Utils.in_array(t,e))return!1;if("a"!==t.toLowerCase()||!this.Utils.in_array("a",e))return!0;var n=(this.get_tag(!0)||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!(n&&!this.Utils.in_array(n,e))},this.printer=function(t,e,i,s,r){this.input=t||"",this.output=[],this.indent_character=e,this.indent_string="",this.indent_size=i,this.brace_style=r,this.indent_level=0,this.wrap_line_length=s,this.line_char_count=0;for(var h=0;h<this.indent_size;h++)this.indent_string+=this.indent_character;this.print_newline=function(t,e){this.line_char_count=0,e&&e.length&&(t||"\n"!==e[e.length-1])&&("\n"!==e[e.length-1]&&(e[e.length-1]=n(e[e.length-1])),e.push("\n"))},this.print_indentation=function(t){for(var e=0;e<this.indent_level;e++)t.push(this.indent_string),this.line_char_count+=this.indent_string.length},this.print_token=function(t){this.is_whitespace(t)&&!this.output.length||((t||""!==t)&&this.output.length&&"\n"===this.output[this.output.length-1]&&(this.print_indentation(this.output),t=t.replace(/^\s+/g,"")),this.print_token_raw(t))},this.print_token_raw=function(t){this.newlines>0&&(t=n(t)),t&&""!==t&&(t.length>1&&"\n"===t[t.length-1]?(this.output.push(t.slice(0,-1)),this.print_newline(!1,this.output)):this.output.push(t));for(var e=0;e<this.newlines;e++)this.print_newline(e>0,this.output);this.newlines=0},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}).printer(t,o,a,_,p);for(;;){var d=r.get_token();if(r.token_text=d[0],r.token_type=d[1],"TK_EOF"===r.token_type)break;switch(r.token_type){case"TK_TAG_START":r.print_newline(!1,r.output),r.print_token(r.token_text),r.indent_content&&(r.indent(),r.indent_content=!1),r.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":r.print_newline(!1,r.output),r.print_token(r.token_text),r.current_mode="CONTENT";break;case"TK_TAG_END":if("TK_CONTENT"===r.last_token&&""===r.last_text){var k=r.token_text.match(/\w+/)[0],y=null;r.output.length&&(y=r.output[r.output.length-1].match(/(?:<|{{#)\s*(\w+)/)),null!==y&&y[1]===k||r.print_newline(!1,r.output)}r.print_token(r.token_text),r.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var v=r.token_text.match(/^\s*<([a-z-]+)/i);v&&r.Utils.in_array(v[1],l)||r.print_newline(!1,r.output),r.print_token(r.token_text),r.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_ELSE":r.print_token(r.token_text),r.indent_content&&(r.indent(),r.indent_content=!1),r.current_mode="CONTENT";break;case"TK_CONTENT":r.print_token(r.token_text),r.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(""!==r.token_text){r.print_newline(!1,r.output);var m,w=r.token_text,T=1;"TK_SCRIPT"===r.token_type?m="function"==typeof i&&i:"TK_STYLE"===r.token_type&&(m="function"==typeof s&&s),"keep"===e.indent_scripts?T=0:"separate"===e.indent_scripts&&(T=-r.indent_level);var x=r.get_full_indent(T);if(m)w=m(w.replace(/^\s*/,x),e);else{var b=w.match(/^\s*/)[0],E=b.match(/[^\n\r]*$/)[0].split(r.indent_string).length-1,A=r.get_full_indent(T-E);w=w.replace(/^\s*/,x).replace(/\r\n|\r|\n/g,"\n"+A).replace(/\s+$/,"")}w&&(r.print_token_raw(w),r.print_newline(!0,r.output))}r.current_mode="TAG";break;default:""!==r.token_text&&r.print_token(r.token_text)}r.last_token=r.token_type,r.last_text=r.token_text}var N=r.output.join("").replace(/[\r\n\t ]+$/,"");f&&(N+="\n");return N}(i,s,e,t)}}}),t("skylark-parsers-html/beautify",["./html","./primitives/beautify-html"],function(t,e){return t.beautify=e.html_beautify}),t("skylark-parsers-html/main",["./html","./beautify"],function(t){return t}),t("skylark-parsers-html",["skylark-parsers-html/main"],function(t){return t})}(n),!i){var h=require("skylark-langx/skylark");s?module.exports=h:e.skylarkjs=h}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-parsers-html.js.map
