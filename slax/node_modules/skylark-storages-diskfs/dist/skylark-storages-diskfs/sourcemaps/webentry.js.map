{"version":3,"sources":["webentry.js"],"names":["define","arrays","Deferred","diskfs","concat","Array","prototype","webentry","one","entry","path","d","onError","e","reject","isFile","file","relativePath","resolve","isDirectory","createReader","readEntries","entries","all","name","then","files","catch","promise","map","apply","arguments"],"mappings":";;;;;;;AAACA,QACG,uBACA,yBACA,YACF,SAASC,EAAOC,EAAUC,GACxB,IAAIC,EAASC,MAAMC,UAAUF,OACzBG,EAAW,WACX,SAASC,EAAIC,EAAOC,GAChB,IAAIC,EAAI,IAAIT,EACRU,EAAU,SAASC,GACfF,EAAEG,OAAOD,IAIjB,GADAH,EAAOA,GAAQ,GACXD,EAAMM,OACNN,EAAMO,KAAK,SAASA,GAChBA,EAAKC,aAAeP,EACpBC,EAAEO,QAAQF,IACXJ,QACA,GAAIH,EAAMU,YAAa,CACVV,EAAMW,eACZC,YAAY,SAASC,GAC3BC,EACID,EACAZ,EAAOD,EAAMe,KAAO,KACtBC,KAAK,SAASC,GACZf,EAAEO,QAAQQ,KACXC,MAAMf,IACVA,QAIHD,EAAEO,YAEN,OAAOP,EAAEiB,QAGb,SAASL,EAAID,EAASZ,GAClB,OAAOR,EAASqB,IACZtB,EAAO4B,IAAIP,EAAS,SAASb,GACzB,OAAOD,EAAIC,EAAOC,MAExBe,KAAK,WACH,OAAOrB,EAAO0B,SAAUC,aAIhC,OACIvB,IAAKA,EACLe,IAAKA,GA3CE,GA+Cf,OAAOpB,EAAOI,SAAWA","file":"../webentry.js","sourcesContent":[" define([\r\n    \"skylark-langx/arrays\",\r\n    \"skylark-langx/Deferred\",\r\n    \"./diskfs\"\r\n],function(arrays,Deferred, diskfs){\r\n    var concat = Array.prototype.concat;\r\n    var webentry = (function() {\r\n        function one(entry, path) {\r\n            var d = new Deferred(),\r\n                onError = function(e) {\r\n                    d.reject(e);\r\n                };\r\n\r\n            path = path || '';\r\n            if (entry.isFile) {\r\n                entry.file(function(file) {\r\n                    file.relativePath = path;\r\n                    d.resolve(file);\r\n                }, onError);\r\n            } else if (entry.isDirectory) {\r\n                var dirReader = entry.createReader();\r\n                dirReader.readEntries(function(entries) {\r\n                    all(\r\n                        entries,\r\n                        path + entry.name + '/'\r\n                    ).then(function(files) {\r\n                        d.resolve(files);\r\n                    }).catch(onError);\r\n                }, onError);\r\n            } else {\r\n                // Return an empy list for file system items\r\n                // other than files or directories:\r\n                d.resolve([]);\r\n            }\r\n            return d.promise;\r\n        }\r\n\r\n        function all(entries, path) {\r\n            return Deferred.all(\r\n                arrays.map(entries, function(entry) {\r\n                    return one(entry, path);\r\n                })\r\n            ).then(function() {\r\n                return concat.apply([], arguments);\r\n            });\r\n        }\r\n\r\n        return {\r\n            one: one,\r\n            all: all\r\n        };\r\n    })();\r\n\r\n    return diskfs.webentry = webentry;\r\n});"]}