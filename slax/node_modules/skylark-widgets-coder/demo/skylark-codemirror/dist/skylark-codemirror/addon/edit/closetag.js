/**
 * skylark-codemirror - A version of codemirror 5.45  that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-codemirror/
 * @license MIT
 */
define(["../../CodeMirror","../fold/xml-fold"],function(e){e.defineOption("autoCloseTags",!1,function(i,s,l){if(l!=e.Init&&l&&i.removeKeyMap("autoCloseTags"),s){var g={name:"autoCloseTags"};("object"!=typeof s||s.whenClosing)&&(g["'/'"]=function(t){return function(t){return t.getOption("disableInput")?e.Pass:a(t,!0)}(t)}),("object"!=typeof s||s.whenOpening)&&(g["'>'"]=function(a){return function(a){if(a.getOption("disableInput"))return e.Pass;for(var i=a.listSelections(),s=[],l=a.getOption("autoCloseTags"),g=0;g<i.length;g++){if(!i[g].empty())return e.Pass;var c=i[g].head,d=a.getTokenAt(c),f=e.innerMode(a.getMode(),d.state),u=f.state;if("xml"!=f.mode.name||!u.tagName)return e.Pass;var h="html"==f.mode.configuration,m="object"==typeof l&&l.dontCloseTags||h&&t,p="object"==typeof l&&l.indentTags||h&&n,v=u.tagName;d.end>c.ch&&(v=v.slice(0,v.length-d.end+c.ch));var y=v.toLowerCase();if(!v||"string"==d.type&&(d.end!=c.ch||!/[\"\']/.test(d.string.charAt(d.string.length-1))||1==d.string.length)||"tag"==d.type&&"closeTag"==u.type||d.string.indexOf("/")==d.string.length-1||m&&o(m,y)>-1||r(a,v,c,u,!0))return e.Pass;var b=p&&o(p,y)>-1;s[g]={indent:b,text:">"+(b?"\n\n":"")+"</"+v+">",newPos:b?e.Pos(c.line+1,0):e.Pos(c.line,c.ch+1)}}for(var P="object"==typeof l&&l.dontIndentOnAutoClose,g=i.length-1;g>=0;g--){var x=s[g];a.replaceRange(x.text,i[g].head,i[g].anchor,"+insert");var T=a.listSelections().slice(0);T[g]={head:x.newPos,anchor:x.newPos},a.setSelections(T),!P&&x.indent&&(a.indentLine(x.newPos.line,null,!0),a.indentLine(x.newPos.line+1,null,!0))}}(a)}),i.addKeyMap(g)}});var t=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],n=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];function a(t,n){for(var a=t.listSelections(),o=[],i=n?"/":"</",s=t.getOption("autoCloseTags"),l="object"==typeof s&&s.dontIndentOnSlash,g=0;g<a.length;g++){if(!a[g].empty())return e.Pass;var c,d=a[g].head,f=t.getTokenAt(d),u=e.innerMode(t.getMode(),f.state),h=u.state;if(n&&("string"==f.type||"<"!=f.string.charAt(0)||f.start!=d.ch-1))return e.Pass;if("xml"!=u.mode.name)if("htmlmixed"==t.getMode().name&&"javascript"==u.mode.name)c=i+"script";else{if("htmlmixed"!=t.getMode().name||"css"!=u.mode.name)return e.Pass;c=i+"style"}else{if(!h.context||!h.context.tagName||r(t,h.context.tagName,d,h))return e.Pass;c=i+h.context.tagName}">"!=t.getLine(d.line).charAt(f.end)&&(c+=">"),o[g]=c}if(t.replaceSelections(o),a=t.listSelections(),!l)for(g=0;g<a.length;g++)(g==a.length-1||a[g].head.line<a[g+1].head.line)&&t.indentLine(a[g].head.line)}function o(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,a=e.length;n<a;++n)if(e[n]==t)return n;return-1}function r(t,n,a,o,r){if(!e.scanForClosingTag)return!1;var i=Math.min(t.lastLine()+1,a.line+500),s=e.scanForClosingTag(t,a,null,i);if(!s||s.tag!=n)return!1;for(var l=o.context,g=r?1:0;l&&l.tagName==n;l=l.prev)++g;a=s.to;for(var c=1;c<g;c++){var d=e.scanForClosingTag(t,a,null,i);if(!d||d.tag!=n)return!1;a=d.to}return!0}e.commands.closeTag=function(e){return a(e)}});
//# sourceMappingURL=../../sourcemaps/addon/edit/closetag.js.map
