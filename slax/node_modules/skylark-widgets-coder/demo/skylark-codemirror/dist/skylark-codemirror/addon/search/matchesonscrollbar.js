/**
 * skylark-codemirror - A version of codemirror 5.45  that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-codemirror/
 * @license MIT
 */
define(["../../CodeMirror","./searchcursor","../scroll/annotatescrollbar"],function(t){"use strict";function i(t,i,a,e){this.cm=t,this.options=e;var o={listenForChanges:!1};for(var s in e)o[s]=e[s];o.className||(o.className="CodeMirror-search-match"),this.annotation=t.annotateScrollbar(o),this.query=i,this.caseFold=a,this.gap={from:t.firstLine(),to:t.lastLine()+1},this.matches=[],this.update=null,this.findMatches(),this.annotation.update(this.matches);var n=this;t.on("change",this.changeHandler=function(t,i){n.onChange(i)})}t.defineExtension("showMatchesOnScrollbar",function(t,a,e){return"string"==typeof e&&(e={className:e}),e||(e={}),new i(this,t,a,e)});function a(t,i,a){return t<=i?t:Math.max(i,t+a)}i.prototype.findMatches=function(){if(this.gap){for(var i=0;i<this.matches.length;i++){if((o=this.matches[i]).from.line>=this.gap.to)break;o.to.line>=this.gap.from&&this.matches.splice(i--,1)}for(var a=this.cm.getSearchCursor(this.query,t.Pos(this.gap.from,0),this.caseFold),e=this.options&&this.options.maxMatches||1e3;a.findNext();){var o;if((o={from:a.from(),to:a.to()}).from.line>=this.gap.to)break;if(this.matches.splice(i++,0,o),this.matches.length>e)break}this.gap=null}},i.prototype.onChange=function(i){var e=i.from.line,o=t.changeEnd(i).line,s=o-i.to.line;if(this.gap?(this.gap.from=Math.min(a(this.gap.from,e,s),i.from.line),this.gap.to=Math.max(a(this.gap.to,e,s),i.from.line)):this.gap={from:i.from.line,to:o+1},s)for(var n=0;n<this.matches.length;n++){var h=this.matches[n],r=a(h.from.line,e,s);r!=h.from.line&&(h.from=t.Pos(r,h.from.ch));var c=a(h.to.line,e,s);c!=h.to.line&&(h.to=t.Pos(c,h.to.ch))}clearTimeout(this.update);var f=this;this.update=setTimeout(function(){f.updateAfterChange()},250)},i.prototype.updateAfterChange=function(){this.findMatches(),this.annotation.update(this.matches)},i.prototype.clear=function(){this.cm.off("change",this.changeHandler),this.annotation.clear()}});
//# sourceMappingURL=../../sourcemaps/addon/search/matchesonscrollbar.js.map
