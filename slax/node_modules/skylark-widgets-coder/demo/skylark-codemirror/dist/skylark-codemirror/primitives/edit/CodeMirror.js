/**
 * skylark-codemirror - A version of codemirror 5.45  that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-codemirror/
 * @license MIT
 */
define(["../display/Display","../display/focus","../display/gutters","../display/line_numbers","../display/operations","../display/scrollbars","../display/scroll_events","../display/scrolling","../line/pos","../measurement/position_measurement","../measurement/widgets","../model/Doc","../model/document_data","../model/selection","../model/selection_updates","../util/browser","../util/event","../util/misc","./drop_events","./global_events","./key_events","./mouse_events","./utils","./options"],function(e,t,o,n,l,i,s,r,a,c,u,p,d,h,v,f,g,m,y,w,D,b,T,_){"use strict";function O(S,k){if(!(this instanceof O))return new O(S,k);this.options=k=k?m.copyObj(k):{},m.copyObj(_.defaults,k,!1),o.setGuttersForLineNumbers(k);let I=k.value;"string"==typeof I?I=new p(I,k.mode,null,k.lineSeparator,k.direction):k.mode&&(I.modeOption=k.mode),this.doc=I;let W=new O.inputStyles[k.inputStyle](this),C=this.display=new e.Display(S,I,W);C.wrapper.CodeMirror=this,o.updateGutters(this),T.themeChanged(this),k.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),i.initScrollbars(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new m.Delayed,keySeq:null,specialChars:null},k.autofocus&&!f.mobile&&C.input.focus(),f.ie&&f.ie_version<11&&setTimeout(()=>this.display.input.reset(!0),20),function(e){let o=e.display;g.on(o.scroller,"mousedown",l.operation(e,b.onMouseDown)),f.ie&&f.ie_version<11?g.on(o.scroller,"dblclick",l.operation(e,t=>{if(g.signalDOMEvent(e,t))return;let o=c.posFromMouse(e,t);if(!o||b.clickInGutter(e,t)||u.eventInWidget(e.display,t))return;g.e_preventDefault(t);let n=e.findWordAt(o);v.extendSelection(e.doc,n.anchor,n.head)})):g.on(o.scroller,"dblclick",t=>g.signalDOMEvent(e,t)||g.e_preventDefault(t));g.on(o.scroller,"contextmenu",t=>b.onContextMenu(e,t));let n,i={end:0};function p(){o.activeTouch&&(n=setTimeout(()=>o.activeTouch=null,1e3),(i=o.activeTouch).end=+new Date)}function d(e,t){if(null==t.left)return!0;let o=t.left-e.left,n=t.top-e.top;return o*o+n*n>400}g.on(o.scroller,"touchstart",t=>{if(!g.signalDOMEvent(e,t)&&!function(e){if(1!=e.touches.length)return!1;let t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}(t)&&!b.clickInGutter(e,t)){o.input.ensurePolled(),clearTimeout(n);let e=+new Date;o.activeTouch={start:e,moved:!1,prev:e-i.end<=300?i:null},1==t.touches.length&&(o.activeTouch.left=t.touches[0].pageX,o.activeTouch.top=t.touches[0].pageY)}}),g.on(o.scroller,"touchmove",()=>{o.activeTouch&&(o.activeTouch.moved=!0)}),g.on(o.scroller,"touchend",t=>{let n=o.activeTouch;if(n&&!u.eventInWidget(o,t)&&null!=n.left&&!n.moved&&new Date-n.start<300){let l,i=e.coordsChar(o.activeTouch,"page");l=!n.prev||d(n,n.prev)?new h.Range(i,i):!n.prev.prev||d(n,n.prev.prev)?e.findWordAt(i):new h.Range(a.Pos(i.line,0),a.clipPos(e.doc,a.Pos(i.line+1,0))),e.setSelection(l.anchor,l.head),e.focus(),g.e_preventDefault(t)}p()}),g.on(o.scroller,"touchcancel",p),g.on(o.scroller,"scroll",()=>{o.scroller.clientHeight&&(r.updateScrollTop(e,o.scroller.scrollTop),r.setScrollLeft(e,o.scroller.scrollLeft,!0),g.signal(e,"scroll",e))}),g.on(o.scroller,"mousewheel",t=>s.onScrollWheel(e,t)),g.on(o.scroller,"DOMMouseScroll",t=>s.onScrollWheel(e,t)),g.on(o.wrapper,"scroll",()=>o.wrapper.scrollTop=o.wrapper.scrollLeft=0),o.dragFunctions={enter:t=>{g.signalDOMEvent(e,t)||g.e_stop(t)},over:t=>{g.signalDOMEvent(e,t)||(y.onDragOver(e,t),g.e_stop(t))},start:t=>y.onDragStart(e,t),drop:l.operation(e,y.onDrop),leave:t=>{g.signalDOMEvent(e,t)||y.clearDragCursor(e)}};let m=o.input.getField();g.on(m,"keyup",t=>D.onKeyUp.call(e,t)),g.on(m,"keydown",l.operation(e,D.onKeyDown)),g.on(m,"keypress",l.operation(e,D.onKeyPress)),g.on(m,"focus",o=>t.onFocus(e,o)),g.on(m,"blur",o=>t.onBlur(e,o))}(this),w.ensureGlobalHandlers(),l.startOperation(this),this.curOp.forceUpdate=!0,d.attachDoc(this,I),k.autofocus&&!f.mobile||this.hasFocus()?setTimeout(m.bind(t.onFocus,this),20):t.onBlur(this);for(let e in _.optionHandlers)_.optionHandlers.hasOwnProperty(e)&&_.optionHandlers[e](this,k[e],_.Init);n.maybeUpdateLineNumberWidth(this),k.finishInit&&k.finishInit(this);for(let e=0;e<M.length;++e)M[e](this);l.endOperation(this),f.webkit&&k.lineWrapping&&"optimizelegibility"==getComputedStyle(C.lineDiv).textRendering&&(C.lineDiv.style.textRendering="auto")}O.defaults=_.defaults,O.optionHandlers=_.optionHandlers;let M=[];return O.defineInitHook=(e=>M.push(e)),O});
//# sourceMappingURL=../../sourcemaps/primitives/edit/CodeMirror.js.map
