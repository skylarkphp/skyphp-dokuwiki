/**
 * skylark-codemirror - A version of codemirror 5.45  that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-codemirror/
 * @license MIT
 */
define(["../line/line_data","../util/misc","../util/operation_group"],function(e,i,t){"use strict";function h(e){this.lines=e,this.parent=null;let i=0;for(let t=0;t<e.length;++t)e[t].parent=this,i+=e[t].height;this.height=i}function n(e){this.children=e;let i=0,t=0;for(let h=0;h<e.length;++h){let n=e[h];i+=n.chunkSize(),t+=n.height,n.parent=this}this.size=i,this.height=t,this.parent=null}return h.prototype={chunkSize(){return this.lines.length},removeInner(i,h){for(let n=i,l=i+h;n<l;++n){let i=this.lines[n];this.height-=i.height,e.cleanUpLine(i),t.signalLater(i,"delete")}this.lines.splice(i,h)},collapse(e){e.push.apply(e,this.lines)},insertInner(e,i,t){this.height+=t,this.lines=this.lines.slice(0,e).concat(i).concat(this.lines.slice(e));for(let e=0;e<i.length;++e)i[e].parent=this},iterN(e,i,t){for(let h=e+i;e<h;++e)if(t(this.lines[e]))return!0}},n.prototype={chunkSize(){return this.size},removeInner(e,i){this.size-=i;for(let t=0;t<this.children.length;++t){let h=this.children[t],n=h.chunkSize();if(e<n){let l=Math.min(i,n-e),s=h.height;if(h.removeInner(e,l),this.height-=s-h.height,n==l&&(this.children.splice(t--,1),h.parent=null),0==(i-=l))break;e=0}else e-=n}if(this.size-i<25&&(this.children.length>1||!(this.children[0]instanceof h))){let e=[];this.collapse(e),this.children=[new h(e)],this.children[0].parent=this}},collapse(e){for(let i=0;i<this.children.length;++i)this.children[i].collapse(e)},insertInner(e,i,t){this.size+=i.length,this.height+=t;for(let n=0;n<this.children.length;++n){let l=this.children[n],s=l.chunkSize();if(e<=s){if(l.insertInner(e,i,t),l.lines&&l.lines.length>50){let e=l.lines.length%25+25;for(let i=e;i<l.lines.length;){let e=new h(l.lines.slice(i,i+=25));l.height-=e.height,this.children.splice(++n,0,e),e.parent=this}l.lines=l.lines.slice(0,e),this.maybeSpill()}break}e-=s}},maybeSpill(){if(this.children.length<=10)return;let e=this;do{let t=new n(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;let h=i.indexOf(e.parent.children,e);e.parent.children.splice(h+1,0,t)}else{let i=new n(e.children);i.parent=e,e.children=[i,t],e=i}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()},iterN(e,i,t){for(let h=0;h<this.children.length;++h){let n=this.children[h],l=n.chunkSize();if(e<l){let h=Math.min(i,l-e);if(n.iterN(e,h,t))return!0;if(0==(i-=h))break;e=0}else e-=l}}},{LeafChunk:h,BranchChunk:n}});
//# sourceMappingURL=../../sourcemaps/primitives/model/chunk.js.map
