{"version":3,"sources":["addon/tern/tern.js"],"names":["define","CodeMirror","TernServer","options","self","this","plugins","doc_comment","docs","Object","create","useWorker","server","ts","worker","Worker","workerScript","postMessage","type","defs","scripts","workerDeps","msgId","pending","send","data","c","id","onmessage","e","getFile","name","err","text","String","window","console","log","message","body","onerror","addFile","delFile","request","tern","Server","async","trackChange","doc","change","findDoc","argHints","cachedArgHints","cmpPos","start","to","changed","from","line","end","length","lineCount","bigDoc","setTimeout","sendDoc","activeArgHints","jumpStack","getHint","cm","types","urls","error","showError","completions","after","getRange","Pos","ch","i","completion","className","typeToIcon","guess","cls","push","displayText","displayName","obj","list","tooltip","on","remove","cur","node","content","completionTip","makeTooltip","parentNode","getBoundingClientRect","right","pageXOffset","top","pageYOffset","hint","prototype","addDoc","docValue","delDoc","found","resolveDoc","off","hideDoc","closeArgHints","complete","showHint","showType","pos","showContextInfo","showDocs","updateArgHints","somethingSelected","state","getTokenAt","getCursor","inner","innerMode","getMode","mode","lex","lexical","info","argPos","tabSize","getOption","Math","max","str","getLine","extra","tab","indexOf","column","charAt","cache","getDoc","showArgHints","preferFunction","test","args","skipMatching","upto","depth","next","slice","match","rettype","parseFnType","exprName","jumpToDef","varName","req","variable","buildRequest","file","url","localDoc","before","context","contextOffset","split","startLine","nearest","cursor","getSearchCursor","nearestDist","Infinity","findNext","dist","abs","findContext","moveTo","open","tok","atInterestingExpression","dialog","jumpBack","pop","rename","token","string","newName","fullDocs","changes","perFile","known","chs","sort","a","b","origin","nextChangeOrig","replaceRange","applyChanges","selectName","ranges","curPos","refs","ref","anchor","head","setSelections","query","extraOptions","queryOptions","prop","responseFilter","destroy","terminate","buf","n","Doc","files","suffix","queryName","typeTip","tip","elt","appendChild","document","createTextNode","child","href","target","tempTooltip","tp","arg","place","cursorCoords","bottom","clear","onEditorActivity","curDoc","setSelection","switchToDoc","offsetLines","allowFragments","lineCharPositions","startPos","endLine","minIndent","minLine","p","min","fn","search","indent","countColumn","lastLine","getFragmentAround","tagname","createElement","arguments","f","openDialog","prompt","ternTooltip","where","style","opacity","clearActivity","mouseOnTip","old","related","relatedTarget","toElement","contains","hintDelay","x","y","left","removeChild","msg","val","getValue","fileFilter"],"mappings":"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","file":"../../../addon/tern/tern.js","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/LICENSE\n\n// Glue code between CodeMirror and Tern.\n//\n// Create a CodeMirror.TernServer to wrap an actual Tern server,\n// register open documents (CodeMirror.Doc instances) with it, and\n// call its methods to activate the assisting functions that Tern\n// provides.\n//\n// Options supported (all optional):\n// * defs: An array of JSON definition data structures.\n// * plugins: An object mapping plugin names to configuration\n//   options.\n// * getFile: A function(name, c) that can be used to access files in\n//   the project that haven't been loaded yet. Simply do c(null) to\n//   indicate that a file is not available.\n// * fileFilter: A function(value, docName, doc) that will be applied\n//   to documents before passing them on to Tern.\n// * switchToDoc: A function(name, doc) that should, when providing a\n//   multi-file view, switch the view or focus to the named file.\n// * showError: A function(editor, message) that can be used to\n//   override the way errors are displayed.\n// * completionTip: Customize the content in tooltips for completions.\n//   Is passed a single argument—the completion's data as returned by\n//   Tern—and may return a string, DOM node, or null to indicate that\n//   no tip should be shown. By default the docstring is shown.\n// * typeTip: Like completionTip, but for the tooltips shown for type\n//   queries.\n// * responseFilter: A function(doc, query, request, error, data) that\n//   will be applied to the Tern responses before treating them\n//\n//\n// It is possible to run the Tern server in a web worker by specifying\n// these additional options:\n// * useWorker: Set to true to enable web worker mode. You'll probably\n//   want to feature detect the actual value you use here, for example\n//   !!window.Worker.\n// * workerScript: The main script of the worker. Point this to\n//   wherever you are hosting worker.js from this directory.\n// * workerDeps: An array of paths pointing (relative to workerScript)\n//   to the Acorn and Tern libraries and any Tern plugins you want to\n//   load. Or, if you minified those into a single script and included\n//   them in the workerScript, simply leave this undefined.\n\ndefine([\"../../CodeMirror\"], function(CodeMirror) {\n  \"use strict\";\n  // declare global: tern\n\n  CodeMirror.TernServer = function(options) {\n    var self = this;\n    this.options = options || {};\n    var plugins = this.options.plugins || (this.options.plugins = {});\n    if (!plugins.doc_comment) plugins.doc_comment = true;\n    this.docs = Object.create(null);\n    if (this.options.useWorker) {\n      this.server = new WorkerServer(this);\n    } else {\n      this.server = new tern.Server({\n        getFile: function(name, c) { return getFile(self, name, c); },\n        async: true,\n        defs: this.options.defs || [],\n        plugins: plugins\n      });\n    }\n    this.trackChange = function(doc, change) { trackChange(self, doc, change); };\n\n    this.cachedArgHints = null;\n    this.activeArgHints = null;\n    this.jumpStack = [];\n\n    this.getHint = function(cm, c) { return hint(self, cm, c); };\n    this.getHint.async = true;\n  };\n\n  CodeMirror.TernServer.prototype = {\n    addDoc: function(name, doc) {\n      var data = {doc: doc, name: name, changed: null};\n      this.server.addFile(name, docValue(this, data));\n      CodeMirror.on(doc, \"change\", this.trackChange);\n      return this.docs[name] = data;\n    },\n\n    delDoc: function(id) {\n      var found = resolveDoc(this, id);\n      if (!found) return;\n      CodeMirror.off(found.doc, \"change\", this.trackChange);\n      delete this.docs[found.name];\n      this.server.delFile(found.name);\n    },\n\n    hideDoc: function(id) {\n      closeArgHints(this);\n      var found = resolveDoc(this, id);\n      if (found && found.changed) sendDoc(this, found);\n    },\n\n    complete: function(cm) {\n      cm.showHint({hint: this.getHint});\n    },\n\n    showType: function(cm, pos, c) { showContextInfo(this, cm, pos, \"type\", c); },\n\n    showDocs: function(cm, pos, c) { showContextInfo(this, cm, pos, \"documentation\", c); },\n\n    updateArgHints: function(cm) { updateArgHints(this, cm); },\n\n    jumpToDef: function(cm) { jumpToDef(this, cm); },\n\n    jumpBack: function(cm) { jumpBack(this, cm); },\n\n    rename: function(cm) { rename(this, cm); },\n\n    selectName: function(cm) { selectName(this, cm); },\n\n    request: function (cm, query, c, pos) {\n      var self = this;\n      var doc = findDoc(this, cm.getDoc());\n      var request = buildRequest(this, doc, query, pos);\n      var extraOptions = request.query && this.options.queryOptions && this.options.queryOptions[request.query.type]\n      if (extraOptions) for (var prop in extraOptions) request.query[prop] = extraOptions[prop];\n\n      this.server.request(request, function (error, data) {\n        if (!error && self.options.responseFilter)\n          data = self.options.responseFilter(doc, query, request, error, data);\n        c(error, data);\n      });\n    },\n\n    destroy: function () {\n      closeArgHints(this)\n      if (this.worker) {\n        this.worker.terminate();\n        this.worker = null;\n      }\n    }\n  };\n\n  var Pos = CodeMirror.Pos;\n  var cls = \"CodeMirror-Tern-\";\n  var bigDoc = 250;\n\n  function getFile(ts, name, c) {\n    var buf = ts.docs[name];\n    if (buf)\n      c(docValue(ts, buf));\n    else if (ts.options.getFile)\n      ts.options.getFile(name, c);\n    else\n      c(null);\n  }\n\n  function findDoc(ts, doc, name) {\n    for (var n in ts.docs) {\n      var cur = ts.docs[n];\n      if (cur.doc == doc) return cur;\n    }\n    if (!name) for (var i = 0;; ++i) {\n      n = \"[doc\" + (i || \"\") + \"]\";\n      if (!ts.docs[n]) { name = n; break; }\n    }\n    return ts.addDoc(name, doc);\n  }\n\n  function resolveDoc(ts, id) {\n    if (typeof id == \"string\") return ts.docs[id];\n    if (id instanceof CodeMirror) id = id.getDoc();\n    if (id instanceof CodeMirror.Doc) return findDoc(ts, id);\n  }\n\n  function trackChange(ts, doc, change) {\n    var data = findDoc(ts, doc);\n\n    var argHints = ts.cachedArgHints;\n    if (argHints && argHints.doc == doc && cmpPos(argHints.start, change.to) >= 0)\n      ts.cachedArgHints = null;\n\n    var changed = data.changed;\n    if (changed == null)\n      data.changed = changed = {from: change.from.line, to: change.from.line};\n    var end = change.from.line + (change.text.length - 1);\n    if (change.from.line < changed.to) changed.to = changed.to - (change.to.line - end);\n    if (end >= changed.to) changed.to = end + 1;\n    if (changed.from > change.from.line) changed.from = change.from.line;\n\n    if (doc.lineCount() > bigDoc && change.to - changed.from > 100) setTimeout(function() {\n      if (data.changed && data.changed.to - data.changed.from > 100) sendDoc(ts, data);\n    }, 200);\n  }\n\n  function sendDoc(ts, doc) {\n    ts.server.request({files: [{type: \"full\", name: doc.name, text: docValue(ts, doc)}]}, function(error) {\n      if (error) window.console.error(error);\n      else doc.changed = null;\n    });\n  }\n\n  // Completion\n\n  function hint(ts, cm, c) {\n    ts.request(cm, {type: \"completions\", types: true, docs: true, urls: true}, function(error, data) {\n      if (error) return showError(ts, cm, error);\n      var completions = [], after = \"\";\n      var from = data.start, to = data.end;\n      if (cm.getRange(Pos(from.line, from.ch - 2), from) == \"[\\\"\" &&\n          cm.getRange(to, Pos(to.line, to.ch + 2)) != \"\\\"]\")\n        after = \"\\\"]\";\n\n      for (var i = 0; i < data.completions.length; ++i) {\n        var completion = data.completions[i], className = typeToIcon(completion.type);\n        if (data.guess) className += \" \" + cls + \"guess\";\n        completions.push({text: completion.name + after,\n                          displayText: completion.displayName || completion.name,\n                          className: className,\n                          data: completion});\n      }\n\n      var obj = {from: from, to: to, list: completions};\n      var tooltip = null;\n      CodeMirror.on(obj, \"close\", function() { remove(tooltip); });\n      CodeMirror.on(obj, \"update\", function() { remove(tooltip); });\n      CodeMirror.on(obj, \"select\", function(cur, node) {\n        remove(tooltip);\n        var content = ts.options.completionTip ? ts.options.completionTip(cur.data) : cur.data.doc;\n        if (content) {\n          tooltip = makeTooltip(node.parentNode.getBoundingClientRect().right + window.pageXOffset,\n                                node.getBoundingClientRect().top + window.pageYOffset, content);\n          tooltip.className += \" \" + cls + \"hint-doc\";\n        }\n      });\n      c(obj);\n    });\n  }\n\n  function typeToIcon(type) {\n    var suffix;\n    if (type == \"?\") suffix = \"unknown\";\n    else if (type == \"number\" || type == \"string\" || type == \"bool\") suffix = type;\n    else if (/^fn\\(/.test(type)) suffix = \"fn\";\n    else if (/^\\[/.test(type)) suffix = \"array\";\n    else suffix = \"object\";\n    return cls + \"completion \" + cls + \"completion-\" + suffix;\n  }\n\n  // Type queries\n\n  function showContextInfo(ts, cm, pos, queryName, c) {\n    ts.request(cm, queryName, function(error, data) {\n      if (error) return showError(ts, cm, error);\n      if (ts.options.typeTip) {\n        var tip = ts.options.typeTip(data);\n      } else {\n        var tip = elt(\"span\", null, elt(\"strong\", null, data.type || \"not found\"));\n        if (data.doc)\n          tip.appendChild(document.createTextNode(\" — \" + data.doc));\n        if (data.url) {\n          tip.appendChild(document.createTextNode(\" \"));\n          var child = tip.appendChild(elt(\"a\", null, \"[docs]\"));\n          child.href = data.url;\n          child.target = \"_blank\";\n        }\n      }\n      tempTooltip(cm, tip, ts);\n      if (c) c();\n    }, pos);\n  }\n\n  // Maintaining argument hints\n\n  function updateArgHints(ts, cm) {\n    closeArgHints(ts);\n\n    if (cm.somethingSelected()) return;\n    var state = cm.getTokenAt(cm.getCursor()).state;\n    var inner = CodeMirror.innerMode(cm.getMode(), state);\n    if (inner.mode.name != \"javascript\") return;\n    var lex = inner.state.lexical;\n    if (lex.info != \"call\") return;\n\n    var ch, argPos = lex.pos || 0, tabSize = cm.getOption(\"tabSize\");\n    for (var line = cm.getCursor().line, e = Math.max(0, line - 9), found = false; line >= e; --line) {\n      var str = cm.getLine(line), extra = 0;\n      for (var pos = 0;;) {\n        var tab = str.indexOf(\"\\t\", pos);\n        if (tab == -1) break;\n        extra += tabSize - (tab + extra) % tabSize - 1;\n        pos = tab + 1;\n      }\n      ch = lex.column - extra;\n      if (str.charAt(ch) == \"(\") {found = true; break;}\n    }\n    if (!found) return;\n\n    var start = Pos(line, ch);\n    var cache = ts.cachedArgHints;\n    if (cache && cache.doc == cm.getDoc() && cmpPos(start, cache.start) == 0)\n      return showArgHints(ts, cm, argPos);\n\n    ts.request(cm, {type: \"type\", preferFunction: true, end: start}, function(error, data) {\n      if (error || !data.type || !(/^fn\\(/).test(data.type)) return;\n      ts.cachedArgHints = {\n        start: start,\n        type: parseFnType(data.type),\n        name: data.exprName || data.name || \"fn\",\n        guess: data.guess,\n        doc: cm.getDoc()\n      };\n      showArgHints(ts, cm, argPos);\n    });\n  }\n\n  function showArgHints(ts, cm, pos) {\n    closeArgHints(ts);\n\n    var cache = ts.cachedArgHints, tp = cache.type;\n    var tip = elt(\"span\", cache.guess ? cls + \"fhint-guess\" : null,\n                  elt(\"span\", cls + \"fname\", cache.name), \"(\");\n    for (var i = 0; i < tp.args.length; ++i) {\n      if (i) tip.appendChild(document.createTextNode(\", \"));\n      var arg = tp.args[i];\n      tip.appendChild(elt(\"span\", cls + \"farg\" + (i == pos ? \" \" + cls + \"farg-current\" : \"\"), arg.name || \"?\"));\n      if (arg.type != \"?\") {\n        tip.appendChild(document.createTextNode(\":\\u00a0\"));\n        tip.appendChild(elt(\"span\", cls + \"type\", arg.type));\n      }\n    }\n    tip.appendChild(document.createTextNode(tp.rettype ? \") ->\\u00a0\" : \")\"));\n    if (tp.rettype) tip.appendChild(elt(\"span\", cls + \"type\", tp.rettype));\n    var place = cm.cursorCoords(null, \"page\");\n    var tooltip = ts.activeArgHints = makeTooltip(place.right + 1, place.bottom, tip)\n    setTimeout(function() {\n      tooltip.clear = onEditorActivity(cm, function() {\n        if (ts.activeArgHints == tooltip) closeArgHints(ts) })\n    }, 20)\n  }\n\n  function parseFnType(text) {\n    var args = [], pos = 3;\n\n    function skipMatching(upto) {\n      var depth = 0, start = pos;\n      for (;;) {\n        var next = text.charAt(pos);\n        if (upto.test(next) && !depth) return text.slice(start, pos);\n        if (/[{\\[\\(]/.test(next)) ++depth;\n        else if (/[}\\]\\)]/.test(next)) --depth;\n        ++pos;\n      }\n    }\n\n    // Parse arguments\n    if (text.charAt(pos) != \")\") for (;;) {\n      var name = text.slice(pos).match(/^([^, \\(\\[\\{]+): /);\n      if (name) {\n        pos += name[0].length;\n        name = name[1];\n      }\n      args.push({name: name, type: skipMatching(/[\\),]/)});\n      if (text.charAt(pos) == \")\") break;\n      pos += 2;\n    }\n\n    var rettype = text.slice(pos).match(/^\\) -> (.*)$/);\n\n    return {args: args, rettype: rettype && rettype[1]};\n  }\n\n  // Moving to the definition of something\n\n  function jumpToDef(ts, cm) {\n    function inner(varName) {\n      var req = {type: \"definition\", variable: varName || null};\n      var doc = findDoc(ts, cm.getDoc());\n      ts.server.request(buildRequest(ts, doc, req), function(error, data) {\n        if (error) return showError(ts, cm, error);\n        if (!data.file && data.url) { window.open(data.url); return; }\n\n        if (data.file) {\n          var localDoc = ts.docs[data.file], found;\n          if (localDoc && (found = findContext(localDoc.doc, data))) {\n            ts.jumpStack.push({file: doc.name,\n                               start: cm.getCursor(\"from\"),\n                               end: cm.getCursor(\"to\")});\n            moveTo(ts, doc, localDoc, found.start, found.end);\n            return;\n          }\n        }\n        showError(ts, cm, \"Could not find a definition.\");\n      });\n    }\n\n    if (!atInterestingExpression(cm))\n      dialog(cm, \"Jump to variable\", function(name) { if (name) inner(name); });\n    else\n      inner();\n  }\n\n  function jumpBack(ts, cm) {\n    var pos = ts.jumpStack.pop(), doc = pos && ts.docs[pos.file];\n    if (!doc) return;\n    moveTo(ts, findDoc(ts, cm.getDoc()), doc, pos.start, pos.end);\n  }\n\n  function moveTo(ts, curDoc, doc, start, end) {\n    doc.doc.setSelection(start, end);\n    if (curDoc != doc && ts.options.switchToDoc) {\n      closeArgHints(ts);\n      ts.options.switchToDoc(doc.name, doc.doc);\n    }\n  }\n\n  // The {line,ch} representation of positions makes this rather awkward.\n  function findContext(doc, data) {\n    var before = data.context.slice(0, data.contextOffset).split(\"\\n\");\n    var startLine = data.start.line - (before.length - 1);\n    var start = Pos(startLine, (before.length == 1 ? data.start.ch : doc.getLine(startLine).length) - before[0].length);\n\n    var text = doc.getLine(startLine).slice(start.ch);\n    for (var cur = startLine + 1; cur < doc.lineCount() && text.length < data.context.length; ++cur)\n      text += \"\\n\" + doc.getLine(cur);\n    if (text.slice(0, data.context.length) == data.context) return data;\n\n    var cursor = doc.getSearchCursor(data.context, 0, false);\n    var nearest, nearestDist = Infinity;\n    while (cursor.findNext()) {\n      var from = cursor.from(), dist = Math.abs(from.line - start.line) * 10000;\n      if (!dist) dist = Math.abs(from.ch - start.ch);\n      if (dist < nearestDist) { nearest = from; nearestDist = dist; }\n    }\n    if (!nearest) return null;\n\n    if (before.length == 1)\n      nearest.ch += before[0].length;\n    else\n      nearest = Pos(nearest.line + (before.length - 1), before[before.length - 1].length);\n    if (data.start.line == data.end.line)\n      var end = Pos(nearest.line, nearest.ch + (data.end.ch - data.start.ch));\n    else\n      var end = Pos(nearest.line + (data.end.line - data.start.line), data.end.ch);\n    return {start: nearest, end: end};\n  }\n\n  function atInterestingExpression(cm) {\n    var pos = cm.getCursor(\"end\"), tok = cm.getTokenAt(pos);\n    if (tok.start < pos.ch && tok.type == \"comment\") return false;\n    return /[\\w)\\]]/.test(cm.getLine(pos.line).slice(Math.max(pos.ch - 1, 0), pos.ch + 1));\n  }\n\n  // Variable renaming\n\n  function rename(ts, cm) {\n    var token = cm.getTokenAt(cm.getCursor());\n    if (!/\\w/.test(token.string)) return showError(ts, cm, \"Not at a variable\");\n    dialog(cm, \"New name for \" + token.string, function(newName) {\n      ts.request(cm, {type: \"rename\", newName: newName, fullDocs: true}, function(error, data) {\n        if (error) return showError(ts, cm, error);\n        applyChanges(ts, data.changes);\n      });\n    });\n  }\n\n  function selectName(ts, cm) {\n    var name = findDoc(ts, cm.doc).name;\n    ts.request(cm, {type: \"refs\"}, function(error, data) {\n      if (error) return showError(ts, cm, error);\n      var ranges = [], cur = 0;\n      var curPos = cm.getCursor();\n      for (var i = 0; i < data.refs.length; i++) {\n        var ref = data.refs[i];\n        if (ref.file == name) {\n          ranges.push({anchor: ref.start, head: ref.end});\n          if (cmpPos(curPos, ref.start) >= 0 && cmpPos(curPos, ref.end) <= 0)\n            cur = ranges.length - 1;\n        }\n      }\n      cm.setSelections(ranges, cur);\n    });\n  }\n\n  var nextChangeOrig = 0;\n  function applyChanges(ts, changes) {\n    var perFile = Object.create(null);\n    for (var i = 0; i < changes.length; ++i) {\n      var ch = changes[i];\n      (perFile[ch.file] || (perFile[ch.file] = [])).push(ch);\n    }\n    for (var file in perFile) {\n      var known = ts.docs[file], chs = perFile[file];;\n      if (!known) continue;\n      chs.sort(function(a, b) { return cmpPos(b.start, a.start); });\n      var origin = \"*rename\" + (++nextChangeOrig);\n      for (var i = 0; i < chs.length; ++i) {\n        var ch = chs[i];\n        known.doc.replaceRange(ch.text, ch.start, ch.end, origin);\n      }\n    }\n  }\n\n  // Generic request-building helper\n\n  function buildRequest(ts, doc, query, pos) {\n    var files = [], offsetLines = 0, allowFragments = !query.fullDocs;\n    if (!allowFragments) delete query.fullDocs;\n    if (typeof query == \"string\") query = {type: query};\n    query.lineCharPositions = true;\n    if (query.end == null) {\n      query.end = pos || doc.doc.getCursor(\"end\");\n      if (doc.doc.somethingSelected())\n        query.start = doc.doc.getCursor(\"start\");\n    }\n    var startPos = query.start || query.end;\n\n    if (doc.changed) {\n      if (doc.doc.lineCount() > bigDoc && allowFragments !== false &&\n          doc.changed.to - doc.changed.from < 100 &&\n          doc.changed.from <= startPos.line && doc.changed.to > query.end.line) {\n        files.push(getFragmentAround(doc, startPos, query.end));\n        query.file = \"#0\";\n        var offsetLines = files[0].offsetLines;\n        if (query.start != null) query.start = Pos(query.start.line - -offsetLines, query.start.ch);\n        query.end = Pos(query.end.line - offsetLines, query.end.ch);\n      } else {\n        files.push({type: \"full\",\n                    name: doc.name,\n                    text: docValue(ts, doc)});\n        query.file = doc.name;\n        doc.changed = null;\n      }\n    } else {\n      query.file = doc.name;\n    }\n    for (var name in ts.docs) {\n      var cur = ts.docs[name];\n      if (cur.changed && cur != doc) {\n        files.push({type: \"full\", name: cur.name, text: docValue(ts, cur)});\n        cur.changed = null;\n      }\n    }\n\n    return {query: query, files: files};\n  }\n\n  function getFragmentAround(data, start, end) {\n    var doc = data.doc;\n    var minIndent = null, minLine = null, endLine, tabSize = 4;\n    for (var p = start.line - 1, min = Math.max(0, p - 50); p >= min; --p) {\n      var line = doc.getLine(p), fn = line.search(/\\bfunction\\b/);\n      if (fn < 0) continue;\n      var indent = CodeMirror.countColumn(line, null, tabSize);\n      if (minIndent != null && minIndent <= indent) continue;\n      minIndent = indent;\n      minLine = p;\n    }\n    if (minLine == null) minLine = min;\n    var max = Math.min(doc.lastLine(), end.line + 20);\n    if (minIndent == null || minIndent == CodeMirror.countColumn(doc.getLine(start.line), null, tabSize))\n      endLine = max;\n    else for (endLine = end.line + 1; endLine < max; ++endLine) {\n      var indent = CodeMirror.countColumn(doc.getLine(endLine), null, tabSize);\n      if (indent <= minIndent) break;\n    }\n    var from = Pos(minLine, 0);\n\n    return {type: \"part\",\n            name: data.name,\n            offsetLines: from.line,\n            text: doc.getRange(from, Pos(endLine, end.line == endLine ? null : 0))};\n  }\n\n  // Generic utilities\n\n  var cmpPos = CodeMirror.cmpPos;\n\n  function elt(tagname, cls /*, ... elts*/) {\n    var e = document.createElement(tagname);\n    if (cls) e.className = cls;\n    for (var i = 2; i < arguments.length; ++i) {\n      var elt = arguments[i];\n      if (typeof elt == \"string\") elt = document.createTextNode(elt);\n      e.appendChild(elt);\n    }\n    return e;\n  }\n\n  function dialog(cm, text, f) {\n    if (cm.openDialog)\n      cm.openDialog(text + \": <input type=text>\", f);\n    else\n      f(prompt(text, \"\"));\n  }\n\n  // Tooltips\n\n  function tempTooltip(cm, content, ts) {\n    if (cm.state.ternTooltip) remove(cm.state.ternTooltip);\n    var where = cm.cursorCoords();\n    var tip = cm.state.ternTooltip = makeTooltip(where.right + 1, where.bottom, content);\n    function maybeClear() {\n      old = true;\n      if (!mouseOnTip) clear();\n    }\n    function clear() {\n      cm.state.ternTooltip = null;\n      if (tip.parentNode) fadeOut(tip)\n      clearActivity()\n    }\n    var mouseOnTip = false, old = false;\n    CodeMirror.on(tip, \"mousemove\", function() { mouseOnTip = true; });\n    CodeMirror.on(tip, \"mouseout\", function(e) {\n      var related = e.relatedTarget || e.toElement\n      if (!related || !CodeMirror.contains(tip, related)) {\n        if (old) clear();\n        else mouseOnTip = false;\n      }\n    });\n    setTimeout(maybeClear, ts.options.hintDelay ? ts.options.hintDelay : 1700);\n    var clearActivity = onEditorActivity(cm, clear)\n  }\n\n  function onEditorActivity(cm, f) {\n    cm.on(\"cursorActivity\", f)\n    cm.on(\"blur\", f)\n    cm.on(\"scroll\", f)\n    cm.on(\"setDoc\", f)\n    return function() {\n      cm.off(\"cursorActivity\", f)\n      cm.off(\"blur\", f)\n      cm.off(\"scroll\", f)\n      cm.off(\"setDoc\", f)\n    }\n  }\n\n  function makeTooltip(x, y, content) {\n    var node = elt(\"div\", cls + \"tooltip\", content);\n    node.style.left = x + \"px\";\n    node.style.top = y + \"px\";\n    document.body.appendChild(node);\n    return node;\n  }\n\n  function remove(node) {\n    var p = node && node.parentNode;\n    if (p) p.removeChild(node);\n  }\n\n  function fadeOut(tooltip) {\n    tooltip.style.opacity = \"0\";\n    setTimeout(function() { remove(tooltip); }, 1100);\n  }\n\n  function showError(ts, cm, msg) {\n    if (ts.options.showError)\n      ts.options.showError(cm, msg);\n    else\n      tempTooltip(cm, String(msg), ts);\n  }\n\n  function closeArgHints(ts) {\n    if (ts.activeArgHints) {\n      if (ts.activeArgHints.clear) ts.activeArgHints.clear()\n      remove(ts.activeArgHints)\n      ts.activeArgHints = null\n    }\n  }\n\n  function docValue(ts, doc) {\n    var val = doc.doc.getValue();\n    if (ts.options.fileFilter) val = ts.options.fileFilter(val, doc.name, doc.doc);\n    return val;\n  }\n\n  // Worker wrapper\n\n  function WorkerServer(ts) {\n    var worker = ts.worker = new Worker(ts.options.workerScript);\n    worker.postMessage({type: \"init\",\n                        defs: ts.options.defs,\n                        plugins: ts.options.plugins,\n                        scripts: ts.options.workerDeps});\n    var msgId = 0, pending = {};\n\n    function send(data, c) {\n      if (c) {\n        data.id = ++msgId;\n        pending[msgId] = c;\n      }\n      worker.postMessage(data);\n    }\n    worker.onmessage = function(e) {\n      var data = e.data;\n      if (data.type == \"getFile\") {\n        getFile(ts, data.name, function(err, text) {\n          send({type: \"getFile\", err: String(err), text: text, id: data.id});\n        });\n      } else if (data.type == \"debug\") {\n        window.console.log(data.message);\n      } else if (data.id && pending[data.id]) {\n        pending[data.id](data.err, data.body);\n        delete pending[data.id];\n      }\n    };\n    worker.onerror = function(e) {\n      for (var id in pending) pending[id](e);\n      pending = {};\n    };\n\n    this.addFile = function(name, text) { send({type: \"add\", name: name, text: text}); };\n    this.delFile = function(name) { send({type: \"del\", name: name}); };\n    this.request = function(body, c) { send({type: \"req\", body: body}, c); };\n  }\n});\n"]}