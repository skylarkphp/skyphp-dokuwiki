{"version":3,"sources":["primitives/display/focus.js"],"names":["define","selection","browser","dom","event","onFocus","cm","e","state","delayingBlurEvent","options","readOnly","focused","signal","addClass","display","wrapper","curOp","selForContextMenu","doc","sel","input","reset","webkit","setTimeout","receivedFocus","restartBlink","onBlur","rmClass","clearInterval","blinker","shift","ensureFocus","focus","delayBlurEvent"],"mappings":";;;;;;;AAAAA,QACI,cACA,kBACA,cACA,iBACD,SAAUC,EAAWC,EAASC,EAAKC,GAClC,aAgBA,SAASC,EAAQC,EAAIC,GACbD,EAAGE,MAAMC,oBACTH,EAAGE,MAAMC,mBAAoB,GACN,YAAvBH,EAAGI,QAAQC,WAEVL,EAAGE,MAAMI,UACVR,EAAMS,OAAOP,EAAI,QAASA,EAAIC,GAC9BD,EAAGE,MAAMI,SAAU,EACnBT,EAAIW,SAASR,EAAGS,QAAQC,QAAS,sBAC5BV,EAAGW,OAASX,EAAGS,QAAQG,mBAAqBZ,EAAGa,IAAIC,MACpDd,EAAGS,QAAQM,MAAMC,QACbpB,EAAQqB,QACRC,WAAW,IAAMlB,EAAGS,QAAQM,MAAMC,OAAM,GAAO,KAEvDhB,EAAGS,QAAQM,MAAMI,iBAErBxB,EAAUyB,aAAapB,IAE3B,SAASqB,EAAOrB,EAAIC,GACZD,EAAGE,MAAMC,oBAETH,EAAGE,MAAMI,UACTR,EAAMS,OAAOP,EAAI,OAAQA,EAAIC,GAC7BD,EAAGE,MAAMI,SAAU,EACnBT,EAAIyB,QAAQtB,EAAGS,QAAQC,QAAS,uBAEpCa,cAAcvB,EAAGS,QAAQe,SACzBN,WAAW,KACFlB,EAAGE,MAAMI,UACVN,EAAGS,QAAQgB,OAAQ,IACxB,MAEP,OACIC,YAhDJ,SAAqB1B,GACZA,EAAGE,MAAMI,UACVN,EAAGS,QAAQM,MAAMY,QACjB5B,EAAQC,KA8CZ4B,eA3CJ,SAAwB5B,GACpBA,EAAGE,MAAMC,mBAAoB,EAC7Be,WAAW,KACHlB,EAAGE,MAAMC,oBACTH,EAAGE,MAAMC,mBAAoB,EAC7BkB,EAAOrB,KAEZ,MAqCHD,QAASA,EACTsB,OAAQA","file":"../../../primitives/display/focus.js","sourcesContent":["define([\n    './selection',\n    '../util/browser',\n    '../util/dom',\n    '../util/event'\n], function (selection, browser, dom, event) {\n    'use strict';\n    function ensureFocus(cm) {\n        if (!cm.state.focused) {\n            cm.display.input.focus();\n            onFocus(cm);\n        }\n    }\n    function delayBlurEvent(cm) {\n        cm.state.delayingBlurEvent = true;\n        setTimeout(() => {\n            if (cm.state.delayingBlurEvent) {\n                cm.state.delayingBlurEvent = false;\n                onBlur(cm);\n            }\n        }, 100);\n    }\n    function onFocus(cm, e) {\n        if (cm.state.delayingBlurEvent)\n            cm.state.delayingBlurEvent = false;\n        if (cm.options.readOnly == 'nocursor')\n            return;\n        if (!cm.state.focused) {\n            event.signal(cm, 'focus', cm, e);\n            cm.state.focused = true;\n            dom.addClass(cm.display.wrapper, 'CodeMirror-focused');\n            if (!cm.curOp && cm.display.selForContextMenu != cm.doc.sel) {\n                cm.display.input.reset();\n                if (browser.webkit)\n                    setTimeout(() => cm.display.input.reset(true), 20);\n            }\n            cm.display.input.receivedFocus();\n        }\n        selection.restartBlink(cm);\n    }\n    function onBlur(cm, e) {\n        if (cm.state.delayingBlurEvent)\n            return;\n        if (cm.state.focused) {\n            event.signal(cm, 'blur', cm, e);\n            cm.state.focused = false;\n            dom.rmClass(cm.display.wrapper, 'CodeMirror-focused');\n        }\n        clearInterval(cm.display.blinker);\n        setTimeout(() => {\n            if (!cm.state.focused)\n                cm.display.shift = false;\n        }, 150);\n    }\n    return {\n        ensureFocus: ensureFocus,\n        delayBlurEvent: delayBlurEvent,\n        onFocus: onFocus,\n        onBlur: onBlur\n    };\n});"]}