{"version":3,"sources":["primitives/display/update_display.js"],"names":["define","a","b","c","d","e","f","g","h","m_update_line","m","n","o","DisplayUpdate","[object Object]","cm","viewport","force","display","this","visible","visibleLines","doc","editorIsHidden","wrapper","offsetWidth","wrapperHeight","clientHeight","wrapperWidth","clientWidth","oldDisplayWidth","displayWidth","dims","getDimensions","events","emitter","type","hasHandler","push","arguments","i","length","signal","apply","updateDisplayIfNeeded","update","resetView","from","viewFrom","to","viewTo","updateLineNumbers","renderedView","view","countDirtyView","maybeUpdateLineNumberWidth","end","first","size","Math","max","options","viewportMargin","min","sawCollapsedSpans","visualLineNo","visualLineEndNo","different","lastWrapHeight","lastWrapWidth","adjustView","viewOffset","heightAtLine","getLine","mover","style","top","toUpdate","selSnapshot","hasFocus","active","activeElt","contains","lineDiv","result","window","getSelection","sel","anchorNode","extend","anchorOffset","focusNode","focusOffset","selectionSnapshot","updateNumbersFrom","lineNumbers","container","cur","firstChild","rm","node","next","nextSibling","webkit","mac","currentWheelTarget","parentNode","removeChild","lineN","lineView","hidden","updateNumber","lineNumber","changes","indexOf","updateLineForChanges","removeChildren","appendChild","document","createTextNode","lineNumberFor","buildLineElement","insertBefore","patchDisplay","snapshot","focus","body","range","createRange","setEnd","collapse","removeAllRanges","addRange","restoreSelection","cursorDiv","selectionDiv","gutters","height","sizer","minHeight","startWorker","postUpdateDisplay","lineWrapping","paddingVert","displayHeight","updateHeightsInViewport","barMeasure","measureForScrollbars","updateSelection","updateScrollbars","setDocumentHeight","reportedViewFrom","reportedViewTo","measure","docHeight","heightForcer","barHeight","scrollGap","maybeClipScrollbars","scrollbarsClipped","scroller","nativeBarWidth","marginBottom","borderRightWidth","updateDisplaySimple","finish","updateGutterSpace","width","marginLeft"],"mappings":"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","file":"../../../primitives/display/update_display.js","sourcesContent":["define([\n    '../line/saw_special_spans',\n    '../line/spans',\n    '../line/utils_line',\n    '../measurement/position_measurement',\n    '../util/browser',\n    '../util/dom',\n    '../util/event',\n    '../util/misc',\n    './update_line',\n//    './highlight_worker', // dependence cycle \n//    './line_numbers',\n//    './scrollbars',\n    './selection',\n    './update_lines',\n    './view_tracking'\n], function (\n    a, \n    b, \n    c, \n    d, \n    e, \n    f, \n    g, \n    h, \n    m_update_line, \n//    j, \n//    k, \n//    l, \n    m, \n    n, \n    o\n) {\n    'use strict';\n    class DisplayUpdate {\n        constructor(cm, viewport, force) {\n            let display = cm.display;\n            this.viewport = viewport;\n            this.visible = n.visibleLines(display, cm.doc, viewport);\n            this.editorIsHidden = !display.wrapper.offsetWidth;\n            this.wrapperHeight = display.wrapper.clientHeight;\n            this.wrapperWidth = display.wrapper.clientWidth;\n            this.oldDisplayWidth = d.displayWidth(cm);\n            this.force = force;\n            this.dims = d.getDimensions(cm);\n            this.events = [];\n        }\n        signal(emitter, type) {\n            if (g.hasHandler(emitter, type))\n                this.events.push(arguments);\n        }\n        finish() {\n            for (let i = 0; i < this.events.length; i++)\n                g.signal.apply(null, this.events[i]);\n        }\n    }\n    function maybeClipScrollbars(cm) {\n        let display = cm.display;\n        if (!display.scrollbarsClipped && display.scroller.offsetWidth) {\n            display.nativeBarWidth = display.scroller.offsetWidth - display.scroller.clientWidth;\n            display.heightForcer.style.height = d.scrollGap(cm) + 'px';\n            display.sizer.style.marginBottom = -display.nativeBarWidth + 'px';\n            display.sizer.style.borderRightWidth = d.scrollGap(cm) + 'px';\n            display.scrollbarsClipped = true;\n        }\n    }\n    function selectionSnapshot(cm) {\n        if (cm.hasFocus())\n            return null;\n        let active = f.activeElt();\n        if (!active || !f.contains(cm.display.lineDiv, active))\n            return null;\n        let result = { activeElt: active };\n        if (window.getSelection) {\n            let sel = window.getSelection();\n            if (sel.anchorNode && sel.extend && f.contains(cm.display.lineDiv, sel.anchorNode)) {\n                result.anchorNode = sel.anchorNode;\n                result.anchorOffset = sel.anchorOffset;\n                result.focusNode = sel.focusNode;\n                result.focusOffset = sel.focusOffset;\n            }\n        }\n        return result;\n    }\n    function restoreSelection(snapshot) {\n        if (!snapshot || !snapshot.activeElt || snapshot.activeElt == f.activeElt())\n            return;\n        snapshot.activeElt.focus();\n        if (snapshot.anchorNode && f.contains(document.body, snapshot.anchorNode) && f.contains(document.body, snapshot.focusNode)) {\n            let sel = window.getSelection(), range = document.createRange();\n            range.setEnd(snapshot.anchorNode, snapshot.anchorOffset);\n            range.collapse(false);\n            sel.removeAllRanges();\n            sel.addRange(range);\n            sel.extend(snapshot.focusNode, snapshot.focusOffset);\n        }\n    }\n    function updateDisplayIfNeeded(cm, update) {\n        let display = cm.display, doc = cm.doc;\n        if (update.editorIsHidden) {\n            o.resetView(cm);\n            return false;\n        }\n        if (!update.force && update.visible.from >= display.viewFrom && update.visible.to <= display.viewTo && (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo) && display.renderedView == display.view && o.countDirtyView(cm) == 0)\n            return false;\n        if (cm.maybeUpdateLineNumberWidth()) { //if (k.maybeUpdateLineNumberWidth(cm)) {\n            o.resetView(cm);\n            update.dims = d.getDimensions(cm);\n        }\n        let end = doc.first + doc.size;\n        let from = Math.max(update.visible.from - cm.options.viewportMargin, doc.first);\n        let to = Math.min(end, update.visible.to + cm.options.viewportMargin);\n        if (display.viewFrom < from && from - display.viewFrom < 20)\n            from = Math.max(doc.first, display.viewFrom);\n        if (display.viewTo > to && display.viewTo - to < 20)\n            to = Math.min(end, display.viewTo);\n        if (a.sawCollapsedSpans) {\n            from = b.visualLineNo(cm.doc, from);\n            to = b.visualLineEndNo(cm.doc, to);\n        }\n        let different = from != display.viewFrom || to != display.viewTo || display.lastWrapHeight != update.wrapperHeight || display.lastWrapWidth != update.wrapperWidth;\n        o.adjustView(cm, from, to);\n        display.viewOffset = b.heightAtLine(c.getLine(cm.doc, display.viewFrom));\n        cm.display.mover.style.top = display.viewOffset + 'px';\n        let toUpdate = o.countDirtyView(cm);\n        if (!different && toUpdate == 0 && !update.force && display.renderedView == display.view && (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo))\n            return false;\n        let selSnapshot = selectionSnapshot(cm);\n        if (toUpdate > 4)\n            display.lineDiv.style.display = 'none';\n        patchDisplay(cm, display.updateLineNumbers, update.dims);\n        if (toUpdate > 4)\n            display.lineDiv.style.display = '';\n        display.renderedView = display.view;\n        restoreSelection(selSnapshot);\n        f.removeChildren(display.cursorDiv);\n        f.removeChildren(display.selectionDiv);\n        display.gutters.style.height = display.sizer.style.minHeight = 0;\n        if (different) {\n            display.lastWrapHeight = update.wrapperHeight;\n            display.lastWrapWidth = update.wrapperWidth;\n            cm.startWorker(400); // j.startWorker(cm, 400);\n        }\n        display.updateLineNumbers = null;\n        return true;\n    }\n    function postUpdateDisplay(cm, update) {\n        let viewport = update.viewport;\n        for (let first = true;; first = false) {\n            if (!first || !cm.options.lineWrapping || update.oldDisplayWidth == d.displayWidth(cm)) {\n                if (viewport && viewport.top != null)\n                    viewport = { top: Math.min(cm.doc.height + d.paddingVert(cm.display) - d.displayHeight(cm), viewport.top) };\n                update.visible = n.visibleLines(cm.display, cm.doc, viewport);\n                if (update.visible.from >= cm.display.viewFrom && update.visible.to <= cm.display.viewTo)\n                    break;\n            }\n            if (!updateDisplayIfNeeded(cm, update))\n                break;\n            n.updateHeightsInViewport(cm);\n            let barMeasure = cm.measureForScrollbars(); //l.measureForScrollbars(cm);\n            m.updateSelection(cm);\n            cm.updateScrollbars(barMeasure); //l.updateScrollbars(cm, barMeasure);\n            setDocumentHeight(cm, barMeasure);\n            update.force = false;\n        }\n        update.signal(cm, 'update', cm);\n        if (cm.display.viewFrom != cm.display.reportedViewFrom || cm.display.viewTo != cm.display.reportedViewTo) {\n            update.signal(cm, 'viewportChange', cm, cm.display.viewFrom, cm.display.viewTo);\n            cm.display.reportedViewFrom = cm.display.viewFrom;\n            cm.display.reportedViewTo = cm.display.viewTo;\n        }\n    }\n    function updateDisplaySimple(cm, viewport) {\n        let update = new DisplayUpdate(cm, viewport);\n        if (updateDisplayIfNeeded(cm, update)) {\n            n.updateHeightsInViewport(cm);\n            postUpdateDisplay(cm, update);\n            let barMeasure = cm.measureForScrollbars(); //l.measureForScrollbars(cm);\n            m.updateSelection(cm);\n            cm.updateScrollbars(barMeasure); // l.updateScrollbars(cm, barMeasure);\n            setDocumentHeight(cm, barMeasure);\n            update.finish();\n        }\n    }\n    function patchDisplay(cm, updateNumbersFrom, dims) {\n        let display = cm.display, lineNumbers = cm.options.lineNumbers;\n        let container = display.lineDiv, cur = container.firstChild;\n        function rm(node) {\n            let next = node.nextSibling;\n            if (e.webkit && e.mac && cm.display.currentWheelTarget == node)\n                node.style.display = 'none';\n            else\n                node.parentNode.removeChild(node);\n            return next;\n        }\n        let view = display.view, lineN = display.viewFrom;\n        for (let i = 0; i < view.length; i++) {\n            let lineView = view[i];\n            if (lineView.hidden) {\n            } else if (!lineView.node || lineView.node.parentNode != container) {\n                let node = m_update_line.buildLineElement(cm, lineView, lineN, dims);\n                container.insertBefore(node, cur);\n            } else {\n                while (cur != lineView.node)\n                    cur = rm(cur);\n                let updateNumber = lineNumbers && updateNumbersFrom != null && updateNumbersFrom <= lineN && lineView.lineNumber;\n                if (lineView.changes) {\n                    if (h.indexOf(lineView.changes, 'gutter') > -1)\n                        updateNumber = false;\n                    m_update_line.updateLineForChanges(cm, lineView, lineN, dims);\n                }\n                if (updateNumber) {\n                    f.removeChildren(lineView.lineNumber);\n                    lineView.lineNumber.appendChild(document.createTextNode(c.lineNumberFor(cm.options, lineN)));\n                }\n                cur = lineView.node.nextSibling;\n            }\n            lineN += lineView.size;\n        }\n        while (cur)\n            cur = rm(cur);\n    }\n    function updateGutterSpace(cm) {\n        let width = cm.display.gutters.offsetWidth;\n        cm.display.sizer.style.marginLeft = width + 'px';\n    }\n    function setDocumentHeight(cm, measure) {\n        cm.display.sizer.style.minHeight = measure.docHeight + 'px';\n        cm.display.heightForcer.style.top = measure.docHeight + 'px';\n        cm.display.gutters.style.height = measure.docHeight + cm.display.barHeight + d.scrollGap(cm) + 'px';\n    }\n    return {\n        DisplayUpdate: DisplayUpdate,\n        maybeClipScrollbars: maybeClipScrollbars,\n        updateDisplayIfNeeded: updateDisplayIfNeeded,\n        postUpdateDisplay: postUpdateDisplay,\n        updateDisplaySimple: updateDisplaySimple,\n        updateGutterSpace: updateGutterSpace,\n        setDocumentHeight: setDocumentHeight\n    };\n});"]}