{"version":3,"sources":["primitives/edit/options.js"],"names":["define","focus","gutters","line_numbers","mode_state","scrollbars","selection","view_tracking","keymap","line_data","posit","spans","measurement","changes","browser","dom","event","utils","Init","toString","guttersChanged","cm","updateGutters","regChange","alignHorizontally","dragDropChanged","value","old","funcs","display","dragFunctions","toggle","on","off","scroller","start","enter","over","leave","drop","wrappingChanged","options","lineWrapping","addClass","wrapper","sizer","style","minWidth","sizerWidth","rmClass","findMaxLine","estimateLineHeights","clearCaches","setTimeout","updateScrollbars","defaults","optionHandlers","defineOptions","CodeMirror","option","name","deflt","handle","notOnInit","val","defineOption","setValue","doc","modeOption","loadMode","resetModeState","lineSep","newBreaks","lineNo","first","iter","line","pos","found","text","indexOf","length","push","Pos","i","replaceRange","ch","state","specialChars","RegExp","source","test","refresh","defaultSpecialCharPlaceholder","mobile","Error","getInputField","spellcheck","autocorrect","autocapitalize","windows","themeChanged","next","getKeyMap","prev","detach","attach","setGuttersForLineNumbers","left","compensateForHScroll","initScrollbars","setScrollTop","scrollTop","setScrollLeft","scrollLeft","integer","updateSelection","onBlur","input","blur","readOnlyChanged","reset","history","undoDepth","resetPosition","getField","tabIndex","setDirection"],"mappings":"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","file":"../../../primitives/edit/options.js","sourcesContent":["define([\n    '../display/focus',\n    '../display/gutters',\n    '../display/line_numbers',\n    '../display/mode_state',\n    '../display/scrollbars',\n    '../display/selection',\n    '../display/view_tracking',\n    '../input/keymap',\n    '../line/line_data',\n    '../line/pos',\n    '../line/spans',\n    '../measurement/position_measurement',\n    '../model/changes',\n    '../util/browser',\n    '../util/dom',\n    '../util/event',\n    './utils'\n], function (focus, gutters, line_numbers, mode_state, scrollbars, selection, view_tracking, keymap, line_data, posit, spans, measurement, changes, browser, dom, event, utils) {\n    'use strict';\n    let Init = {\n        toString: function () {\n            return 'CodeMirror.Init';\n        }\n    };\n    let defaults = {};\n    let optionHandlers = {};\n    function defineOptions(CodeMirror) {\n        let optionHandlers = CodeMirror.optionHandlers;\n        function option(name, deflt, handle, notOnInit) {\n            CodeMirror.defaults[name] = deflt;\n            if (handle)\n                optionHandlers[name] = notOnInit ? (cm, val, old) => {\n                    if (old != Init)\n                        handle(cm, val, old);\n                } : handle;\n        }\n        CodeMirror.defineOption = option;\n        CodeMirror.Init = Init;\n        option('value', '', (cm, val) => cm.setValue(val), true);\n        option('mode', null, (cm, val) => {\n            cm.doc.modeOption = val;\n            mode_state.loadMode(cm);\n        }, true);\n        option('indentUnit', 2, mode_state.loadMode, true);\n        option('indentWithTabs', false);\n        option('smartIndent', true);\n        option('tabSize', 4, cm => {\n            mode_state.resetModeState(cm);\n            measurement.clearCaches(cm);\n            view_tracking.regChange(cm);\n        }, true);\n        option('lineSeparator', null, (cm, val) => {\n            cm.doc.lineSep = val;\n            if (!val)\n                return;\n            let newBreaks = [], lineNo = cm.doc.first;\n            cm.doc.iter(line => {\n                for (let pos = 0;;) {\n                    let found = line.text.indexOf(val, pos);\n                    if (found == -1)\n                        break;\n                    pos = found + val.length;\n                    newBreaks.push(posit.Pos(lineNo, found));\n                }\n                lineNo++;\n            });\n            for (let i = newBreaks.length - 1; i >= 0; i--)\n                changes.replaceRange(cm.doc, val, newBreaks[i], posit.Pos(newBreaks[i].line, newBreaks[i].ch + val.length));\n        });\n        option('specialChars', /[\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u061c\\u200b-\\u200f\\u2028\\u2029\\ufeff]/g, (cm, val, old) => {\n            cm.state.specialChars = new RegExp(val.source + (val.test('\\t') ? '' : '|\\t'), 'g');\n            if (old != Init)\n                cm.refresh();\n        });\n        option('specialCharPlaceholder', line_data.defaultSpecialCharPlaceholder, cm => cm.refresh(), true);\n        option('electricChars', true);\n        option('inputStyle', browser.mobile ? 'contenteditable' : 'textarea', () => {\n            throw new Error('inputStyle can not (yet) be changed in a running editor');\n        }, true);\n        option('spellcheck', false, (cm, val) => cm.getInputField().spellcheck = val, true);\n        option('autocorrect', false, (cm, val) => cm.getInputField().autocorrect = val, true);\n        option('autocapitalize', false, (cm, val) => cm.getInputField().autocapitalize = val, true);\n        option('rtlMoveVisually', !browser.windows);\n        option('wholeLineUpdateBefore', true);\n        option('theme', 'default', cm => {\n            utils.themeChanged(cm);\n            guttersChanged(cm);\n        }, true);\n        option('keyMap', 'default', (cm, val, old) => {\n            let next = keymap.getKeyMap(val);\n            let prev = old != Init && keymap.getKeyMap(old);\n            if (prev && prev.detach)\n                prev.detach(cm, next);\n            if (next.attach)\n                next.attach(cm, prev || null);\n        });\n        option('extraKeys', null);\n        option('configureMouse', null);\n        option('lineWrapping', false, wrappingChanged, true);\n        option('gutters', [], cm => {\n            gutters.setGuttersForLineNumbers(cm.options);\n            guttersChanged(cm);\n        }, true);\n        option('fixedGutter', true, (cm, val) => {\n            cm.display.gutters.style.left = val ? measurement.compensateForHScroll(cm.display) + 'px' : '0';\n            cm.refresh();\n        }, true);\n        option('coverGutterNextToScrollbar', false, cm => scrollbars.updateScrollbars(cm), true);\n        option('scrollbarStyle', 'native', cm => {\n            scrollbars.initScrollbars(cm);\n            scrollbars.updateScrollbars(cm);\n            cm.display.scrollbars.setScrollTop(cm.doc.scrollTop);\n            cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft);\n        }, true);\n        option('lineNumbers', false, cm => {\n            gutters.setGuttersForLineNumbers(cm.options);\n            guttersChanged(cm);\n        }, true);\n        option('firstLineNumber', 1, guttersChanged, true);\n        option('lineNumberFormatter', integer => integer, guttersChanged, true);\n        option('showCursorWhenSelecting', false, selection.updateSelection, true);\n        option('resetSelectionOnContextMenu', true);\n        option('lineWiseCopyCut', true);\n        option('pasteLinesPerSelection', true);\n        option('selectionsMayTouch', false);\n        option('readOnly', false, (cm, val) => {\n            if (val == 'nocursor') {\n                focus.onBlur(cm);\n                cm.display.input.blur();\n            }\n            cm.display.input.readOnlyChanged(val);\n        });\n        option('disableInput', false, (cm, val) => {\n            if (!val)\n                cm.display.input.reset();\n        }, true);\n        option('dragDrop', true, dragDropChanged);\n        option('allowDropFileTypes', null);\n        option('cursorBlinkRate', 530);\n        option('cursorScrollMargin', 0);\n        option('cursorHeight', 1, selection.updateSelection, true);\n        option('singleCursorHeightPerLine', true, selection.updateSelection, true);\n        option('workTime', 100);\n        option('workDelay', 100);\n        option('flattenSpans', true, mode_state.resetModeState, true);\n        option('addModeClass', false, mode_state.resetModeState, true);\n        option('pollInterval', 100);\n        option('undoDepth', 200, (cm, val) => cm.doc.history.undoDepth = val);\n        option('historyEventDelay', 1250);\n        option('viewportMargin', 10, cm => cm.refresh(), true);\n        option('maxHighlightLength', 10000, mode_state.resetModeState, true);\n        option('moveInputWithCursor', true, (cm, val) => {\n            if (!val)\n                cm.display.input.resetPosition();\n        });\n        option('tabindex', null, (cm, val) => cm.display.input.getField().tabIndex = val || '');\n        option('autofocus', null);\n        option('direction', 'ltr', (cm, val) => cm.doc.setDirection(val), true);\n        option('phrases', null);\n    }\n    function guttersChanged(cm) {\n        gutters.updateGutters(cm);\n        view_tracking.regChange(cm);\n        line_numbers.alignHorizontally(cm);\n    }\n    function dragDropChanged(cm, value, old) {\n        let wasOn = old && old != Init;\n        if (!value != !wasOn) {\n            let funcs = cm.display.dragFunctions;\n            let toggle = value ? event.on : event.off;\n            toggle(cm.display.scroller, 'dragstart', funcs.start);\n            toggle(cm.display.scroller, 'dragenter', funcs.enter);\n            toggle(cm.display.scroller, 'dragover', funcs.over);\n            toggle(cm.display.scroller, 'dragleave', funcs.leave);\n            toggle(cm.display.scroller, 'drop', funcs.drop);\n        }\n    }\n    function wrappingChanged(cm) {\n        if (cm.options.lineWrapping) {\n            dom.addClass(cm.display.wrapper, 'CodeMirror-wrap');\n            cm.display.sizer.style.minWidth = '';\n            cm.display.sizerWidth = null;\n        } else {\n            dom.rmClass(cm.display.wrapper, 'CodeMirror-wrap');\n            spans.findMaxLine(cm);\n        }\n        measurement.estimateLineHeights(cm);\n        view_tracking.regChange(cm);\n        measurement.clearCaches(cm);\n        setTimeout(() => scrollbars.updateScrollbars(cm), 100);\n    }\n    return {\n        Init: Init,\n        defaults: defaults,\n        optionHandlers: optionHandlers,\n        defineOptions: defineOptions\n    };\n});"]}