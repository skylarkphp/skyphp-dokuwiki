{"version":3,"sources":["primitives/model/selection.js"],"names":["define","m_pos","m_misc","Selection","[object Object]","ranges","primIndex","this","other","length","i","here","there","equalCursorPos","anchor","head","out","Range","copyPos","empty","pos","end","range","cmp","from","to","minPos","maxPos","line","ch","normalizeSelection","cm","mayTouch","options","selectionsMayTouch","prim","sort","a","b","indexOf","cur","prev","diff","inv","splice","simpleSelection"],"mappings":"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","file":"../../../primitives/model/selection.js","sourcesContent":["define([\n    '../line/pos',\n    '../util/misc'\n], function (m_pos, m_misc) {\n    'use strict';\n    class Selection {\n        constructor(ranges, primIndex) {\n            this.ranges = ranges;\n            this.primIndex = primIndex;\n        }\n        primary() {\n            return this.ranges[this.primIndex];\n        }\n        equals(other) {\n            if (other == this)\n                return true;\n            if (other.primIndex != this.primIndex || other.ranges.length != this.ranges.length)\n                return false;\n            for (let i = 0; i < this.ranges.length; i++) {\n                let here = this.ranges[i], there = other.ranges[i];\n                if (!m_pos.equalCursorPos(here.anchor, there.anchor) || !m_pos.equalCursorPos(here.head, there.head))\n                    return false;\n            }\n            return true;\n        }\n        deepCopy() {\n            let out = [];\n            for (let i = 0; i < this.ranges.length; i++)\n                out[i] = new Range(m_pos.copyPos(this.ranges[i].anchor), m_pos.copyPos(this.ranges[i].head));\n            return new Selection(out, this.primIndex);\n        }\n        somethingSelected() {\n            for (let i = 0; i < this.ranges.length; i++)\n                if (!this.ranges[i].empty())\n                    return true;\n            return false;\n        }\n        contains(pos, end) {\n            if (!end)\n                end = pos;\n            for (let i = 0; i < this.ranges.length; i++) {\n                let range = this.ranges[i];\n                if (m_pos.cmp(end, range.from()) >= 0 && m_pos.cmp(pos, range.to()) <= 0)\n                    return i;\n            }\n            return -1;\n        }\n    }\n    class Range {\n        constructor(anchor, head) {\n            this.anchor = anchor;\n            this.head = head;\n        }\n        from() {\n            return m_pos.minPos(this.anchor, this.head);\n        }\n        to() {\n            return m_pos.maxPos(this.anchor, this.head);\n        }\n        empty() {\n            return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch;\n        }\n    }\n    function normalizeSelection(cm, ranges, primIndex) {\n        let mayTouch = cm && cm.options.selectionsMayTouch;\n        let prim = ranges[primIndex];\n        ranges.sort((a, b) => m_pos.cmp(a.from(), b.from()));\n        primIndex = m_misc.indexOf(ranges, prim);\n        for (let i = 1; i < ranges.length; i++) {\n            let cur = ranges[i], prev = ranges[i - 1];\n            let diff = m_pos.cmp(prev.to(), cur.from());\n            if (mayTouch && !cur.empty() ? diff > 0 : diff >= 0) {\n                let from = m_pos.minPos(prev.from(), cur.from()), to = m_pos.maxPos(prev.to(), cur.to());\n                let inv = prev.empty() ? cur.from() == cur.head : prev.from() == prev.head;\n                if (i <= primIndex)\n                    --primIndex;\n                ranges.splice(--i, 2, new Range(inv ? to : from, inv ? from : to));\n            }\n        }\n        return new Selection(ranges, primIndex);\n    }\n    function simpleSelection(anchor, head) {\n        return new Selection([new Range(anchor, head || anchor)], 0);\n    }\n    return {\n        Selection: Selection,\n        Range: Range,\n        normalizeSelection: normalizeSelection,\n        simpleSelection: simpleSelection\n    };\n});"]}