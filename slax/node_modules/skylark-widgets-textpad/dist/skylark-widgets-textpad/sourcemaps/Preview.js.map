{"version":3,"sources":["preview.js"],"names":["define","langx","browser","datax","eventer","noder","geom","elmx","$","Widget","inherit","klassName","pluginName","options","className","css","onLoaded","theme","_init","this","elem","_elm","randomString","Math","random","toString","substring","doc","ownerDocument","win","defaultView","parentWindow","attachEvents","bootstrap","handleKeypress","handleResizeImage","utils","call","detachEvents","removeClass","removeAttr","unwrap","attr","addClass","wrap","$wrapperElem","parent","containerClass","get","closest","_this","keydown","e","keyCode","isSelectionInsideElement","addEventListener","preventDefault","text","clipboardData","getData","replace","execCommand","tagName","sel","containerNode","toUpperCase","getSelection","rangeCount","getRangeAt","commonAncestorContainer","selection","type","createRange","parentElement","nodeType","parentNode","on","event","stopPropagation","find","width","click","removeFormatting","arg","inFullArea","isSelectionOutsideOfEditor","selectedText","length","range","$parent","node","createElement","html","deleteContents","insertNode","contents","topMostParent","hasParentNode","each","parentsUntil","index","el","removeEmptyTags","removeBlockElementFromSelection","removeBr","removeBrNode","undefined","selectedHtml","cloneContents","temp","replaceWith","childNodes","wrapSelectionWithNodeName","name","blockElement","style","class","attribute","keepHtml","nodeName","isWrapped","isAlreadyWrapped","cloneRange","tag","addAttribute","selectionContainsHtml","clonedSelection","div","appendChild","innerHTML","textContent","localName","surroundContents","removeAllRanges","addRange","removeWrappedDuplicateTag","select","wrapSelectionWithList","tagname","listArray","split","filter","v","wrappedListHtml","map","item","trim","startContainer","result","prop","toLowerCase","hasClass","inArray","isArray","insertAtCaret","appendTo","elementContainsSelection","isActive","readonly","isOrContains","container","i","insertHtml","bindData","closeModal","clearTimeout","setTimeout","hide","getYoutubeVideoIdFromUrl","url","openModal","selector","val","$temp","remove","focus","bold","italic","strike","listOl","listUl","h2","h3","h4","x","alignleft","aligncenter","alignright","alignfull","blockquote","code","inserthorizontalrule","image","prompt","urlRegex","RegExp","test","link","indent","outdent","toMd","toMarkdown"],"mappings":"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","file":"../preview.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-browser\",\r\n  \"skylark-domx-data\",\r\n  \"skylark-domx-eventer\",\r\n  \"skylark-domx-noder\",\r\n  \"skylark-domx-geom\",\r\n  \"skylark-domx-velm\",\r\n  \"skylark-domx-query\",\r\n  \"skylark-widgets-base/widget\"\r\n],function(langx,browser,datax,eventer,noder,geom,elmx,$,Widget){\r\n\r\n    'use strict';\r\n\r\n    var Preview = Widget.inherit({\r\n        klassName: \"Preview\",\r\n\r\n        pluginName : \"lark.codeeditor.preview\",\r\n\r\n        options : {\r\n            className : 'easyeditor',\r\n            css : null,\r\n            onLoaded : null,\r\n            theme : null\r\n        },\r\n\r\n        _init :   function ( ){\r\n            this.elem = this._elm;\r\n            this.className = this.options.className ;\r\n\r\n            this.css = this.options.css;\r\n            this.onLoaded = this.options.onLoaded;\r\n\r\n            this.randomString = \"Cls\"+Math.random().toString(36).substring(7);\r\n            this.theme = this.options.theme;\r\n\r\n            var doc = this.doc = this._elm.ownerDocument;\r\n            this.win = doc.defaultView || doc.parentWindow;\r\n\r\n            this.attachEvents();\r\n        },\r\n\r\n\r\n        attachEvents : function() {\r\n            this.bootstrap();\r\n            this.handleKeypress();\r\n            this.handleResizeImage();\r\n            this.utils();\r\n\r\n            if(this.onLoaded !== null) {\r\n                this.onLoaded.call(this);\r\n            }\r\n        },\r\n\r\n        // destory editor\r\n        detachEvents : function() {\r\n            var _this = this;\r\n\r\n            $(_this.elem).removeClass(_this.className).removeAttr('contenteditable').unwrap();\r\n        },\r\n\r\n        // Adding necessary classes and attributes in editor\r\n        bootstrap : function() {\r\n            var _this = this;\r\n            $(_this.elem).attr('contentEditable', true).addClass(_this.className).wrap('<div class=\"'+ _this.className +'-wrapper\"></div>');\r\n\r\n            this.$wrapperElem = $(_this.elem).parent();\r\n\r\n            if(_this.css !== null) {\r\n                $(_this.elem).css(_this.css);\r\n            }\r\n\r\n            this.containerClass = '.' + _this.className +'-wrapper';\r\n\r\n            if(typeof _this.elem === 'string') {\r\n                _this.elem = $(_this.elem).get(0);\r\n            }\r\n\r\n            if(_this.theme !== null) {\r\n                $(_this.elem).closest(_this.containerClass).addClass(_this.theme);\r\n            }\r\n        },\r\n\r\n\r\n        // enter and paste key handler\r\n        handleKeypress : function(){\r\n            var _this = this;\r\n\r\n            $(_this.elem).keydown(function(e) {\r\n                if(e.keyCode === 13 && _this.isSelectionInsideElement('li') === false) {\r\n     //               e.preventDefault();\r\n    //\r\n    //                if(e.shiftKey === true) {\r\n    //                    document.execCommand('insertHTML', false, '<br>');\r\n    //                }\r\n    //                else {\r\n    //                    document.execCommand('insertHTML', false, '<br><br>');\r\n    //                }\r\n    //\r\n    //                return false;\r\n                }\r\n            });\r\n\r\n            _this.elem.addEventListener('paste', function(e) {\r\n                e.preventDefault();\r\n                var text = e.clipboardData.getData('text/plain').replace(/\\n/ig, '<br>');\r\n                //document.execCommand('insertHTML', false, text);\r\n                _this.doc.execCommand('insertHTML', false, text);\r\n            });\r\n\r\n        },\r\n\r\n        isSelectionInsideElement : function(tagName) {\r\n            var sel, containerNode;\r\n            var win = this.win,\r\n                doc = this.doc;\r\n            tagName = tagName.toUpperCase();\r\n            if (win.getSelection) {\r\n                sel = win.getSelection();\r\n                if (sel.rangeCount > 0) {\r\n                    containerNode = sel.getRangeAt(0).commonAncestorContainer;\r\n                }\r\n            } else if ( (sel = doc.selection) && sel.type != \"Control\" ) {\r\n                containerNode = sel.createRange().parentElement();\r\n            }\r\n            while (containerNode) {\r\n                if (containerNode.nodeType == 1 && containerNode.tagName == tagName) {\r\n                    return true;\r\n                }\r\n                containerNode = containerNode.parentNode;\r\n            }\r\n            return false;\r\n        },\r\n\r\n        // allowing resizing image\r\n        handleResizeImage : function(){\r\n            var _this = this;\r\n\r\n            $('html').on(_this.containerClass + ' figure', 'click', function(event) {\r\n                event.stopPropagation();\r\n                $(this).addClass('is-resizable');\r\n            });\r\n\r\n            $('html').on(_this.containerClass + ' figure.is-resizable', 'mousemove', function(event) {\r\n                $(this).find('img').css({ 'width' : $(this).width() + 'px' });\r\n            });\r\n\r\n            $(_this.doc).click(function() {\r\n                $(_this.elem).find('figure').removeClass('is-resizable');\r\n            });\r\n        },\r\n\r\n        // get selection\r\n        getSelection : function(){\r\n            if (this.win.getSelection) {\r\n                var selection = this.win.getSelection();\r\n\r\n                if (selection.rangeCount) {\r\n                    return selection;\r\n                }\r\n            }\r\n\r\n            return false;\r\n        },\r\n\r\n        // remove formatting\r\n        removeFormatting : function(arg){\r\n            var _this = this;\r\n            var inFullArea = arg.inFullArea;\r\n\r\n            if(_this.isSelectionOutsideOfEditor() === true) {\r\n                return false;\r\n            }\r\n\r\n            if(inFullArea === false) {\r\n                var selection = _this.getSelection();\r\n                var selectedText = selection.toString();\r\n\r\n                if(selection && selectedText.length > 0) {\r\n\r\n                    var range = selection.getRangeAt(0);\r\n                    var $parent = $(range.commonAncestorContainer.parentNode);\r\n\r\n                    if($parent.attr('class') === _this.className || $parent.attr('class') === _this.className + '-wrapper') {\r\n                        var node = _this.doc.createElement('span');\r\n                        $(node).attr('data-value', 'temp').html(selectedText.replace(/\\n/ig, '<br>'));\r\n                        range.deleteContents();\r\n                        range.insertNode(node);\r\n\r\n                        $('[data-value=\"temp\"]').contents().unwrap();\r\n                    }\r\n                    else {\r\n\r\n                        var topMostParent;\r\n                        var hasParentNode = false;\r\n                        $.each($parent.parentsUntil(_this.elem), function(index, el) {\r\n                            topMostParent = el;\r\n                            hasParentNode = true;\r\n                        });\r\n\r\n                        if(hasParentNode === true) {\r\n                            $(topMostParent).html($(topMostParent).text().replace(/\\n/ig, '<br>')).contents().unwrap();\r\n                        }\r\n                        else {\r\n                            $parent.contents().unwrap();\r\n                        }\r\n\r\n                    }\r\n\r\n                }\r\n            }\r\n            else {\r\n                $(_this.elem).html($(_this.elem).text().replace(/\\n/ig, '<br>'));\r\n            }\r\n\r\n            // _this.removeEmptyTags();\r\n        },\r\n\r\n        // removing empty tags\r\n        removeEmptyTags : function(){\r\n            var _this = this;\r\n            $(_this.elem).html( $(_this.elem).html().replace(/(<(?!\\/)[^>]+>)+(<\\/[^>]+>)+/, '') );\r\n        },\r\n\r\n        // remove block elemenet from selection\r\n        removeBlockElementFromSelection : function(selection, removeBr){\r\n            var _this = this;\r\n            var result;\r\n\r\n            removeBr = removeBr === undefined ? false : removeBr;\r\n            var removeBrNode = '';\r\n            if(removeBr === true) {\r\n                removeBrNode = ', br';\r\n            }\r\n\r\n            var range = selection.getRangeAt(0);\r\n            var selectedHtml = range.cloneContents();\r\n            var temp = _this.doc.createElement('temp');\r\n            $(temp).html(selectedHtml);\r\n            $(temp).find('h1, h2, h3, h4, h5, h6, p, div' + removeBrNode).each(function() { $(this).replaceWith(this.childNodes); });\r\n            result = $(temp).html();\r\n\r\n            return result;\r\n        },\r\n\r\n        // wrap selction with a tag\r\n        wrapSelectionWithNodeName : function(arg){\r\n            var _this = this;\r\n            if(_this.isSelectionOutsideOfEditor() === true) {\r\n                return false;\r\n            }\r\n\r\n            var node = {\r\n                name: 'span',\r\n                blockElement: false,\r\n                style: null,\r\n                class: null,\r\n                attribute: null,\r\n                keepHtml: false\r\n            };\r\n\r\n            if(typeof arg === 'string') {\r\n                node.name = arg;\r\n            }\r\n            else {\r\n                node.name = arg.nodeName || node.name;\r\n                node.blockElement = arg.blockElement || node.blockElement;\r\n                node.style = arg.style || node.style;\r\n                node.class = arg.class || node.class;\r\n                node.attribute = arg.attribute || node.attribute;\r\n                node.keepHtml = arg.keepHtml || node.keepHtml;\r\n            }\r\n\r\n            var selection = _this.getSelection();\r\n\r\n            if(selection && selection.toString().length > 0 && selection.rangeCount) {\r\n                // checking if already wrapped\r\n                var isWrapped = _this.isAlreadyWrapped(selection, node);\r\n\r\n                // wrap node\r\n                var range = selection.getRangeAt(0).cloneRange();\r\n                var tag = _this.doc.createElement(node.name);\r\n\r\n                    // adding necessary attribute to tag\r\n                    if(node.style !== null || node.class !== null || node.attribute !== null) {\r\n                        tag = _this.addAttribute(tag, node);\r\n                    }\r\n\r\n                // if selection contains html, surround contents has some problem with pre html tag and raw text selection\r\n                if(_this.selectionContainsHtml(range)) {\r\n                    range = selection.getRangeAt(0);\r\n\r\n                    if(node.keepHtml === true) {\r\n                        var clonedSelection = range.cloneContents();\r\n                        var div = _this.doc.createElement('div');\r\n                        div.appendChild(clonedSelection);\r\n                        $(tag).html(div.innerHTML);\r\n                    }\r\n                    else {\r\n                        tag.textContent = selection.toString();\r\n                    }\r\n\r\n                    range.deleteContents();\r\n                    range.insertNode(tag);\r\n\r\n                    if(range.commonAncestorContainer.localName === node.name) {\r\n                        $(range.commonAncestorContainer).contents().unwrap();\r\n                        _this.removeEmptyTags();\r\n                    }\r\n                }\r\n                else {\r\n                    range.surroundContents(tag);\r\n                    selection.removeAllRanges();\r\n                    selection.addRange(range);\r\n                }\r\n\r\n                if(isWrapped === true) {\r\n                    _this.removeWrappedDuplicateTag(tag);\r\n                }\r\n\r\n                _this.removeEmptyTags();\r\n                //selection.removeAllRanges();\r\n                selection.select();\r\n                range.select();\r\n            }\r\n        },\r\n\r\n        // wrap selection with unordered list\r\n        wrapSelectionWithList : function(tagname){\r\n            var _this = this;\r\n            tagname = tagname || 'ul';\r\n\r\n            // preventing outside selection\r\n            if(_this.isSelectionOutsideOfEditor() === true) {\r\n                return false;\r\n            }\r\n\r\n            // if text selected\r\n            var selection = _this.getSelection();\r\n            if(selection && selection.toString().length > 0 && selection.rangeCount) {\r\n                var selectedHtml = _this.removeBlockElementFromSelection(selection, true);\r\n                var listArray = selectedHtml.split('\\n').filter(function(v){return v!=='';});\r\n                var wrappedListHtml = $.map(listArray, function(item) {\r\n                    return '<li>' + $.trim(item) + '</li>';\r\n                });\r\n\r\n                var node = _this.doc.createElement(tagname);\r\n                $(node).html(wrappedListHtml);\r\n\r\n                var range = selection.getRangeAt(0);\r\n                range.deleteContents();\r\n                range.insertNode(node);\r\n\r\n                selection.removeAllRanges();\r\n            }\r\n\r\n        },\r\n\r\n        // if selection contains html tag, surround content fails if selection contains html\r\n        selectionContainsHtml : function(range){\r\n            var _this = this;\r\n            if(range.startContainer.parentNode.className === _this.className + '-wrapper') return false;\r\n            else return true;\r\n        },\r\n\r\n        // if already wrapped with same tag\r\n        isAlreadyWrapped : function(selection, node){\r\n            var _this = this;\r\n            var range = selection.getRangeAt(0);\r\n            var el = $(range.commonAncestorContainer);\r\n            var result = false;\r\n\r\n            if( el.parent().prop('tagName').toLowerCase() === node.name && el.parent().hasClass(_this.className) === false ) {\r\n                result = true;\r\n            }\r\n            else if(node.blockElement === true) {\r\n                $.each(el.parentsUntil(_this.elem), function(index, el) {\r\n                    var tag = el.tagName.toLowerCase();\r\n                    if( $.inArray(tag, ['h1', 'h2', 'h3', 'h4', 'h5', 'h6']) !== -1 ) {\r\n                        result = true;\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                $.each(el.parentsUntil(_this.elem), function(index, el) {\r\n                    var tag = el.tagName.toLowerCase();\r\n                    if( tag === node.name ) {\r\n                        result = true;\r\n                    }\r\n                });\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        // remove wrap if already wrapped with same tag\r\n        removeWrappedDuplicateTag : function(tag){\r\n            var _this = this;\r\n            var tagName = tag.tagName;\r\n\r\n            $(tag).unwrap();\r\n\r\n            if($(tag).prop('tagName') === tagName && $(tag).parent().hasClass(_this.className) === false && $(tag).parent().hasClass(_this.className + '-wrapper')) {\r\n                $(tag).unwrap();\r\n            }\r\n        },\r\n\r\n        // adding attribute in tag\r\n        addAttribute : function(tag, node){\r\n            if(node.style !== null) {\r\n                $(tag).attr('style', node.style);\r\n            }\r\n\r\n            if(node.class !== null) {\r\n                $(tag).addClass(node.class);\r\n            }\r\n\r\n            if(node.attribute !== null) {\r\n                if($.isArray(node.attribute) === true) {\r\n                    $(tag).attr(node.attribute[0], node.attribute[1]);\r\n                }\r\n                else {\r\n                    $(tag).attr(node.attribute);\r\n                }\r\n            }\r\n\r\n            return tag;\r\n        },\r\n\r\n        // insert a node into cursor point in editor\r\n        insertAtCaret : function(node){\r\n            var _this = this;\r\n            if(_this.isSelectionOutsideOfEditor() === true) {\r\n                return false;\r\n            }\r\n\r\n            if(_this.getSelection()) {\r\n                var range = _this.getSelection().getRangeAt(0);\r\n                range.insertNode(node);\r\n            }\r\n            else {\r\n                $(node).appendTo(_this.elem);\r\n            }\r\n        },\r\n\r\n        // checking if selection outside of editor or not\r\n        isSelectionOutsideOfEditor : function(){\r\n            //return false;\r\n            return !this.elementContainsSelection(this.elem);\r\n        },\r\n\r\n        isActive : function(){\r\n            //return false;\r\n            return this.elementContainsSelection(this.elem);\r\n        },\r\n\r\n        readonly : function(readonly) {\r\n            if (readonly === undefined) {\r\n                return $(this.elem).attr('contentEditable');\r\n            } else {\r\n                $(this.elem).attr('contentEditable', readonly && true);\r\n                return this;\r\n            }\r\n        },\r\n\r\n        // node contains in containers or not\r\n        isOrContains : function(node, container) {\r\n            while (node) {\r\n                if (node === container) {\r\n                    return true;\r\n                }\r\n                node = node.parentNode;\r\n            }\r\n            return false;\r\n        },\r\n\r\n        // selected text is inside container\r\n        elementContainsSelection : function(el) {\r\n            var _this = this;\r\n            var sel;\r\n            if (this.win.getSelection) {\r\n                sel = this.win.getSelection();\r\n                if (sel.rangeCount > 0) {\r\n                    for (var i = 0; i < sel.rangeCount; ++i) {\r\n                        if (!_this.isOrContains(sel.getRangeAt(i).commonAncestorContainer, el)) {\r\n                            return false;\r\n                        }\r\n                    }\r\n                    return true;\r\n                }\r\n            } else if ( (sel = _this.doc.selection) && sel.type !== \"Control\") {\r\n                return _this.isOrContains(sel.createRange().parentElement(), el);\r\n            }\r\n            return false;\r\n        },\r\n\r\n        // insert html chunk into editor's temp tag\r\n        insertHtml : function(html){\r\n            var _this = this;\r\n            $(_this.elem).find('temp').html(html);\r\n        },\r\n\r\n        // utility of editor\r\n        utils : function(){\r\n            var _this = this;\r\n\r\n            $('html').on('.'+ _this.className +'-modal-close', 'click', function(event) {\r\n                event.preventDefault();\r\n                _this.closeModal('#' + $(this).closest('.'+ _this.className + '-modal').attr('id'));\r\n            });\r\n\r\n            if( $('.' + _this.randomString + '-bind').length > 0 ) {\r\n                var bindData;\r\n                $('html').on(_this.elem, 'click keyup', function() {\r\n                    var el = _this.elem;\r\n                    clearTimeout(bindData);\r\n                    bindData = setTimeout(function(){ $('.' + _this.randomString + '-bind').html( $(el).html() ); }, 250);\r\n                });\r\n            }\r\n\r\n            $(_this.doc).click(function(event) {\r\n                $('.' + _this.className).closest('.' + _this.className + '-wrapper').find('.' + _this.className + '-toolbar > ul > li > ul').hide();\r\n            });\r\n        },\r\n\r\n        // youtube video id from url\r\n        getYoutubeVideoIdFromUrl : function(url){\r\n            if(url.length === 0) return false;\r\n            var videoId = '';\r\n            url = url.replace(/(>|<)/gi,'').split(/(vi\\/|v=|\\/v\\/|youtu\\.be\\/|\\/embed\\/)/);\r\n            if(url[2] !== undefined) {\r\n                videoId = url[2].split(/[^0-9a-z_\\-]/i);\r\n                videoId = videoId[0];\r\n            }\r\n            else {\r\n                videoId = url;\r\n            }\r\n            return videoId;\r\n        },\r\n\r\n        // opening modal window\r\n        openModal : function(selector){\r\n            var temp = this.doc.createElement('temp');\r\n            temp.textContent = '.';\r\n            this.insertAtCaret(temp);\r\n\r\n            $(selector).removeClass('is-hidden');\r\n        },\r\n\r\n        // closing modal window\r\n        closeModal : function(selector){\r\n            var _this = this;\r\n\r\n            $(selector).addClass('is-hidden').find('input').val('');\r\n            $(selector).find('.' + _this.className + '-modal-content-body-loader').css('width', '0');\r\n            var $temp = $(this.elem).find('temp');\r\n\r\n            if($temp.html() === '.') {\r\n                $temp.remove();\r\n            }\r\n            else {\r\n                $temp.contents().unwrap();\r\n            }\r\n\r\n            $(this.elem).focus();\r\n        },\r\n\r\n        bold : function(){\r\n           this.doc.execCommand(\"Bold\");\r\n           //this.wrapSelectionWithNodeName({ nodeName: 'strong', keepHtml: true });\r\n        },\r\n\r\n        italic : function(){\r\n           this.doc.execCommand(\"Italic\");\r\n           //this.wrapSelectionWithNodeName({ nodeName: 'em', keepHtml: true });\r\n        },\r\n\r\n        strike : function(){\r\n           this.doc.execCommand(\"strikethrough\");\r\n           //this.wrapSelectionWithNodeName({ nodeName: 'strong', keepHtml: true });\r\n        },\r\n\r\n        listOl : function(){\r\n           this.doc.execCommand(\"insertorderedlist\");\r\n           //this.wrapSelectionWithNodeName({ nodeName: 'strong', keepHtml: true });\r\n        },\r\n\r\n        listUl : function(){\r\n           this.doc.execCommand(\"insertunorderedlist\");\r\n           //this.wrapSelectionWithNodeName({ nodeName: 'strong', keepHtml: true });\r\n        },\r\n\r\n        h2 : function(){\r\n           this.doc.execCommand(\"h2\");\r\n            //this.wrapSelectionWithNodeName({ nodeName: 'h2', blockElement: true });\r\n        },\r\n\r\n        h3 : function(){\r\n           this.doc.execCommand(\"h3\");\r\n            //this.wrapSelectionWithNodeName({ nodeName: 'h3', blockElement: true });\r\n        },\r\n\r\n        h4 : function(){\r\n           this.doc.execCommand(\"h4\");\r\n            //this.wrapSelectionWithNodeName({ nodeName: 'h4', blockElement: true });\r\n        },\r\n\r\n        x : function(){\r\n           this.doc.execCommand(\"h4\");\r\n        },\r\n\r\n        alignleft : function(){\r\n           this.doc.execCommand(\"justifyleft\");\r\n            //this.wrapSelectionWithNodeName({ nodeName: 'p', style: 'text-align: left', class: 'text-left', keepHtml: true });\r\n        },\r\n\r\n        aligncenter : function(){\r\n           this.doc.execCommand(\"justifycenter\");\r\n            //this.wrapSelectionWithNodeName({ nodeName: 'p', style: 'text-align: center', class: 'text-center', keepHtml: true });\r\n        },\r\n\r\n        alignright : function(){\r\n           this.doc.execCommand(\"justifyright\");\r\n            //this.wrapSelectionWithNodeName({ nodeName: 'p', style: 'text-align: right', class: 'text-right', keepHtml: true });\r\n        },\r\n\r\n        alignfull : function(){\r\n           this.doc.execCommand(\"justifyfull\");\r\n            //this.wrapSelectionWithNodeName({ nodeName: 'p', style: 'text-align: right', class: 'text-right', keepHtml: true });\r\n        },\r\n\r\n        blockquote : function(){\r\n           this.doc.execCommand(\"blockquote\");\r\n            //this.wrapSelectionWithNodeName({ nodeName: 'blockquote' });\r\n        },\r\n\r\n        code : function(){\r\n           this.doc.execCommand(\"p\");\r\n            //this.wrapSelectionWithNodeName({ nodeName: 'pre' });\r\n        },\r\n\r\n        inserthorizontalrule : function(){\r\n           this.doc.execCommand(\"inserthorizontalrule\");\r\n        },\r\n\r\n\r\n        image : function(){\r\n           var url = prompt('Insert Image URL','http://');\r\n           var urlRegex = new RegExp('^((http|https)://|(mailto:)|(//))[a-z0-9]', 'i');\r\n           if (url !== null && url !== '' && url !== 'http://' && urlRegex.test(url)) {\r\n               this.doc.execCommand(\"insertimage\", false, url);\r\n           }\r\n        },\r\n\r\n        link : function(){\r\n            var url = prompt('Insert URL','http://');\r\n            var urlRegex = new RegExp('^((http|https)://|(mailto:)|(//))[a-z0-9]', 'i');\r\n            if (url !== null && url !== '' && url !== 'http://' && urlRegex.test(url)) {\r\n               this.doc.execCommand(\"createlink\", false, url);\r\n            }\r\n            //this.wrapSelectionWithNodeName({ nodeName: 'a', attribute: ['href', prompt('Insert link', '')] });\r\n        },\r\n\r\n        indent : function(){\r\n           this.doc.execCommand(\"indent\");\r\n        },\r\n\r\n        outdent : function(){\r\n           this.doc.execCommand(\"outdent\");\r\n        },\r\n\r\n\r\n        toMd : function() {\r\n            return  toMarkdown(this.elem.innerHTML);\r\n        }\r\n    });\r\n\r\n    return Preview;\r\n});\r\n"]}