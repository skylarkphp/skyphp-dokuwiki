{"version":3,"sources":["Action.js"],"names":["define","langx","_Action","Wordpad","i18n","Action","inherit","htmlTag","disableTag","menu","active","get","this","state","set","value","disabled","needFocus","_construct","opts","prototype","call","title","translate","name","_this","editor","on","body","is","editable","clipboard","pasting","setActive","setDisabled","shortcut","hotkeys","add","e","execute","ref","split","k","len","length","tag","trim","inArray","formatter","_allowedTags","push","inputManager","focused","_status","_init","_disableStatus","endNodes","startNodes","selection","filter","_activeStatus","endNode","startNode","node","_t"],"mappings":";;;;;;;AAAAA,QACE,sBACA,sCACA,YACA,UACA,SAASC,EAAOC,EAASC,EAAQC,GACjC,IAEIC,EAASH,EAAQI,SACnBC,QAAU,GAEVC,WAAa,GAEbC,MAAO,EAEPC,QACEC,IAAM,WACJ,OAAOC,KAAKC,MAAMF,IAAI,WAGxBG,IAAM,SAASC,GACb,OAAOH,KAAKC,MAAMC,IAAI,SAASC,KAMnCC,UACEL,IAAM,WACJ,OAAOC,KAAKC,MAAMF,IAAI,aAGxBG,IAAM,SAASC,GACb,OAAOH,KAAKC,MAAMC,IAAI,WAAWC,KAKrCE,WAAY,EAEZC,WAAc,SAASC,GACrBjB,EAAQkB,UAAUF,WAAWG,KAAKT,KAAKO,GAGvCP,KAAKU,MAAQlB,EAAKmB,UAAUX,KAAKY,MAEjC,IAAIC,EAAQb,KAEZA,KAAKc,OAAOC,GAAG,OAAQ,WAGrB,GADeF,EAAMC,OAAOE,KAAKC,GAAG,aAAeJ,EAAMC,OAAOE,KAAKC,GAAG,uBACjDJ,EAAMC,OAAOI,SAASC,UAAUC,QAIvD,OADAP,EAAMQ,WAAU,GACTR,EAAMS,aAAY,KAGN,MAAjBtB,KAAKuB,UACPvB,KAAKc,OAAOI,SAASM,QAAQC,IAAIzB,KAAKuB,SAAU,SAASG,GAGvD,OADAb,EAAMc,WACC,IAIX,IAAIC,EAAM5B,KAAKL,QAAQkC,MAAM,KAC7B,IAAKC,EAAI,EAAGC,IAAMH,EAAII,OAAQF,EAAIC,IAAKD,IACrCG,IAAML,EAAIE,GACVG,IAAM5C,EAAM6C,KAAKD,KACbA,KAAO5C,EAAM8C,QAAQF,IAAKjC,KAAKc,OAAOI,SAASkB,UAAUC,cAAgB,GAC3ErC,KAAKc,OAAOI,SAASkB,UAAUC,aAAaC,KAAKL,KAGrDjC,KAAKc,OAAOC,GAAG,mBAAoB,SAASW,GAC1C,GAAIb,EAAMC,OAAOI,SAASqB,aAAaC,QACrC,OAAO3B,EAAM4B,YAIjBzC,KAAK0C,SAGPA,MAAQ,aAKRC,eAAiB,WACf,IAAIvC,EAAUwC,EAAUC,EAQxB,OAPAA,EAAa7C,KAAKc,OAAOI,SAAS4B,UAAUD,aAC5CD,EAAW5C,KAAKc,OAAOI,SAAS4B,UAAUF,WAC1CxC,EAAWyC,EAAWE,OAAO/C,KAAKJ,YAAYoC,OAAS,GAAKY,EAASG,OAAO/C,KAAKJ,YAAYoC,OAAS,EACtGhC,KAAKsB,YAAYlB,GACbJ,KAAKI,UACPJ,KAAKqB,WAAU,GAEVrB,KAAKI,UAGd4C,cAAgB,WACd,IAAIlD,EAAQmD,EAASL,EAAUM,EAAWL,EAQ1C,OAPAA,EAAa7C,KAAKc,OAAOI,SAAS4B,UAAUD,aAC5CD,EAAW5C,KAAKc,OAAOI,SAAS4B,UAAUF,WAC1CM,EAAYL,EAAWE,OAAO/C,KAAKL,SACnCsD,EAAUL,EAASG,OAAO/C,KAAKL,SAC/BG,EAASoD,EAAUlB,OAAS,GAAKiB,EAAQjB,OAAS,GAAKkB,EAAUjC,GAAGgC,GACpEjD,KAAKmD,KAAOrD,EAASoD,EAAY,KACjClD,KAAKqB,UAAUvB,GACRE,KAAKF,QAGd2C,QAAU,WAER,GADAzC,KAAK2C,kBACD3C,KAAKI,SAGT,OAAOJ,KAAKgD,iBAGd3B,UAAY,SAASvB,GACfA,IAAWE,KAAKF,SAGpBE,KAAKF,OAASA,IAGhBwB,YAAc,SAASlB,GACjBA,IAAaJ,KAAKI,WAGtBJ,KAAKI,SAAWA,MASpB,OAJAX,EAAOe,UAAU4C,GAAK5D,EAAKmB,UAE3BlB,EAAOD,KAAOA,EAEPC","file":"../Action.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-widgets-base/actions/Action\",\r\n  \"./Wordpad\",\r\n  \"./i18n\"\r\n],function(langx, _Action, Wordpad,i18n){ \r\n  var slice = [].slice;\r\n\r\n  var Action = _Action.inherit( {\r\n    htmlTag : '',\r\n\r\n    disableTag : '',\r\n\r\n    menu : false,\r\n\r\n    active : {\r\n      get : function() {\r\n        return this.state.get(\"active\");\r\n      },\r\n\r\n      set : function(value) {\r\n        return this.state.set(\"active\",value);\r\n\r\n      }\r\n\r\n    },\r\n\r\n    disabled : {\r\n      get : function() {\r\n        return this.state.get(\"disabled\");\r\n      },\r\n\r\n      set : function(value) {\r\n        return this.state.set(\"disabled\",value);\r\n\r\n      }\r\n    },\r\n\r\n    needFocus : true,\r\n\r\n    _construct  : function(opts) {\r\n      _Action.prototype._construct.call(this,opts);\r\n      //this.toolbar = opts.toolbar;\r\n      //this.editor = this.toolbar.editor;\r\n      this.title = i18n.translate(this.name);\r\n\r\n      var _this = this;\r\n\r\n      this.editor.on('blur', function() {\r\n        var editorActive;\r\n        editorActive = _this.editor.body.is(':visible') && _this.editor.body.is('[contenteditable]');\r\n        if (!(editorActive && !_this.editor.editable.clipboard.pasting)) {\r\n          return;\r\n        }\r\n        _this.setActive(false);\r\n        return _this.setDisabled(false);\r\n      });\r\n\r\n      if (this.shortcut != null) {\r\n        this.editor.editable.hotkeys.add(this.shortcut, function(e) {\r\n          //_this.el.mousedown();\r\n          _this.execute();\r\n          return false;\r\n        });\r\n      }\r\n\r\n      var ref = this.htmlTag.split(',');\r\n      for (k = 0, len = ref.length; k < len; k++) {\r\n        tag = ref[k];\r\n        tag = langx.trim(tag);\r\n        if (tag && langx.inArray(tag, this.editor.editable.formatter._allowedTags) < 0) {\r\n          this.editor.editable.formatter._allowedTags.push(tag);\r\n        }\r\n      }\r\n      this.editor.on('selectionchanged', function(e) {\r\n        if (_this.editor.editable.inputManager.focused) {\r\n          return _this._status();\r\n        }\r\n      });\r\n\r\n      this._init();\r\n    },\r\n\r\n    _init : function() {\r\n\r\n\r\n    },\r\n\r\n    _disableStatus : function() {\r\n      var disabled, endNodes, startNodes;\r\n      startNodes = this.editor.editable.selection.startNodes();\r\n      endNodes = this.editor.editable.selection.endNodes();\r\n      disabled = startNodes.filter(this.disableTag).length > 0 || endNodes.filter(this.disableTag).length > 0;\r\n      this.setDisabled(disabled);\r\n      if (this.disabled) {\r\n        this.setActive(false);\r\n      }\r\n      return this.disabled;\r\n    },\r\n\r\n    _activeStatus : function() {\r\n      var active, endNode, endNodes, startNode, startNodes;\r\n      startNodes = this.editor.editable.selection.startNodes();\r\n      endNodes = this.editor.editable.selection.endNodes();\r\n      startNode = startNodes.filter(this.htmlTag);\r\n      endNode = endNodes.filter(this.htmlTag);\r\n      active = startNode.length > 0 && endNode.length > 0 && startNode.is(endNode);\r\n      this.node = active ? startNode : null;\r\n      this.setActive(active);\r\n      return this.active;\r\n    },\r\n\r\n    _status : function() {\r\n      this._disableStatus();\r\n      if (this.disabled) {\r\n        return;\r\n      }\r\n      return this._activeStatus();\r\n    },\r\n\r\n    setActive : function(active) {\r\n      if (active === this.active) {\r\n        return;\r\n      }\r\n      this.active = active;\r\n    },\r\n\r\n    setDisabled : function(disabled) {\r\n      if (disabled === this.disabled) {\r\n        return;\r\n      }\r\n      this.disabled = disabled;\r\n    }\r\n  }); \r\n\r\n\r\n  Action.prototype._t = i18n.translate;\r\n\r\n  Action.i18n = i18n;\r\n  \r\n  return Action;\r\n\r\n});"]}