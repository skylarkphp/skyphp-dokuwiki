{"version":3,"sources":["Wordpad.js"],"names":["define","skylark","langx","$","Editable","Widget","Toolbar","uploader","i18n","addons","Wordpad","inherit","klassName","pluginName","options","classes","icons","html","header","bold","italic","underline","strikethrough","fontScale","fontColor","mark","blockquote","listul","listol","code","table","fullscreen","emoji","link","image","video","hr","indent","outdent","alignLeft","alignCenter","alignRight","alignJustify","srcNodeRef","placeholder","actions","placeholderImage","placeholderPoster","toolbar","items","params","upload","template","_init","editor","uploadOpts","this","_actions","opts","textarea","attr","length","Error","data","destroy","id","count","_render","self","editable","_elm","classPrefix","body","on","e","trigger","type","ref","k","len","name","action","findAction","toolItemCtor","push","mount","_placeholder","setValue","val","trim","focus","prototype","triggerHandler","args","concat","Evented","apply","key","results","el","insertBefore","wrapper","find","placeholderEl","append","blur","value","insertAfter","children","util","isEmptyNode","parseInt","css","indentWidth","show","hide","hidePopover","getValue","sync","constructor","each","i","popover","active","closest","off","selection","clear","inputManager","focused","removeData","remove","document","window","attach"],"mappings":"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","file":"../Wordpad.js","sourcesContent":["define([\n  \"skylark-langx/skylark\",\n  \"skylark-langx/langx\",\n  \"skylark-domx-query\",\n  \"skylark-domx-contents/Editable\",\n  \"skylark-widgets-base/Widget\",\n  \"skylark-widgets-toolbars/Toolbar\",\n  \"./uploader\",\n  \"./i18n\",\n  \"./addons\"\n\n],function(skylark,langx, $, Editable,Widget,Toolbar,uploader,i18n,addons){ \n\n  var Wordpad = Widget.inherit({\n      klassName : \"Wordpad\",\n      pluginName : \"lark.wordpad\",\n\n      options : {\n        classes : {\n          icons : {\n            html : \"fa fa-html5\",\n            \n            header: \"fa fa-header\",\n\n            bold : \"fa fa-bold\",\n            italic : \"fa fa-italic\",\n            underline: \"fa fa-underline\",\n            strikethrough : \"fa fa-strikethrough\",\n            fontScale: \"fa fa-text-height\",\n            fontColor: \"fa fa-font\",\n            mark : \"fa fa-pencil\",\n\n            blockquote: \"fa fa-quote-right\",\n            listul : \"fa fa-list-ul\",\n            listol : \"fa fa-list-ol\",\n            code: \"fa fa-code\",\n            table : \"fa fa-table\",\n\n            fullscreen : \"fa fa-expand\",\n\n            emoji: \"fa fa-smile-o\",\n            link : \"fa fa-link\",\n            image: \"fa fa-picture-o\",\n            video: \"fa fa-video-camera\",\n            hr: \"fa fa-minus\",\n\n            indent: \"fa fa-indent\",\n            outdent: \"fa fa-dedent\",\n            alignLeft: \"fa fa-align-left\",\n            alignCenter: \"fa fa-align-center\",\n            alignRight: \"fa fa-align-right\",\n            alignJustify: \"fa fa-align-justify\",\n\n          }\n        },\n        srcNodeRef: null,\n        placeholder: '',\n        addons : {\n          actions : {\n            image : {\n               placeholderImage: 'images/image.png',\n            },\n            video : {\n              placeholderPoster: \"images/poster.jpg\"\n            }\n          },\n          toolbar : {\n            items : {\n              emoji : {\n\n              }\n            }\n          }\n        },\n       \n        params: {},\n        upload: false,\n        template : \"<div class=\\\"lark-wordpad\\\">\\n  <div class=\\\"wordpad-wrapper\\\">\\n    <div class=\\\"wordpad-placeholder\\\"></div>\\n    <div class=\\\"wordpad-body\\\" contenteditable=\\\"true\\\">\\n    </div>\\n  </div>\\n</div>\"\n      },\n\n\n    _init : function() {\n      this._actions = [];\n\n      //this.opts = langx.extend({}, this.opts, opts);\n      this.opts = this.options;\n\n      var e, editor, uploadOpts;\n      this.textarea = $(this.options.srcNodeRef);\n\n      this.options.placeholder = this.options.placeholder || this.textarea.attr('placeholder');\n\n      if (!this.textarea.length) {\n        throw new Error('Wordpad: param textarea is required.');\n        return;\n      }\n\n      editor = this.textarea.data('wordpad');\n      if (editor != null) {\n        editor.destroy();\n      }\n      this.id = ++Wordpad.count;\n      this._render();\n\n\n      var self = this;\n      this.editable = new Editable(this._elm,{\n        classPrefix : \"lark-wordpad-\",\n        textarea : this.textarea,\n        body : this.body\n      });\n\n      // TODO\n      this.editable.on(\"all\",function(e,data){\n        return self.trigger(e.type,data);\n      });\n\n      if (this.options.upload && uploader) {\n        uploadOpts = typeof this.options.upload === 'object' ? this.options.upload : {};\n        this.uploader = uploader(uploadOpts);\n      }\n\n\n      var actions = [];\n\n      var  ref = this.options.toolbar;\n      for (var k = 0, len = ref.length; k < len; k++) {\n        var name = ref[k];\n        if (name === '|') {\n          actions.push({\n            name : \"|\"\n          });\n          continue;\n        }\n\n        var action  = this.findAction(name),\n            toolItemCtor = addons.toolbar.items[name];\n\n\n        //if (!toolItemCtor) {\n        //  toolItemCtor = ToolButton;\n        //}\n        action.toolItemCtor = toolItemCtor;\n        actions.push(action);\n      };\n\n      this.toolbar = new Toolbar({\n        actions : actions,\n        classes : {\n          icons : this.options.classes.icons\n        }\n        //toolbar: this.options.toolbar,\n        //toolbarFloat:  this.options.toolbarFloat,\n        //toolbarHidden:  this.options.toolbarHidden,\n        //toolbarFloatOffset:  this.options.toolbarFloatOffset\n\n      });\n\n      this.toolbar.mount(this._elm,\"prepend\");\n\n      \n      if (this.options.placeholder) {\n        this.on('valuechanged', function() {\n          return self._placeholder();\n        });\n      }\n      this.setValue(this.textarea.val().trim() || '');\n      if (this.textarea.attr('autofocus')) {\n        return self.focus();\n      }\n\n\n    }\n  });\n\n \n  Wordpad.prototype.triggerHandler =  Wordpad.prototype.trigger = function(type,data) {\n    var args, ref;\n    args = [type];\n    if (data) {\n      args = args.concat(data);\n    }\n    langx.Evented.prototype.trigger.apply(this, args);\n    return this;\n  };\n\n\n  //Wordpad.connect(Util);\n\n  //Wordpad.connect(InputManager);\n\n  //Wordpad.connect(Selection);\n\n  //Wordpad.connect(UndoManager);\n\n  //Wordpad.connect(Keystroke);\n\n  //Wordpad.connect(Formatter);\n\n  //Wordpad.connect(Toolbar);\n\n  //Wordpad.connect(Indentation);\n\n  //Wordpad.connect(Clipboard);\n\n  Wordpad.count = 0;\n\n\n  Wordpad.prototype._render = function() {\n    var key, ref, results, val;\n\n    //this.el = $(this._tpl).insertBefore(this.textarea);\n    this.el = $(this._elm).insertBefore (this.textarea);\n\n    this.wrapper = this.el.find('.wordpad-wrapper');\n    this.body = this.wrapper.find('.wordpad-body');\n    this.placeholderEl = this.wrapper.find('.wordpad-placeholder').append(this.options.placeholder);\n    this.el.data('wordpad', this);\n    this.wrapper.append(this.textarea);\n    this.textarea.data('wordpad', this).blur();\n    this.body.attr('tabindex', this.textarea.attr('tabindex'));\n\n    if (this.options.params) {\n      ref = this.options.params;\n      results = [];\n      for (key in ref) {\n        val = ref[key];\n        results.push($('<input/>', {\n          type: 'hidden',\n          name: key,\n          value: val\n        }).insertAfter(this.textarea));\n      }\n      return results;\n    }\n  };\n\n  Wordpad.prototype._placeholder = function() {\n    var children;\n    children = this.body.children();\n    if (children.length === 0 || (children.length === 1 && this.editable.util.isEmptyNode(children) && parseInt(children.css('margin-left') || 0) < this.options.indentWidth)) {\n      return this.placeholderEl.show();\n    } else {\n      return this.placeholderEl.hide();\n    }\n  };\n\n  Wordpad.prototype.setValue = function(val) {\n    this.hidePopover();\n\n    this.editable.setValue(val);\n\n    return this.trigger('valuechanged');\n  };\n\n  Wordpad.prototype.getValue = function() {\n    return this.editable.getValue();\n  };\n\n  Wordpad.prototype.sync = function() {\n    this.editable.sync();\n    return this;\n  };\n\n  Wordpad.prototype.focus = function() {\n    this.editable.focus();\n    return this;\n  };\n\n  Wordpad.prototype.blur = function() {\n    this.editable.blur();\n    return this;\n  };\n\n  Wordpad.prototype.findAction = function(name) {\n    var action = this._actions[name];\n    if (!action) {\n      if (!this.constructor.addons.actions[name]) {\n        throw new Error(\"Wordpad: invalid action \" + name);\n      }\n\n      action = this._actions[name] = new this.constructor.addons.actions[name]({\n        editor: this\n      });\n\n      this._actions.push(action);\n    }\n\n    return action;\n  };\n\n  Wordpad.prototype.hidePopover = function() {\n    return this.el.find('.wordpad-popover').each(function(i, popover) {\n      popover = $(popover).data('popover');\n      if (popover.active) {\n        return popover.hide();\n      }\n    });\n  };\n\n  Wordpad.prototype.destroy = function() {\n    this.trigger('destroy');\n    this.textarea.closest('form').off('.Wordpad .wordpad-' + this.id);\n    this.selection.clear();\n    this.inputManager.focused = false;\n    this.textarea.insertBefore(this.el).hide().val('').removeData('wordpad');\n    this.el.remove();\n    $(document).off('.wordpad-' + this.id);\n    $(window).off('.wordpad-' + this.id);\n    return this.off();\n  };\n\n\n  Wordpad.Toolbar = Toolbar;\n\n  Wordpad.i18n = i18n;\n\n  Wordpad.addons = addons;\n\n\n  return skylark.attach(\"widgets.Wordpad\",Wordpad);\n\n});\n"]}