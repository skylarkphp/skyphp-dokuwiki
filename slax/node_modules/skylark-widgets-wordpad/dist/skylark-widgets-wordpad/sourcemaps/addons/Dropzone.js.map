{"version":3,"sources":["addons/dropzone.js"],"names":["define","$","Addon","Wordpad","i18n","Dropzone","inherit","categoryName","addonName","prototype","_entered","_init","_this","this","editor","_widget","uploader","document","body","on","e","originalEvent","dataTransfer","dropEffect","preventDefault","imageBtn","toolbar","findButton","stopPropagation","show","hide","file","imageFiles","_i","_j","_len","_len1","_ref","files","length","validFile","alert","name","push","upload","inline","setActive","type","indexOf","addons","general","dropzone"],"mappings":";;;;;;;AAAAA,QACE,qBACA,6BACA,aACA,WACA,SAASC,EAAEC,EAAOC,EAAQC,GAG1B,IAAIC,EAAWH,EAAMI,YAoFrB,OAjFAD,EAASE,aAAe,WAExBF,EAASG,UAAY,WAGrBH,EAASI,UAAUC,SAAW,EAE9BL,EAASI,UAAUE,MAAQ,WAkBN,IAAUC,EAhB7B,GADAC,KAAKC,OAASD,KAAKE,QACS,MAAxBF,KAAKC,OAAOE,SAYhB,OARAf,EAAEgB,SAASC,MAAMC,GAAG,WAAY,SAASC,GAEvC,OADAA,EAAEC,cAAcC,aAAaC,WAAa,OACnCH,EAAEI,mBAEXvB,EAAEgB,SAASC,MAAMC,GAAG,OAAQ,SAASC,GACnC,OAAOA,EAAEI,mBAEXX,KAAKY,SAAWZ,KAAKC,OAAOY,QAAQC,WAAW,SACxCd,KAAKC,OAAOI,KAAKC,GAAG,WAAY,SAASC,GAG9C,OAFAA,EAAEC,cAAcC,aAAaC,WAAa,OAC1CH,EAAEQ,kBACKR,EAAEI,mBACRL,GAAG,aAAuBP,EAQ1BC,KAPM,SAASO,GAKd,OAJ8B,KAAzBR,EAAMF,UAAY,IACrBE,EAAMiB,OAERT,EAAEI,iBACKJ,EAAEQ,qBAEHT,GAAG,YAAa,SAAUP,GAClC,OAAO,SAASQ,GAKd,OAJKR,EAAMF,UAAY,IAAM,GAC3BE,EAAMkB,OAERV,EAAEI,iBACKJ,EAAEQ,mBANa,CAQvBf,OAAOM,GAAG,OAAQ,SAAUP,GAC7B,OAAO,SAASQ,GACd,IAAIW,EAAMC,EAAYC,EAAIC,EAAIC,EAAMC,EAAOC,EAG3C,IAFAL,KAEKC,EAAK,EAAGE,GADbE,EAAOjB,EAAEC,cAAcC,aAAagB,OACXC,OAAQN,EAAKE,EAAMF,IAAM,CAEhD,GADAF,EAAOM,EAAKJ,IACPrB,EAAM4B,UAAUT,GAGnB,OAFAU,MAAM,IAAMV,EAAKW,KAAO,aACxB9B,EAAMkB,QACC,EAETE,EAAWW,KAAKZ,GAElB,IAAKG,EAAK,EAAGE,EAAQJ,EAAWO,OAAQL,EAAKE,EAAOF,IAClDH,EAAOC,EAAWE,GAClBtB,EAAME,OAAOE,SAAS4B,OAAOb,GAC3Bc,QAAQ,IAKZ,OAFAjC,EAAMkB,OACNV,EAAEQ,kBACKR,EAAEI,kBAtBQ,CAwBlBX,QAGLR,EAASI,UAAUoB,KAAO,WACxB,OAAOhB,KAAKY,SAASqB,WAAU,IAGjCzC,EAASI,UAAUqB,KAAO,WAExB,OADAjB,KAAKY,SAASqB,WAAU,GACjBjC,KAAKH,SAAW,GAGzBL,EAASI,UAAU+B,UAAY,SAAST,GACtC,OAAOA,EAAKgB,KAAKC,QAAQ,WAAa,GAGjC7C,EAAQ8C,OAAOC,QAAQC,SAAW9C","file":"../../addons/dropzone.js","sourcesContent":["define([\r\n  \"skylark-domx-query\",\r\n  \"skylark-widgets-base/addon\",\r\n  \"../wordpad\",\r\n  \"../i18n\"\r\n],function($,Addon, Wordpad,i18n){ \r\n\r\n\r\n  var Dropzone = Addon.inherit({\r\n  });\r\n\r\n  Dropzone.categoryName = \"genernal\";\r\n\r\n  Dropzone.addonName = \"dropzone\";\r\n\r\n\r\n  Dropzone.prototype._entered = 0;\r\n\r\n  Dropzone.prototype._init = function() {\r\n    this.editor = this._widget;\r\n    if (this.editor.uploader == null) {\r\n      //throw new Error(\"Can't work without 'simple-uploader' module\");\r\n      return;\r\n    }\r\n    $(document.body).on(\"dragover\", function(e) {\r\n      e.originalEvent.dataTransfer.dropEffect = \"none\";\r\n      return e.preventDefault();\r\n    });\r\n    $(document.body).on('drop', function(e) {\r\n      return e.preventDefault();\r\n    });\r\n    this.imageBtn = this.editor.toolbar.findButton(\"image\");\r\n    return this.editor.body.on(\"dragover\", function(e) {\r\n      e.originalEvent.dataTransfer.dropEffect = \"copy\";\r\n      e.stopPropagation();\r\n      return e.preventDefault();\r\n    }).on(\"dragenter\", (function(_this) {\r\n      return function(e) {\r\n        if ((_this._entered += 1) === 1) {\r\n          _this.show();\r\n        }\r\n        e.preventDefault();\r\n        return e.stopPropagation();\r\n      };\r\n    })(this)).on(\"dragleave\", (function(_this) {\r\n      return function(e) {\r\n        if ((_this._entered -= 1) <= 0) {\r\n          _this.hide();\r\n        }\r\n        e.preventDefault();\r\n        return e.stopPropagation();\r\n      };\r\n    })(this)).on(\"drop\", (function(_this) {\r\n      return function(e) {\r\n        var file, imageFiles, _i, _j, _len, _len1, _ref;\r\n        imageFiles = [];\r\n        _ref = e.originalEvent.dataTransfer.files;\r\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n          file = _ref[_i];\r\n          if (!_this.validFile(file)) {\r\n            alert(\"「\" + file.name + \"]」文件不是图片。\");\r\n            _this.hide();\r\n            return false;\r\n          }\r\n          imageFiles.push(file);\r\n        }\r\n        for (_j = 0, _len1 = imageFiles.length; _j < _len1; _j++) {\r\n          file = imageFiles[_j];\r\n          _this.editor.uploader.upload(file, {\r\n            inline: true\r\n          });\r\n        }\r\n        _this.hide();\r\n        e.stopPropagation();\r\n        return e.preventDefault();\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  Dropzone.prototype.show = function() {\r\n    return this.imageBtn.setActive(true);\r\n  };\r\n\r\n  Dropzone.prototype.hide = function() {\r\n    this.imageBtn.setActive(false);\r\n    return this._entered = 0;\r\n  };\r\n\r\n  Dropzone.prototype.validFile = function(file) {\r\n    return file.type.indexOf(\"image/\") > -1;\r\n  };\r\n\r\n  return Wordpad.addons.general.dropzone = Dropzone;\r\n\r\n\r\n});"]}