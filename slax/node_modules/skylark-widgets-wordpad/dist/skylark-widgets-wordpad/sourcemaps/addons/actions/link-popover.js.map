{"version":3,"sources":["addons/actions/link-popover.js"],"names":["define","$","addons","Popover","inherit","render","tpl","_this","this","_t","el","addClass","append","textEl","find","urlEl","unlinkEl","selectTarget","on","e","which","target","text","val","editor","editable","inputManager","throttledValueChanged","test","attr","range","shiftKey","hasClass","preventDefault","document","createRange","selection","setRangeAfter","hide","txtNode","createTextNode","replaceWith","show","args","arguments","length","Array","prototype","slice","call","apply"],"mappings":";;;;;;;AAAAA,QACE,qBACA,eACA,iBACA,SAASC,EAAEC,EAAOC,GAyElB,OAxEkBA,EAAQC,SACxBC,OAAS,WACP,IAAIC,EAO8BC,EA8ClC,OApDAD,EAAM,2EAAkFE,KAAKC,GAAG,YAAe,8GAA0HD,KAAKC,GAAG,cAAiB,qIAA+ID,KAAKC,GAAG,WAAc,6GAAsHD,KAAKC,GAAG,cAAiB,4EAAmFD,KAAKC,GAAG,uBAA0B,mDAAwDD,KAAKC,GAAG,2BAA8B,qDACzwBD,KAAKE,GAAGC,SAAS,gBAAgBC,OAAON,GACxCE,KAAKK,OAASL,KAAKE,GAAGI,KAAK,cAC3BN,KAAKO,MAAQP,KAAKE,GAAGI,KAAK,aAC1BN,KAAKQ,SAAWR,KAAKE,GAAGI,KAAK,eAC7BN,KAAKS,aAAeT,KAAKE,GAAGI,KAAK,gBACjCN,KAAKK,OAAOK,GAAG,SAAmBX,EAQ/BC,KAPM,SAASW,GACd,GAAgB,KAAZA,EAAEC,MAIN,OADAb,EAAMc,OAAOC,KAAKf,EAAMM,OAAOU,OACxBhB,EAAMiB,OAAOC,SAASC,aAAaC,2BAG9CnB,KAAKO,MAAMG,GAAG,QAAS,SAAUX,GAC/B,OAAO,SAASY,GACd,IAAII,EACJ,GAAgB,KAAZJ,EAAEC,MAQN,OALAG,EAAMhB,EAAMQ,MAAMQ,OACZ,0DAA0DK,KAAKL,IAASA,IAC5EA,EAAM,UAAYA,GAEpBhB,EAAMc,OAAOQ,KAAK,OAAQN,GACnBhB,EAAMiB,OAAOC,SAASC,aAAaC,yBAXvB,CAapBnB,OACHP,GAAGO,KAAKO,MAAM,GAAIP,KAAKK,OAAO,KAAKK,GAAG,UAAW,SAAUX,GACzD,OAAO,SAASY,GACd,IAAIW,EACJ,GAAgB,KAAZX,EAAEC,OAA4B,KAAZD,EAAEC,QAAkBD,EAAEY,UAAwB,IAAZZ,EAAEC,OAAenB,EAAEkB,EAAEE,QAAQW,SAAS,YAK5F,OAJAb,EAAEc,iBACFH,EAAQI,SAASC,cACjB5B,EAAMiB,OAAOC,SAASW,UAAUC,cAAc9B,EAAMc,OAAQS,GAC5DvB,EAAM+B,OACC/B,EAAMiB,OAAOC,SAASC,aAAaC,yBARC,CAW9CnB,OACHA,KAAKQ,SAASE,GAAG,QAAS,SAAUX,GAClC,OAAO,SAASY,GACd,IAAIW,EAAOS,EAMX,OALAA,EAAUL,SAASM,eAAejC,EAAMc,OAAOC,QAC/Cf,EAAMc,OAAOoB,YAAYF,GACzBhC,EAAM+B,OACNR,EAAQI,SAASC,cACjB5B,EAAMiB,OAAOC,SAASW,UAAUC,cAAcE,EAAST,GAChDvB,EAAMiB,OAAOC,SAASC,aAAaC,yBARpB,CAUvBnB,OACIA,KAAKS,aAAaC,GAAG,SAAU,SAAUX,GAC9C,OAAO,SAASY,GAEd,OADAZ,EAAMc,OAAOQ,KAAK,SAAUtB,EAAMU,aAAaM,OACxChB,EAAMiB,OAAOC,SAASC,aAAaC,yBAHR,CAKnCnB,QAGLkC,KAAO,WACL,IAAIC,EAIJ,OAHAA,EAAO,GAAKC,UAAUC,OAASC,MAAMC,UAAUC,MAAMC,KAAKL,UAAW,MACrEzC,EAAQ4C,UAAUL,KAAKQ,MAAM1C,KAAMmC,GACnCnC,KAAKK,OAAOU,IAAIf,KAAKa,OAAOC,QACrBd,KAAKO,MAAMQ,IAAIf,KAAKa,OAAOQ,KAAK","file":"../../../addons/actions/link-popover.js","sourcesContent":["define([\r\n  \"skylark-domx-query\",\r\n  \"../../addons\",\r\n  \"../../popover\"\r\n],function($,addons,Popover){ \r\n  var LinkPopover = Popover.inherit({\r\n    render : function() {\r\n      var tpl;\r\n      tpl = \"<div class=\\\"link-settings\\\">\\n  <div class=\\\"settings-field\\\">\\n    <label>\" + (this._t('linkText')) + \"</label>\\n    <input class=\\\"link-text\\\" type=\\\"text\\\"/>\\n    <a class=\\\"btn-unlink\\\" href=\\\"javascript:;\\\" title=\\\"\" + (this._t('removeLink')) + \"\\\"\\n      tabindex=\\\"-1\\\">\\n      <span class=\\\"fa fa-unlink\\\"></span>\\n    </a>\\n  </div>\\n  <div class=\\\"settings-field\\\">\\n    <label>\" + (this._t('linkUrl')) + \"</label>\\n    <input class=\\\"link-url\\\" type=\\\"text\\\"/>\\n  </div>\\n  <div class=\\\"settings-field\\\">\\n    <label>\" + (this._t('linkTarget')) + \"</label>\\n    <select class=\\\"link-target\\\">\\n      <option value=\\\"_blank\\\">\" + (this._t('openLinkInNewWindow')) + \" (_blank)</option>\\n      <option value=\\\"_self\\\">\" + (this._t('openLinkInCurrentWindow')) + \" (_self)</option>\\n    </select>\\n  </div>\\n</div>\";\r\n      this.el.addClass('link-popover').append(tpl);\r\n      this.textEl = this.el.find('.link-text');\r\n      this.urlEl = this.el.find('.link-url');\r\n      this.unlinkEl = this.el.find('.btn-unlink');\r\n      this.selectTarget = this.el.find('.link-target');\r\n      this.textEl.on('keyup', (function(_this) {\r\n        return function(e) {\r\n          if (e.which === 13) {\r\n            return;\r\n          }\r\n          _this.target.text(_this.textEl.val());\r\n          return _this.editor.editable.inputManager.throttledValueChanged();\r\n        };\r\n      })(this));\r\n      this.urlEl.on('keyup', (function(_this) {\r\n        return function(e) {\r\n          var val;\r\n          if (e.which === 13) {\r\n            return;\r\n          }\r\n          val = _this.urlEl.val();\r\n          if (!(/^(http|https|ftp|ftps|file)?:\\/\\/|^(mailto|tel)?:|^\\//ig.test(val) || !val)) {\r\n            val = 'http://' + val;\r\n          }\r\n          _this.target.attr('href', val);\r\n          return _this.editor.editable.inputManager.throttledValueChanged();\r\n        };\r\n      })(this));\r\n      $([this.urlEl[0], this.textEl[0]]).on('keydown', (function(_this) {\r\n        return function(e) {\r\n          var range;\r\n          if (e.which === 13 || e.which === 27 || (!e.shiftKey && e.which === 9 && $(e.target).hasClass('link-url'))) {\r\n            e.preventDefault();\r\n            range = document.createRange();\r\n            _this.editor.editable.selection.setRangeAfter(_this.target, range);\r\n            _this.hide();\r\n            return _this.editor.editable.inputManager.throttledValueChanged();\r\n          }\r\n        };\r\n      })(this));\r\n      this.unlinkEl.on('click', (function(_this) {\r\n        return function(e) {\r\n          var range, txtNode;\r\n          txtNode = document.createTextNode(_this.target.text());\r\n          _this.target.replaceWith(txtNode);\r\n          _this.hide();\r\n          range = document.createRange();\r\n          _this.editor.editable.selection.setRangeAfter(txtNode, range);\r\n          return _this.editor.editable.inputManager.throttledValueChanged();\r\n        };\r\n      })(this));\r\n      return this.selectTarget.on('change', (function(_this) {\r\n        return function(e) {\r\n          _this.target.attr('target', _this.selectTarget.val());\r\n          return _this.editor.editable.inputManager.throttledValueChanged();\r\n        };\r\n      })(this));\r\n    },\r\n\r\n    show : function() {\r\n      var args;\r\n      args = 1 <= arguments.length ? Array.prototype.slice.call(arguments, 0) : [];\r\n      Popover.prototype.show.apply(this, args);\r\n      this.textEl.val(this.target.text());\r\n      return this.urlEl.val(this.target.attr('href'));\r\n    }\r\n  });\r\n\r\n  return LinkPopover;\r\n});"]}